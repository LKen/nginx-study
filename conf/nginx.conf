
#user  nobody;
worker_processes  1;

error_log  logs/error.log;
# error_log  logs/error.log  notice;
# error_log  logs/error.log  info;

pid        logs/nginx.pid;


events {
  worker_connections  1024;
}

http {
    include       mime.types;  
    # default_type  application/octet-stream;  
    autoindex off;  # 列出文件目录
    autoindex_exact_size off;  
    autoindex_localtime off;  
    charset utf-8;

    server_tokens off;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                     '$status $body_bytes_sent "$http_referer" '
                     '"$http_user_agent" "$http_x_forwarded_for" "$request_uri" "$uri"';

    access_log  logs/access.log  main;
    tcp_nopush     on;
    sendfile        on;
    keepalive_timeout  240;

    map $http_upgrade $connection_upgrade {
      default upgrade;
      '' close;
    }

    upstream my_socket {                                                         
      server 47.107.169.246:2006;                                                
      keepalive 4000;
    }

    # 开启gzip 服务器自动压缩, gzip是针对于请求实时进行压缩，cpu开销大
    gzip  on;
    # 配置webapck 开启Gzip压缩，对静态资源优先匹配带gz的文件返回,使用的是编译压缩后的文件
    gzip_static on;
    # 启用gzip压缩的最小文件，小于设置值的文件将不会压缩
    gzip_min_length 1k;
    # gzip 压缩级别，1-10，数字越大压缩的越好，也越占用CPU时间。一般设置1和2
    gzip_comp_level 2;
    # 进行压缩的文件类型。javascript有多种形式。其中的值可以在 mime.types 文件中找到。
    gzip_types text/plain application/javascript application/x-javascript text/css application/xml text/javascript application/x-httpd-php image/jpeg image/gif image/png;
    # 是否在http header中添加Vary: Accept-Encoding，建议开启
    gzip_vary on;
    # 禁用IE 6 gzip
    gzip_disable "MSIE [1-6]\.";
    # 设置缓存路径并且使用一块最大100M的共享内存，用于硬盘上的文件索引，包括文件名和请求次数，每个文件在1天内若不活跃（无请求）则从硬盘上淘汰，硬盘缓存最大10G，满了则根据LRU算法自动清除缓存。

    proxy_cache_path /nginx-web-cache levels=1:2 keys_zone=static_cache:100m max_size=10g inactive=1d use_temp_path=off;

    # History 模式
    # server {
    #   listen       2006; # 访问1314端口，如果找不到对应的server_name，默认用这个配置
    #   server_name  127.0.0.1;
    #   #error_page  404              /404.html;

    #   client_max_body_size 1024M;

    #   # redirect server error pages to the static page /50x.html
    #   #
    #   error_page   500 502 503 504  /50x.html;

    #   location /websocket {
    #     proxy_http_version 1.1;
    #     proxy_pass http://my_socket;
    #     proxy_read_timeout  60s;

    #     proxy_set_header      Host $host;
    #     proxy_set_header    X-Real_IP $remote_addr;
    #     proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
    #     proxy_set_header    Upgrade $http_upgrade;
    #     proxy_set_header    Connection Upgrade;
    #   }

    #   location ~ /robotservice/.*\.(?:jpg|jpeg|gif|png|ico|cur|gz|svg|svgz|txt|zip|gz|doc|docx|xls|xlsx)$ {
    #     proxy_pass   https://cloud.gosunyun.com;
    #     expires 30d;
    #     proxy_cache static_cache;
    #     proxy_cache_valid 200 302 7d;
    #     proxy_cache_valid 301 30d;
    #     proxy_cache_revalidate on;
    #     proxy_cache_use_stale error timeout updating http_500 http_502 http_503 http_504;
    #     proxy_cache_background_update on;
    #     add_header X-Cache-Status $upstream_cache_status;
    #     # proxy_cache_lock on;
    #   }

    #   location /robotservice { #添加访问目录为/apis的代理配置
    #     proxy_pass   https://cloud.gosunyun.com;
    #     proxy_set_header    X-Real_IP $remote_addr;
    #     proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
    #   }

    #   location /extend/getLocation {
    #     proxy_pass  https://map.baidu.com/;
    #     proxy_set_header    X-Real_IP $remote_addr;
    #     proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
    #   }


    #   # location /robotmgr {
    #   #   root  F://tmp//;
    #   #   index index.html;
    #   #   expires 1d;
    #   #   try_files $uri $uri/ /robotmgr/index.html?$args;
    #   # }

    #   # location /authority {
    #   #   root  F://tmp//;
    #   #   index index.html;
    #   #   expires 1d;
    #   #   try_files $uri $uri/ /authority/index.html?$args;
    #   # }

    #   # location ~ /(robotmgr|authority)/.*\.(?:js|css|jpg|jpeg|gif|png|ico|cur|gz|svg|svgz)$ {
    #   #     if ( $request_uri ~ ^/robotmgr )
    #   #     {
    #   #       set  $root_dir F://tmp//robot-mgr//;
    #   #     }
    #   #     if ( $request_uri ~ ^/authority )
    #   #     {
    #   #       set  $root_dir F://tmp//robot-auth//;
    #   #     }
    #   #     alias $root_dir;
    #   #     rewrite /robotmgr|authority/(.*) $1 break; 
    #   #     root F://tmp//;
    #   #     expires 30d;
    #   # }

    #   location /robotmgr {
    #     alias  F://robotmgr-web//dist;
    #     index index.html;
    #     expires 1d;
    #     try_files $uri $uri/ /robotmgr/index.html;
    #   }

    #   location /authority {
    #     alias  F://robot-auth-web//dist; 
    #     expires 1d;
    #     index index.html;
    #     try_files $uri $uri/ /authority/index.html; # 为什么在 alias 下带上$args就访问不了
    #   }

    #   location /mobile {
    #     alias  F://robot-mobile//dist; 
    #     expires 1d;
    #     index index.html;
    #     try_files $uri $uri/ /mobile/index.html; # 为什么在 alias 下带上$args就访问不了
    #   }

    #   location / {
    #     index /robotmgr/index.html;
    #     try_files $uri $uri/ /robotmgr/index.html?$args;
    #   }

    #   # rewrite ^/(authority.*) http://localhost:2007/$1 permanent;
    # }


    # server {
    #   listen       1314; # 访问1314端口，如果找不到对应的server_name，默认用这个配置
    #   server_name  localhost;
    #   client_max_body_size 1024M;
    #   root  F://softwaresData//web_G1_v1.0//dist//robotplatform;

    #   location /robotservice { #添加访问目录为/apis的代理配置
    #     proxy_pass   http://120.79.154.168:4001;
    #     proxy_set_header    X-Real_IP $remote_addr;
    #     proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
    #   }

    #   location /robotplatform {
    #     index index.html;
    #     expires 1d;
    #     try_files $uri $uri/ /index.html?$args;
    #   }
    # }

    server {
      listen  3001;
      server_name  localhost;
      client_max_body_size 1024M;

      error_page  404              /404.html;

      # redirect server error pages to the static page /50x.html
      #
      error_page   500 502 503 504  /50x.html;

      root F:\NodeDocRoot;

      location = /50x.html {
          root   html;
      }

      location ^~ /soms/ {
        proxy_pass   http://192.168.42.230:5001;
        proxy_set_header    X-Real_IP $remote_addr;
        proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
      }

      location / {
        index nodeServer.html;
        expires 1d;
      }
    }

    server {
      listen  3002;
      server_name  localhost;
      client_max_body_size 1024M;

      error_page  404              /404.html;

      # redirect server error pages to the static page /50x.html
      #
      error_page   500 502 503 504  /50x.html;

      root F:\ServerDocRoot;

      location = /50x.html {
          root   html;
      }

      location ^~ /soms/ {
        proxy_pass   http://192.168.42.230:5005;
        proxy_set_header    X-Real_IP $remote_addr;
        proxy_set_header    X-Forwarded-for $proxy_add_x_forwarded_for;
      }

      location / {
        index index.html;
        expires 1d;
      }
    }
}
