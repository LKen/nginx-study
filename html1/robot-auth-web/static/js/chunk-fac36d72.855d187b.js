(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fac36d72"],{"1a94":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("div",{ref:"toolbar",staticClass:"g-toolbar g-toolbar--inner"},[i("div",{staticClass:"g-toolbar__label"},[i("el-input",{attrs:{size:e.formSize,placeholder:"用户 或 手机号码"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.listQuery.username,callback:function(t){e.$set(e.listQuery,"username","string"===typeof t?t.trim():t)},expression:"listQuery.username"}},[i("i",{staticClass:"el-input__icon el-icon-ext-user",attrs:{slot:"prefix"},slot:"prefix"})])],1),e._v(" "),i("div",{staticClass:"g-toolbar__label"},[i("el-input",{attrs:{size:e.formSize,placeholder:"姓名"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.listQuery.nickname,callback:function(t){e.$set(e.listQuery,"nickname","string"===typeof t?t.trim():t)},expression:"listQuery.nickname"}},[i("i",{staticClass:"el-input__icon el-icon-ext-robot",attrs:{slot:"prefix"},slot:"prefix"})])],1),e._v(" "),i("div",{directives:[{name:"permission",rawName:"v-permission",value:["root"],expression:"['root']"}],staticClass:"g-toolbar__label"},[i("el-select",{attrs:{size:e.formSize,placeholder:"单位",clearable:""},on:{change:e.getList},model:{value:e.listQuery.companyCode,callback:function(t){e.$set(e.listQuery,"companyCode","string"===typeof t?t.trim():t)},expression:"listQuery.companyCode"}},[e._l(e.units,(function(e){return i("el-option",{key:e.id,attrs:{label:e.companyName,value:e.companyCode}})})),e._v(" "),i("i",{staticClass:"el-input__icon el-icon-ext-list",attrs:{slot:"prefix"},slot:"prefix"})],2)],1),e._v(" "),i("div",{staticClass:"g-toolbar__actions"},[i("span",{directives:[{name:"permission",rawName:"v-permission",value:["root","unit"],expression:"['root', 'unit']"}],staticClass:"action",on:{click:e.addUser}},[i("g-icon",{attrs:{"icon-class":"plus"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.plus")))])],1),e._v(" "),i("span",{staticClass:"action",on:{click:e.getList}},[i("g-icon",{attrs:{"icon-class":"search"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.search")))])],1)])]),e._v(" "),i("div",{staticClass:"form-wrapper"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.list,"row-key":e.rowKey,fit:"","empty-text":e.emptyText,"highlight-current-row":"","max-height":e.tableHeight}},[i("el-table-column",{attrs:{align:e.textAlign,label:"头像",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(e){return[e.row.customerIcoUrl?i("fancy-box",{attrs:{url:e.row.customerIcoUrl}}):i("img",{staticClass:"g-table__img",attrs:{src:s("de2b"),alt:"avatar"}})]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"ID",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.id)))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"账号"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.username)))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"姓名"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.customerNickname)))]}}])}),e._v(" "),e.$g_checkPermission(["root","unit"])?i("el-table-column",{attrs:{align:e.textAlign,label:"单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.companyName)))]}}],null,!1,3470662948)}):e._e(),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"角色"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.roleName)))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"最近登录"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.lastLogindate)))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"关联机器人数"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("span",{class:+t.row.deviceCount>0?"g-table__font--success":"g-table__font--danger"},[e._v(e._s(e._f("defaultValue")(t.row.deviceCount)))])]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"登录次数"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("defaultValue")(t.row.customerLoginTimes)))]}}])}),e._v(" "),e.$g_checkPermission(["root","unit"])?i("el-table-column",{attrs:{align:e.textAlign,label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-edit g-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(s){return e.edit(t.row)}}}),e._v(" "),i("el-tooltip",{attrs:{effect:"dark",content:"重置密码",placement:"top"}},[i("i",{staticClass:"el-icon-ext-password-reset g-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(s){return e.reset(t.row)}}})]),e._v(" "),i("i",{staticClass:"el-icon-delete g-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(s){return e.del(t.row)}}})]}}],null,!1,4053847106)}):e._e()],1),e._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":e.listQuery.page,"page-sizes":[15,30,45,60],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!0,top:"20vh",title:e.dialogUserTitle,visible:e.dialogUserVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"800px"},on:{"update:visible":function(t){e.dialogUserVisible=t},open:e.openDialog,close:e.closeDialog}},[i("div",{staticClass:"left fl"},[i("el-form",{ref:"dataForm",staticStyle:{width:"100%"},attrs:{rules:e.rules,model:e.temp,"label-position":"right",size:e.formSize,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"账号",prop:"username"}},[i("el-input",{attrs:{placeholder:"",autocomplete:"off",disabled:e.modified},model:{value:e.temp.username,callback:function(t){e.$set(e.temp,"username","string"===typeof t?t.trim():t)},expression:"temp.username"}})],1),e._v(" "),e.modified?e._e():i("el-form-item",{attrs:{label:"密码",prop:"password"}},[i("el-input",{attrs:{placeholder:"","show-password":"",autocomplete:"off"},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password","string"===typeof t?t.trim():t)},expression:"temp.password"}})],1),e._v(" "),e.modified?e._e():i("el-form-item",{attrs:{label:"重复密码",prop:"password2"}},[i("el-input",{attrs:{placeholder:"","show-password":""},model:{value:e.temp.password2,callback:function(t){e.$set(e.temp,"password2","string"===typeof t?t.trim():t)},expression:"temp.password2"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"身份证",prop:"idCardNo"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.temp.idCardNo,callback:function(t){e.$set(e.temp,"idCardNo","string"===typeof t?t.trim():t)},expression:"temp.idCardNo"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"姓名",prop:"nickname"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.temp.nickname,callback:function(t){e.$set(e.temp,"nickname","string"===typeof t?t.trim():t)},expression:"temp.nickname"}})],1),e._v(" "),i("el-form-item",{directives:[{name:"permission",rawName:"v-permission",value:["root"],expression:"['root']"}],attrs:{label:"所在单位",prop:"companyCode"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",disabled:e.modified,placeholder:"默认 - 请选择用户单位"},model:{value:e.temp.companyCode,callback:function(t){e.$set(e.temp,"companyCode",t)},expression:"temp.companyCode"}},e._l(e.units,(function(e){return i("el-option",{key:e.id,attrs:{label:e.companyName,value:e.companyCode}})})),1)],1),e._v(" "),i("el-form-item",{attrs:{label:"角色分配",prop:"roleId"}},[i("el-select",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:"默认 - 请选择用户角色"},model:{value:e.temp.roleId,callback:function(t){e.$set(e.temp,"roleId",t)},expression:"temp.roleId"}},e._l(e.computedRoles,(function(e){return i("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),e._v(" "),i("div",{staticClass:"right"},[i("div",{staticClass:"g-cropper"},[i("div",{staticClass:"g-cropper-input"},[i("el-upload",{attrs:{action:"",accept:"image/jpeg, image/png","auto-upload":!1,"show-file-list":!1,"on-change":e.changeFiles}},[i("div",[i("span",[e._v("上传头像")]),i("small",[e._v("（只能上传jpg/png文件）")])])])],1),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showCropper,expression:"showCropper"}],staticClass:"g-cropper-image"},[i("img",{ref:"croppedImg",attrs:{src:"",alt:"裁剪区域"}})]),e._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:e.showCropper,expression:"showCropper"}],staticClass:"g-cropper-preview"},[i("p",{staticClass:"text"},[i("span",[e._v("预览")])]),e._v(" "),i("div",{staticClass:"g-cropper-preview__img",staticStyle:{width:"96px",height:"96px",overflow:"hidden"}})])])]),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogUserVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],on:{click:e.saveUser}},[e._v("保存")])],1)]),e._v(" "),i("g-pass-reset",{attrs:{row:e.row,visible:e.dialogRessetVisible},on:{"update:visible":function(t){e.dialogRessetVisible=t}}})],1)},a=[],o=(s("20d6"),s("96cf"),s("3b8d")),r=s("db72"),n=s("2f62"),l=s("365c"),c=(s("6107"),s("bab4")),d=s.n(c),p=s("61f7"),u=s("ed08"),m=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("el-dialog",{attrs:{"append-to-body":!0,top:"25vh",title:"重置密码",visible:e.dialogVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,"before-close":e.handleBeforeClose,width:"500px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[s("el-form",{ref:"dataForm",staticStyle:{width:"80%",margin:"0 auto"},attrs:{rules:e.rules,model:e.temp,size:e.formSize,"label-position":"left","label-width":"100px"}},[s("el-form-item",{attrs:{label:"新密码",prop:"password"}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:""},model:{value:e.temp.password,callback:function(t){e.$set(e.temp,"password","string"===typeof t?t.trim():t)},expression:"temp.password"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"重复新密码",prop:"password2"}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:""},model:{value:e.temp.password2,callback:function(t){e.$set(e.temp,"password2","string"===typeof t?t.trim():t)},expression:"temp.password2"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"管理员密码",prop:"adminPassword"}},[s("el-input",{attrs:{type:"password","show-password":"",placeholder:""},model:{value:e.temp.adminPassword,callback:function(t){e.$set(e.temp,"adminPassword","string"===typeof t?t.trim():t)},expression:"temp.adminPassword"}})],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:e.handleCloseDialog}},[e._v("取消")]),e._v(" "),s("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],on:{click:e.handleSavePassword}},[e._v("保存")])],1)],1)},f=[],g=s("6aea"),v=s.n(g),h=l["b"].resetPassword,b={name:"GPassReset",props:{row:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1}},data:function(){var e=this,t=function(t,s,i){var a=e.temp.password;a!==s&&i(new Error("两次密码输入不一致")),i()};return{formSize:"mini",needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,source:this.row,temp:{userId:"",adminPassword:"",password:"",password2:""},sending:!1,rules:{adminPassword:[{required:!0,message:"管理员密码不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],password2:[{required:!0,message:"请再输入一次密码",trigger:"blur"},{trigger:"blur",validator:t}]}}},watch:{row:function(e,t){this.source=Object.assign({},e)},visible:function(e){this.dialogVisible=e}},created:function(){},mounted:function(){},methods:{handleBeforeClose:function(e){this.temp={userId:"",adminPassword:"",password:"",password2:""},this.$emit("update:visible",!1),this.$refs["dataForm"].clearValidate(),e()},handleCloseDialog:function(){this.temp={userId:"",adminPassword:"",password:"",password2:""},this.$emit("update:visible",!1),this.$refs["dataForm"].clearValidate(),this.dialogVisible=!1},handleSavePassword:function(){var e=this,t=this.source;this.temp=Object.assign({},this.temp,{userId:t.id}),this.$refs["dataForm"].validate((function(t){t&&(e.temp.adminPassword=v()(e.temp.adminPassword),e.temp.password=v()(e.temp.password),e.temp.password2="",h(e.temp).then((function(t){e.$message.success(t.msg),e.$emit("submit",Object.assign({},t.data)),e.$nextTick((function(){e.handleCloseDialog()}))}),(function(e){console.log(e)})))}))}}},w=b,_=(s("a92e"),s("2877")),y=Object(_["a"])(w,m,f,!1,null,"0d0f8014",null),C=y.exports,k=l["b"].modifyCustomer,x=l["b"].getRolesList,$=l["b"].addCustomer,S=l["b"].selectCustomerCompany,I=l["b"].searchCustomerByParam,L=l["b"].deleteCustomer,V={name:"ClientMgr",components:{GPassReset:C},data:function(){var e=this,t=function(e,t,s){t?Object(p["b"])(t)?s():s(new Error("身份证格式错误")):s()},s=function(t,s,i){var a=e.temp.password;a!==s?i(new Error("两次密码输入不一致")):i()};return{emptyText:null,textAlign:"center",tableHeight:650,list:[],total:null,listLoading:!0,formSize:"small",listQuery:{page:1,limit:15,username:"",nickname:""},needModal:!0,closeOnClickModel:!1,sending:!1,dialogUserTitle:"",dialogUserVisible:!1,temp:{userId:"",username:"",nickname:"",roleId:"",idCardNo:"",companyCode:null,password:"",password2:"",file:null},modified:!1,rules:{username:[{required:!0,message:"账号不能为空",trigger:"blur"}],password:[{required:!0,message:"密码不能为空",trigger:"blur"}],password2:[{required:!0,message:"请再输入一次密码",trigger:"blur"},{trigger:"blur",validator:s}],idCardNo:[{trigger:"blur",validator:t}],nickname:[{required:!0,message:"姓名不能为空",trigger:"blur"}],companyCode:[{required:!0,message:"单位不能为空",trigger:"blur"}]},units:[],rolesList:[],dialogRessetVisible:!1,row:{},showCropper:!1}},computed:Object(r["a"])({computedRoles:function(){var e=this;return this.temp.companyCode?this.rolesList.filter((function(t){return t.e_code===e.temp.companyCode||"admin"===t.e_code})):this.rolesList}},Object(n["b"])(["eCode"])),created:function(){},mounted:function(){this.getList(),this.getUnits()},methods:{openDialog:function(){this.getRoles()},closeDialog:function(){this.cropper&&this.cropper.destroy(),this.cropper=null},getList:function(){var e=this;this.listLoading=!0,this.emptyText=null,I(this.listQuery).then((function(t){e.list=t.data.rows,e.total=t.data.total,e.listLoading=!1}),(function(t){console.log(t),e.listLoading=!1,e.emptyText="网络错误"}))},getUnits:function(){var e=this;"admin"!==this.eCode||this.units.length>0||S({page:1,limit:999}).then((function(t){e.units=t.data.rows}),(function(e){console.log(e)}))},getRoles:function(){var e=this;0===this.rolesList.length&&x().then((function(t){e.rolesList=t.data.rows}))},addUser:function(){var e=this;this.dialogUserTitle="添加用户",this.modified=!1,this.dialogUserVisible=!0,this.showCropper=!1,this.temp={userId:"",username:"",nickname:"",roleId:"",idCardNo:"",companyCode:null,password:"",password2:"",file:null},this.$nextTick((function(){e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))},rowKey:function(e){return e.id},handleSizeChange:function(e){this.listQuery.limit=e,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()},edit:function(e){var t=this,s=e.id,i=e.username,a=e.customerNickname,o=e.eCode,r=e.roleId,n=void 0===r?"":r,l=e.idCardNo;this.temp=Object.assign(this.temp,{userId:s,username:i,nickname:a,idCardNo:l,roleId:n,companyCode:o,file:null}),this.showCropper=!1,this.modified=!0,this.dialogUserTitle="编辑用户",this.dialogUserVisible=!0,this.$nextTick((function(){t.$refs["dataForm"]&&t.$refs["dataForm"].clearValidate()}))},del:function(e){var t=this,s=e.id;this.$confirm("此操作将永久删除该用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){L({userId:s}).then((function(s){t.$message.success(s.msg);var i=t.list.indexOf(e);i>-1&&t.list.splice(i,1)}),(function(e){console.log(e)}))})).catch((function(){}))},reset:function(e){this.row=e,this.dialogRessetVisible=!0},saveUser:function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.$refs["dataForm"].validate(function(){var e=Object(o["a"])(regeneratorRuntime.mark((function e(s){var i,a,o,r,n,l,c,d,p,m,f;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(e.prev=0,!s){e.next=26;break}if(i=t._.cloneDeep(t.temp),!t.cropper){e.next=8;break}return e.next=6,t.getCroppedImage();case 6:a=e.sent,a instanceof Blob&&a.size>0?i.file=a:(o=Object(u["a"])(a),i.file=o);case 8:if(t.sending=!0,!t.modified){e.next=19;break}return n=i.userId,l=i.nickname,c=i.idCardNo,d=i.roleId,p=i.file,e.next=13,k({userId:n,nickname:l,idCardNo:c,roleId:d,file:p});case 13:r=e.sent,m=t.list,f=t._.findIndex(m,{id:n}),f>-1&&m.splice(f,1,Object.assign({},r.data)),e.next=23;break;case 19:return e.next=21,$(i);case 21:r=e.sent,t.getList();case 23:t.$message.success(r.msg),t.dialogUserVisible=!1,t.sending=!1;case 26:e.next=32;break;case 28:e.prev=28,e.t0=e["catch"](0),t.sending=!1,console.log(e.t0);case 32:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(t){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getCroppedImage:function(){var e=this;return new Promise((function(t,s){var i=e.cropper.getCroppedCanvas({width:160,height:160,imageSmoothingQuality:"low"});i.toBlob?i.toBlob((function(e){t(e)})):i.msToBlob?t(i.msToBlob()):t(i.toDataURL())}))},changeFiles:function(e,t){var s=this,i=e.raw,a=function(e){s.showCropper=!0,s.$refs["croppedImg"].src=e,s.$nextTick(s.initCropper)};if(URL)a(URL.createObjectURL(i));else if(FileReader){var o=new FileReader;o.onload=function(e){a(o.result)},o.readAsDataURL(i)}},initCropper:function(){this.cropper&&(this.cropper.destroy(),this.cropper=null),this.cropper=new d.a(this.$refs["croppedImg"],{aspectRatio:1,preview:".g-cropper-preview__img",dragMode:"move"})}}},N=V,O=(s("4315"),Object(_["a"])(N,i,a,!1,null,"352a5827",null));t["default"]=O.exports},"2c9f":function(e,t,s){},4315:function(e,t,s){"use strict";var i=s("f64b"),a=s.n(i);a.a},a92e:function(e,t,s){"use strict";var i=s("2c9f"),a=s.n(i);a.a},de2b:function(e,t,s){e.exports=s.p+"static/img/avatar.ecba1844.gif"},f64b:function(e,t,s){}}]);