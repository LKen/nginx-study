(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-27d0985f"],{a9ae:function(e,t,i){"use strict";var a=i("de07"),l=i.n(a);l.a},ddb0:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container bg"},[i("div",{staticClass:"card bg"},[i("section",{staticClass:"left fl flex"},[i("Toolbar",{attrs:{name:"预览",auto:!1}},[i("span",{directives:[{name:"permission",rawName:"v-permission",value:["root","unit"],expression:"['root', 'unit']"}],staticClass:"action",on:{click:e.handlePlus}},[i("g-icon",{attrs:{"icon-class":"plus"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.plus")))])],1),e._v(" "),i("span",{directives:[{name:"permission",rawName:"v-permission",value:["root","unit"],expression:"['root', 'unit']"}],staticClass:"action",on:{click:e.updateTree}},[i("g-icon",{attrs:{"icon-class":"save"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.save")))])],1),e._v(" "),i("span",{directives:[{name:"permission",rawName:"v-permission",value:["root","unit"],expression:"['root', 'unit']"}],staticClass:"action",on:{click:e.exportExcel}},[i("g-icon",{attrs:{"icon-class":"download"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v("模板")])],1)]),e._v(" "),i("div",{staticClass:"tree__filter"},[i("el-input",{attrs:{size:e.formSize,placeholder:"关键内容"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}},[i("i",{staticClass:"el-input__icon el-icon-ext-search",staticStyle:{cursor:"pointer"},attrs:{slot:"suffix"},slot:"suffix"})])],1),e._v(" "),i("p",{staticClass:"tip"},[e._v("提示：按住文字，拖动鼠标可移动位置")]),e._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:!0===e.saving,expression:"saving === true"}],staticClass:"tree-preview"},[i("el-scrollbar",[i("el-tree",{ref:"tree",attrs:{data:e.list,"node-key":"id","empty-text":e.emptyText,"filter-node-method":e.filterNode,props:e.defaultProps,"highlight-current":"","expand-on-click-node":!1,draggable:"","allow-drag":e.allowDrag,"allow-drop":e.allowDrop},on:{"node-click":e.handleNodeClick},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,l=t.data;return i("span",{staticClass:"custom-tree-node"},[i("g-icon",{attrs:{"icon-class":"system"===l.type?"home":"menu"===l.type?"description":"tool"}}),e._v(" "),i("span",[e._v(e._s(a.label))])],1)}}])})],1)],1)],1),e._v(" "),i("section",{staticClass:"right"},[i("Toolbar",{attrs:{name:"权限配置",auto:!1}},[i("span",{directives:[{name:"permission",rawName:"v-permission",value:["root","unit"],expression:"['root', 'unit']"}],staticClass:"action",on:{click:e.handlePlusAppMenu}},[i("g-icon",{attrs:{"icon-class":"plus"}}),e._v(" "),i("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.plus")+"权限"))])],1)]),e._v(" "),i("div",{staticClass:"form-wrapper"},[i("el-table",{ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.tableList,"row-key":e.rowKey,fit:"",border:"","empty-text":e.treeEmptyText,"highlight-current-row":"","max-height":e.tableHeight}},[i("el-table-column",{attrs:{align:e.textAlign,label:"序号",sortable:"","sort-by":"id",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.id||"暂无"))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"权限名称",width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.label||"暂无"))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"权限编码"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.code||"暂无"))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"权限描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.description||"暂无"))]}}])}),e._v(" "),i("el-table-column",{attrs:{align:e.textAlign,label:"权限类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("filterType")(t.row.type)))]}}])}),e._v(" "),e.$g_checkPermission(["root","unit"])?i("el-table-column",{attrs:{align:e.textAlign,label:"操作",width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("i",{staticClass:"el-icon-edit g-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return e.handleEditAppMenu(t.row)}}}),e._v(" "),i("i",{staticClass:"el-icon-delete g-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return e.handleDeleteAppMenu(t.row)}}})]}}],null,!1,2895188944)}):e._e()],1),e._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":e.listQuery.page,"page-sizes":[10,20,30,50],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1)],1)]),e._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!0,top:"25vh",title:e.dialogTitle,visible:e.dialogVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"450px"},on:{"update:visible":function(t){e.dialogVisible=t}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"90%",margin:"0 auto"},attrs:{rules:e.rules,model:e.temp,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"系统名称",prop:"label"}},[i("el-input",{attrs:{size:e.formSize,placeholder:""},model:{value:e.temp.label,callback:function(t){e.$set(e.temp,"label","string"===typeof t?t.trim():t)},expression:"temp.label"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"系统编号",prop:"code"}},[i("el-input",{attrs:{size:e.formSize,placeholder:""},model:{value:e.temp.code,callback:function(t){e.$set(e.temp,"code","string"===typeof t?t.trim():t)},expression:"temp.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"导入Excel",prop:"filename"}},[i("el-input",{staticClass:"form-item",attrs:{placeholder:""},model:{value:e.temp.filename,callback:function(t){e.$set(e.temp,"filename","string"===typeof t?t.trim():t)},expression:"temp.filename"}},[i("template",{slot:"append"},[i("span",{staticClass:"form-item__uploadTxt",on:{click:e.handleUploadFile}},[e._v("上传文件")]),e._v(" "),i("input",{staticClass:"form-item__upload",attrs:{type:"file",accept:".xlsx,.xls",name:"txt"},on:{change:function(t){return e.handleFileChange(t)}}})])],2)],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],on:{click:e.handleSave}},[e._v("保存")])],1)],1),e._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!0,top:"25vh",title:e.dialogTitle,visible:e.dialogAppVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"500px"},on:{"update:visible":function(t){e.dialogAppVisible=t}}},[i("table",{staticClass:"app-table",attrs:{cellspacing:"0",cellpadding:"0",border:"0"}},[i("thead",[i("tr",[i("th",[e._v("序号")]),i("th",[e._v("系统名称")]),i("th",[e._v("优先级显示")])])]),e._v(" "),i("draggable",{staticClass:"table-drag",attrs:{animation:200,group:"description",disabled:!1,"ghost-class":"ghost",handle:".form-item__move"},on:{start:function(t){e.drag=!0},end:function(t){e.drag=!1}},model:{value:e.list,callback:function(t){e.list=t},expression:"list"}},e._l(e.list,(function(t){return i("div",{key:t.id,staticClass:"table-drag__tr"},[i("span",{staticClass:"table-drag__td"},[e._v(e._s(e._f("defaultValue")(t.id)))]),e._v(" "),i("span",{staticClass:"table-drag__td"},[e._v(e._s(e._f("defaultValue")(t.label)))]),e._v(" "),i("span",{staticClass:"table-drag__td"},[i("g-icon",{staticClass:"form-item__move",staticStyle:{cursor:"pointer"},attrs:{"icon-class":"move"}})],1)])})),0)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogAppVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],on:{click:e.updateTree}},[e._v("保存")])],1)]),e._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!0,top:"25vh",title:e.dialogTitle,visible:e.dialogMenuVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"450px"},on:{"update:visible":function(t){e.dialogMenuVisible=t}}},[i("el-form",{ref:"dataForm2",staticStyle:{width:"90%",margin:"0 auto"},attrs:{rules:e.rules2,model:e.temp2,size:e.formSize,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"权限名称",prop:"label"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.temp2.label,callback:function(t){e.$set(e.temp2,"label","string"===typeof t?t.trim():t)},expression:"temp2.label"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"权限编号",prop:"code"}},[i("el-input",{attrs:{placeholder:""},model:{value:e.temp2.code,callback:function(t){e.$set(e.temp2,"code","string"===typeof t?t.trim():t)},expression:"temp2.code"}})],1),e._v(" "),i("el-form-item",{attrs:{label:"菜单类型",prop:"type"}},[i("el-select",{attrs:{placeholder:"选择类型",clearable:""},model:{value:e.temp2.type,callback:function(t){e.$set(e.temp2,"type",t)},expression:"temp2.type"}},[i("el-option",{attrs:{label:"菜单",value:"menu"}}),e._v(" "),i("el-option",{attrs:{label:"功能",value:"function"}})],1)],1),e._v(" "),i("el-form-item",{attrs:{label:"权限描述",prop:"description"}},[i("el-input",{attrs:{type:"textarea",rows:4,placeholder:""},model:{value:e.temp2.description,callback:function(t){e.$set(e.temp2,"description","string"===typeof t?t.trim():t)},expression:"temp2.description"}})],1)],1),e._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.dialogMenuVisible=!1}}},[e._v("取消")]),e._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],on:{click:e.handleMenuSave}},[e._v("保存")])],1)],1)],1)},l=[],n=(i("7f7f"),i("365c")),s=i("ed08"),o=i("310e"),r=i.n(o),c=n["b"].addAPPSystem,d=n["b"].getAppMenuTree,p=n["b"].updateAppMenuTree,u=n["b"].deleteAppMenu,m=n["b"].saveAppMenu,g={name:"MenuMgr",filters:{filterType:function(e){var t="";switch(e){case"menu":t="菜单";break;case"function":t="功能";break}return t}},components:{draggable:r.a},data:function(){return{emptyText:null,textAlign:"left",tableHeight:650,list:[],total:null,listLoading:!0,formSize:"small",listQuery:{page:1,limit:10},dialogTitle:"",needModal:!0,closeOnClickModel:!1,dialogVisible:!1,sending:!1,temp:{rootId:"-1",parentId:"-1",checked:!1,open:!1,iconSkin:"app",label:"",disabled:!1,isLeaf:!1,code:"",id:"",type:"system",description:"",children:"",filename:"",excelFile:null},rules:{label:[{required:!0,message:"系统名称不能为空",trigger:"blur"}],code:[{required:!0,message:"系统编号不能为空",trigger:"blur"}]},rules2:{label:[{required:!0,message:"权限名称不能为空",trigger:"blur"}],code:[{required:!0,message:"权限编号不能为空",trigger:"blur"}],type:[{required:!0,message:"权限类型不能为空",trigger:"blur"}],description:[{required:!0,message:"权限描述不能为空",trigger:"blur"}]},dialogAppVisible:!1,dialogMenuVisible:!1,temp2:{id:"",code:"",parentId:"",rootId:"",checked:!1,open:!1,iconSkin:"",label:"",disabled:!1,isLeaf:!1,type:"",description:"",children:""},treeEmptyText:"请点击左侧菜单项(文字)",defaultProps:{type:"type"},filterText:"",saving:!1,tableList:[]}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},mounted:function(){this.getList()},methods:{getList:function(){var e=this;this.listLoading=!0,this.emptyText=null,d().then((function(t){e.list=t.data,e.listLoading=!1}),(function(t){console.log(t),e.listLoading=!1,e.emptyText="网络错误"}))},rowKey:function(e){return e.id},handleSizeChange:function(e){this.listQuery.limit=e,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList()},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},handleNodeClick:function(e,t){var i=e.children,a=e.type;return"function"!==a&&(this.treeEmptyText="",this.tableList=Array.isArray(i)&&i.length>0?i:[]),!1},allowDrag:function(e){return"funciton"!==e.data.type},allowDrop:function(e,t,i){return"system"===e.data.type&&"system"===t.data.type?"inner"!==i:"menu"===e.data.type&&"menu"===t.data.type&&e.data.rootId===t.data.rootId},handlePlus:function(){var e=this;this.dialogVisible=!0,this.dialogTitle="添加应用系统",this.temp={rootId:"-1",parentId:"-1",checked:!1,open:!1,iconSkin:"app",label:"",disabled:!1,isLeaf:!1,code:"",id:"",type:"system",description:"",children:"",filename:"",excelFile:null},this.$nextTick((function(){e.$refs["dataForm"].$el.querySelector('input[type="file"]').value="",e.$refs["dataForm"]&&e.$refs["dataForm"].clearValidate()}))},handleManage:function(){this.dialogAppVisible=!0,this.dialogTitle="配置应用系统"},updateTree:function(){var e=this,t=this.list,i=this._.cloneDeep(t);this.saving=!0,p(i).then((function(t){e.$message.success(t.msg),e.saving=!1,e.$nextTick((function(){e.dialogAppVisible=!1}))}),(function(t){e.saving=!1,console.log(t)}))},handleSave:function(){var e=this,t=c;this.$refs["dataForm"].validate((function(i){if(i){var a=e._.cloneDeep(e.temp);e.sending=!0,t(a).then((function(t){e.$message.success(t.msg),e.sending=!1,e.getList(),e.$nextTick((function(){e.dialogVisible=!1}))}),(function(t){e.sending=!1,console.log(t)}))}}))},handlePlusAppMenu:function(){var e=this,t=this.$refs["tree"].getCurrentNode();if(!t)return this.$message({message:"请选择左侧的任一项菜单",type:"warning"}),!1;var i=t.rootId,a=t.id,l=t.type;if("function"===l)return this.$message({message:"功能项无法添加下级权限",type:"warning"}),!1;this.dialogMenuVisible=!0,this.dialogTitle="添加下级权限",this.temp2={rootId:-1===+i?a:i,parentId:a,checked:!1,open:!1,iconSkin:"",label:"",disabled:!1,isLeaf:!1,code:"",id:"",type:"",description:"",children:""},this.$nextTick((function(){e.$refs["dataForm2"]&&e.$refs["dataForm2"].clearValidate()}))},handleEditAppMenu:function(e){var t=this;this.dialogMenuVisible=!0,this.dialogTitle="编辑下级权限",this.temp2=Object.assign({},this.temp2,e),this.$nextTick((function(){t.$refs["dataForm2"]&&t.$refs["dataForm2"].clearValidate()})),console.log(e)},handleDeleteAppMenu:function(e){var t=this,i=e.id;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){u({appMenuId:i}).then((function(a){t.$message.success(a.msg);var l=t.$refs["tree"].getNode(i),n=l.parent.data.children||l.parent.data;n&&n.splice(n.indexOf(e),1)}),(function(e){console.log(e)}))})).catch((function(){}))},handleMenuSave:function(){var e=this,t=this.temp2.id,i=m;this.$refs["dataForm2"].validate((function(a){if(a){var l=e._.cloneDeep(e.temp2);l.children="",e.sending=!0,i(l).then((function(i){if(e.$message.success(i.msg),t){var a=l.label,n=l.code,s=l.type,o=l.description,r=e.$refs["tree"].getNode(t),c=r.parent.data.children||r.parent.data;c&&c.splice(c.indexOf(r.data),1,Object.assign({},r.data,{label:a,code:n,type:s,description:o}))}else{l.id=i.data.id;var d=e.$refs["tree"].getCurrentNode();Array.isArray(d.children)?d.children.push(l):e.$set(d,"children",[l]),e.handleNodeClick(d)}e.sending=!1,e.$nextTick((function(){e.dialogMenuVisible=!1}))}),(function(t){e.sending=!1,console.log(t)}))}}))},handleUploadFile:function(e){var t=e.target;t.className.indexOf("form-item__uploadTxt")>-1&&t.nextElementSibling&&t.nextElementSibling.click()},handleFileChange:function(e){var t=e.target.files;if(0===t.length)return!1;Object(s["f"])([].slice.call(t)[0],".xlsx,.xls")?(this.temp.excelFile=t[0],this.temp.filename=t[0].name):this.$message.error("所选文件类型不符合")},exportExcel:function(){window.open("/robotservice/user/getAppSystemExcelTemplate.action","_blank")}}},f=g,v=(i("a9ae"),i("2877")),h=Object(v["a"])(f,a,l,!1,null,"a27bb90c",null);t["default"]=h.exports},de07:function(e,t,i){}}]);