(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6676636a"],{"3f2a":function(e,t,l){"use strict";l.r(t);var a=function(){var e=this,t=e.$createElement,l=e._self._c||t;return l("div",{staticClass:"app-container new bg with-pagination"},[l("div",{staticClass:"card",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[l("div",{staticClass:"card-title"},[l("Toolbar",{attrs:{name:e.filename,"prefix-icon":"back"},on:{"prefix-callback":e.goBack}},[l("span",{staticClass:"action",on:{click:e.getList}},[l("svg-icon",{attrs:{"icon-class":"search"}}),e._v(" "),l("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.search")))])],1),e._v(" "),l("el-dropdown",{staticClass:"action",attrs:{trigger:"click"},on:{command:e.handleCommand}},[l("span",[l("svg-icon",{attrs:{"icon-class":"download"}}),e._v(" "),l("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.download")))])],1),e._v(" "),l("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[l("el-dropdown-item",{attrs:{"data-table-action":"excel",command:"xlsx"}},[e._v("\n              Excel (.xlsx)\n            ")])],1)],1)],1)],1),e._v(" "),l("div",{staticClass:"card-body"},[l("el-row",{staticClass:"filter-container",attrs:{gutter:20}},[l("el-col",{attrs:{xs:12,sm:8,md:4}},[l("el-input",{staticClass:"filter-item",attrs:{size:e.searchSize,placeholder:"机器人名称"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.getList(t)}},model:{value:e.listQuery.deviceName,callback:function(t){e.$set(e.listQuery,"deviceName",t)},expression:"listQuery.deviceName"}},[l("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"robot"},slot:"prefix"})],1)],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:6,md:3}},[l("el-select",{staticClass:"filter-item",attrs:{placeholder:"告警类型",clearable:"",size:e.searchSize},on:{change:e.getList},model:{value:e.listQuery.alarmType,callback:function(t){e.$set(e.listQuery,"alarmType",t)},expression:"listQuery.alarmType"}},[e._l(e.typeList,function(e){return l("el-option",{key:e.alarmType,attrs:{label:e.alarmName,value:e.alarmType}})}),e._v(" "),l("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"list"},slot:"prefix"})],2)],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:6,md:3}},[l("el-select",{staticClass:"filter-item",attrs:{placeholder:"告警级别",clearable:"",size:e.searchSize},on:{change:e.getList},model:{value:e.listQuery.alarmLevel,callback:function(t){e.$set(e.listQuery,"alarmLevel",t)},expression:"listQuery.alarmLevel"}},[e._l(e.selectOptions,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),e._v(" "),l("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"list"},slot:"prefix"})],2)],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:6,md:3}},[l("el-select",{staticClass:"filter-item",attrs:{placeholder:"是否确认",clearable:"",size:e.searchSize},on:{change:e.getList},model:{value:e.listQuery.confirm,callback:function(t){e.$set(e.listQuery,"confirm",t)},expression:"listQuery.confirm"}},[e._l(e.selectOptions2,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),e._v(" "),l("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"list"},slot:"prefix"})],2)],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:6,md:3}},[l("el-select",{staticClass:"filter-item",attrs:{placeholder:"是否结束",clearable:"",size:e.searchSize},on:{change:e.getList},model:{value:e.listQuery.closedCycle,callback:function(t){e.$set(e.listQuery,"closedCycle",t)},expression:"listQuery.closedCycle"}},[e._l(e.selectOptions3,function(e){return l("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),e._v(" "),l("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"list"},slot:"prefix"})],2)],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:8,md:4}},[l("el-date-picker",{staticClass:"filter-item",attrs:{size:e.searchSize,type:"datetime",placeholder:"开始时间","picker-options":e.pickerOptions,align:"right","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.listQuery.startTime,callback:function(t){e.$set(e.listQuery,"startTime",t)},expression:"listQuery.startTime"}})],1),e._v(" "),l("el-col",{attrs:{xs:12,sm:8,md:4}},[l("el-date-picker",{staticClass:"filter-item",attrs:{size:e.searchSize,type:"datetime",placeholder:"结束时间","picker-options":e.pickerOptions,align:"right","value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:e.listQuery.stopTime,callback:function(t){e.$set(e.listQuery,"stopTime",t)},expression:"listQuery.stopTime"}})],1)],1),e._v(" "),l("div",{staticClass:"card-table"},[l("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.listLoading,expression:"listLoading"}],ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:e.list,"row-key":e.rowKey,fit:"","empty-text":e.emptyText,"highlight-current-row":""}},[l("el-table-column",{attrs:{align:e.tableAlign,label:"机器人名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.deviceName||"--"))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警类型(Zh)"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.alarmLevel?l("span",{staticStyle:{color:"#DC4B3F"}},[e._v(e._s(t.row.alarmNameZh))]):2===t.row.alarmLevel?l("span",{staticStyle:{color:"#E67F22"}},[e._v(e._s(t.row.alarmNameZh))]):3===t.row.alarmLevel?l("span",{staticStyle:{color:"#F1C40F"}},[e._v(e._s(t.row.alarmNameZh))]):l("span",[e._v("--")])]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警级别",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.alarmLevel?l("span",{staticStyle:{color:"#DC4B3F"}},[e._v("严重")]):2===t.row.alarmLevel?l("span",{staticStyle:{color:"#E67F22"}},[e._v("重要")]):3===t.row.alarmLevel?l("span",{staticStyle:{color:"#F1C40F"}},[e._v("一般")]):l("span",[e._v("--")])]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警值",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alarmValue||"--"))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警开始时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alarmBeginTime||"--"))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警结束时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.alarmEndTime||"--"))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"位置"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.position))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"是否确认",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.ifConfirmText))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"确认人"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.confirmUsername))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"确认时间",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(t.row.confirmTime))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警图片"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.pics.length>0?e._l(t.row.pics,function(e,t){return l("fancyBox",{key:t,staticStyle:{margin:"2px"},attrs:{url:e.picUrl}})}):[e._v("暂无")]]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"告警状态",width:"80px"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(e._s(e._f("filterAlarmStatus")(t.row.alarmStatus)))]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"处理文件"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.confirmFile?[l("a",{attrs:{target:"_blank",href:t.row.confirmFile,download:t.row.alarmNameZh+"-"+t.row.id+"-告警附件",title:t.row.confirmFile}},[l("i",{staticClass:"el-icon-download card-table__icon"})]),e._v(" "),l("i",{staticClass:"el-icon-delete card-table__icon",on:{click:function(l){return e.handleDeleteFile(t.row)}}})]:l("span",[e._v("--")])]}}])}),e._v(" "),l("el-table-column",{attrs:{align:e.tableAlign,label:"操作",fixed:"right",width:"140px"},scopedSlots:e._u([{key:"default",fn:function(t){return[l("el-tooltip",{attrs:{effect:"dark",content:"查看告警流程",placement:"top"}},[l("i",{staticClass:"el-icon-view card-table__icon",on:{click:function(l){return e.handleAlarmView(t.row)}}})]),e._v(" "),l("el-tooltip",{attrs:{effect:"dark",content:"查看告警位置",placement:"top"}},[l("i",{staticClass:"el-icon-location card-table__icon",on:{click:function(l){return e.handleAlarmPostion(t.row)}}})]),e._v(" "),1!==+t.row.ifConfirm?l("el-tooltip",{attrs:{effect:"dark",content:"确认告警",placement:"top"}},[l("i",{staticClass:"el-icon-success card-table__icon",on:{click:function(l){return e.handleConfirmDialog(t.row)}}})]):e._e(),e._v(" "),t.row.closeUserid&&"--"!==t.row.closeUserid?e._e():l("el-tooltip",{attrs:{effect:"dark",content:"关闭告警",placement:"top"}},[l("i",{staticClass:"el-icon-error card-table__icon",on:{click:function(l){return e.handleClose(t.row)}}})])]}}])})],1)],1)],1)]),e._v(" "),l("div",{staticClass:"pagination-container"},[l("el-pagination",{attrs:{"current-page":e.listQuery.page,"page-sizes":[10,20,30,50],"page-size":e.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),l("GAlarmConfirm",{attrs:{row:e.viewTemp,visible:e.dialogAlarmConfirm},on:{"update:visible":function(t){e.dialogAlarmConfirm=t},submit:e.handleConfirmSubmit}}),e._v(" "),l("el-dialog",{attrs:{center:"","append-to-body":!0,top:"5vh","custom-class":"app-container__dialog",title:"告警流程",visible:e.dialogViewVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"1000px"},on:{"update:visible":function(t){e.dialogViewVisible=t}}},[l("GAlarmView",{attrs:{row:e.viewTemp},on:{close:function(t){return e.handleClose(e.viewTemp)},confirm:function(t){return e.handleConfirmDialog(e.viewTemp)},position:function(t){return e.handleAlarmPostion(e.viewTemp)}}}),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dialogViewVisible=!1}}},[e._v("取消")])],1)],1),e._v(" "),l("el-dialog",{attrs:{center:"",top:"8vh","append-to-body":!0,"custom-class":"app-container__dialog",title:"告警位置查看",visible:e.dialogMapVisible,modal:e.needModal,"close-on-click-modal":e.closeOnClickModel,width:"800px"},on:{"update:visible":function(t){e.dialogMapVisible=t}}},[l("GAlarmPosition",{attrs:{row:e.mapInfo}}),e._v(" "),l("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[l("el-button",{on:{click:function(t){e.dialogMapVisible=!1}}},[e._v("取消")])],1)],1)],1)},i=[],o=(l("20d6"),l("a481"),l("0a1f")),n=l("ed08"),s=l("62e5"),r=l("7aea"),c=l("104b"),d=o["device"].findAllAlarmType,u=o["device"].findAlarmStatByParam,m=o["device"].setAlarmCloseCycle,p=o["device"].deleteConfirmFile,f=o["patrol"].getAlarmPostionById,v={name:"AlarmQuery",components:{GAlarmView:s["a"],GAlarmConfirm:r["a"],GAlarmPosition:c["a"]},filters:{filterAlarmStatus:function(e){var t="";switch(+e){case 0:t="激活";break;case 1:t="已确认";break;case 2:t="已关闭";break;default:t="未知"}return t}},data:function(){var e=new Date;return e.setTime(e.getTime()-36e5),{emptyText:null,list:[],total:null,listLoading:!0,pickerOptions:n["m"],listQuery:{page:1,limit:10,deviceName:"",alarmType:"",closedCycle:"",confirm:"",alarmLevel:"",startTime:Object(n["l"])(e),stopTime:""},selectOptions:[{value:1,label:"严重"},{value:2,label:"重要"},{value:3,label:"一般"}],selectOptions2:[{value:0,label:"未确认"},{value:1,label:"已确认"}],selectOptions3:[{value:0,label:"未结束"},{value:1,label:"已结束"}],typeList:[],alarmText:["严重","重要","一般"],alarmColors:["#DC4B3F","#E67F22","#F1C40F"],needModal:!0,closeOnClickModel:!1,dialogMapVisible:!1,dialogViewVisible:!1,dialogAlarmConfirm:!1,viewTemp:{},mapInfo:{},filename:this.$t("route.alarm-query")}},computed:{previewRoute:function(){return this.$store.state.router.from}},mounted:function(){var e=this.$route.query,t=e.alarmId,l=void 0===t?"":t,a=e.deviceName,i=e.alarmType,o=e.alarmLevel,n=e.startTime,s=e.stopTime;l&&(this.listQuery=Object.assign({},this.listQuery,{alarmId:l,deviceName:a,alarmType:+i,alarmLevel:+o,startTime:n,stopTime:s})),this.getList(),this.getAlarmType(),console.log(this.$router.history.length)},methods:{goBack:function(){var e=this.previewRoute.path;e?this.$router.replace({path:e}):this.$router.replace({path:"/dashboard"})},getList:function(e){var t=this;"boolean"===typeof e&&e||(this.listQuery.page=1),this.listLoading=!0,this.emptyText=null,u(this.listQuery).then(function(e){t.list=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(e){console.log(e),t.listLoading=!1,t.emptyText="网络错误"})},getAlarmType:function(){var e=this;d().then(function(t){e.typeList=t.data},function(e){console.log(e)})},rowKey:function(e){return e.id},handleSizeChange:function(e){this.listQuery.limit=e,this.getList()},handleCurrentChange:function(e){this.listQuery.page=e,this.getList(!0)},handleCommand:function(e){if("undefined"!==typeof e)switch(e){case"xlsx":var t=this.listQuery,l=t.deviceName,a=void 0===l?"":l,i=t.alarmType,o=void 0===i?"":i,n=t.startTime,s=void 0===n?"":n,r=t.stopTime,c=void 0===r?"":r,d=t.closedCycle,u=void 0===d?"":d,m=t.confirm,p=t.alarmLevel;window.open("/robotservice/device/exportFindAlarmListByParamNew.action?deviceName="+a+"&alarmType="+o+"&startTime="+s+"&stopTime="+c+"&closedCycle="+u+"&confirm="+m+"&alarmLevel="+p);break}},handleConfirmDialog:function(e){"undefined"!==typeof e&&(this.dialogViewVisible||(this.viewTemp=e),this.dialogAlarmConfirm=!0)},handleConfirmSubmit:function(e){if("undefined"!==typeof e){var t=e.id,l=this._.findIndex(this.list,{id:+t});l>-1&&this.list.splice(l,1,e),this.dialogViewVisible&&(this.viewTemp=Object.assign({},this.viewTemp,e))}},handleDeleteFile:function(e){var t=this,l=e.id;this.$confirm("确定告警附件吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){p({id:l}).then(function(l){t.$message.success(l.msg),e.confirmFile=""},function(e){console.log(e)})}).catch(function(){})},handleClose:function(e){var t=this,l=e.id;this.$prompt("请填写关闭告警说明（必须）","提示 -- 关闭告警",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){var a=e.value;a?m({id:l,closeComment:a}).then(function(e){var l=e.data;t.$message.success(e.msg),t.handleConfirmSubmit(l)},function(e){console.log(e)}):t.$message({message:"请输入正确的告警说明",type:"warning"})})},handleAlarmView:function(e){"undefined"!==typeof e&&(this.viewTemp=e,this.dialogViewVisible=!0)},handleAlarmPostion:function(e){var t=this;if("undefined"!==typeof e){this.mapInfo={};var l=e.deviceId,a=e.id;f({deviceId:l,alarmStatId:a}).then(function(e){var l=e.data,a=l.mapId,i=l.mapPicHeight,o=l.mapPicWidth,n=l.mapPicPositionX,s=l.mapName,r=l.mapPicPositionY,c=l.mapPicUrl1;t.mapInfo={mapId:a,mapName:s,mapPicUrl:c,mapPicHeight:i,mapPicWidth:o,pointList:[[n,r]]},t.dialogMapVisible=!0},function(e){console.log(e)})}}}},g=v,h=(l("af27"),l("2877")),_=Object(h["a"])(g,a,i,!1,null,"a3d74d00",null);t["default"]=_.exports},af27:function(e,t,l){"use strict";var a=l("f025"),i=l.n(a);i.a},f025:function(e,t,l){}}]);