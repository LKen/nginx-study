(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-06bd75bb"],{ae03:function(t,e,a){},b083:function(t,e,a){"use strict";var n=a("ae03"),i=a.n(n);i.a},e991:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container new bg with-pagination"},[a("div",{staticClass:"card",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[a("div",{staticClass:"card-title"},[a("div",{staticClass:"g-toolbar g-toolbar--inner"},[a("div",{staticClass:"g-toolbar__label"},[t._v(t._s(t.filename))]),t._v(" "),a("div",{staticClass:"g-toolbar__actions"},[a("span",{staticClass:"action",on:{click:t.getList}},[a("svg-icon",{attrs:{"icon-class":"search"}}),t._v(" "),a("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.search")))])],1),t._v(" "),a("el-dropdown",{staticClass:"action",attrs:{trigger:"click"},on:{command:t.handleCommand}},[a("span",[a("svg-icon",{attrs:{"icon-class":"download"}}),t._v(" "),a("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.download")))])],1),t._v(" "),a("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[a("el-dropdown-item",{attrs:{"data-table-action":"excel",command:"xlsx"}},[t._v("\n                Excel (.xlsx)\n              ")])],1)],1)],1)])]),t._v(" "),a("h6",{staticClass:"card-subtitle"},[t._v("记录指定范围内机器人的工作情况")]),t._v(" "),a("div",{staticClass:"card-body"},[a("el-row",{staticClass:"filter-container",attrs:{gutter:20}},[a("el-col",{attrs:{xs:12,sm:8,md:4}},[a("el-input",{staticClass:"filter-item",attrs:{size:t.searchSize,placeholder:"巡逻路线名称"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList(e)}},model:{value:t.listQuery.lineName,callback:function(e){t.$set(t.listQuery,"lineName",e)},expression:"listQuery.lineName"}},[a("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),t._v(" "),a("el-col",{attrs:{xs:12,sm:8,md:4}},[a("el-date-picker",{staticClass:"filter-item",attrs:{size:t.searchSize,type:"datetime",placeholder:"开始时间",align:"right","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.listQuery.beginTime,callback:function(e){t.$set(t.listQuery,"beginTime",e)},expression:"listQuery.beginTime"}})],1),t._v(" "),a("el-col",{attrs:{xs:12,sm:8,md:4}},[a("el-date-picker",{staticClass:"filter-item",attrs:{size:t.searchSize,type:"datetime",placeholder:"结束时间",align:"right","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss"},model:{value:t.listQuery.endTime,callback:function(e){t.$set(t.listQuery,"endTime",e)},expression:"listQuery.endTime"}})],1)],1),t._v(" "),a("div",{staticClass:"card-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":""}},[a("el-table-column",{attrs:{align:t.tableAlign,label:"序号",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.no)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"记录类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("filterType")(e.row.plan_type)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"线路名称",width:"80px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.lineName)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"告警"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.alarms)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"巡逻开始时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.patrolTime)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"巡逻结束时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.patrolEndTime)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"录像地址"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.video)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"照片"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.picUrls?t._l(e.row.picUrls.split(","),function(t,e){return a("fancyBox",{key:e,attrs:{url:t}})}):[t._v("--")]]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"激光图巡逻轨迹","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.patrolLaserPic?a("fancyBox",{attrs:{url:e.row.patrolLaserPic}}):[t._v("--")]]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"航拍图巡逻轨迹","min-width":"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.patrolAerialPic?a("fancyBox",{attrs:{url:e.row.patrolAerialPic}}):[t._v("--")]]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"备注"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.remark?a("span",{staticClass:"text-ellipsis enableTap",staticStyle:{display:"inline-block"},attrs:{title:e.row.remark},on:{click:function(a){return t.handleRemark(e.row)}}},[t._v(t._s(e.row.remark))]):a("el-button",{attrs:{size:"mini",round:""},on:{click:function(a){return t.handleRemark(e.row)}}},[t._v("添加")])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"巡检报告"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tooltip",{attrs:{effect:"dark",content:"查看详情",placement:"top"}},[a("i",{staticClass:"el-icon-document card-table__icon",on:{click:function(a){return t.handleDetail(e.row)}}})])]}}])})],1)],1)],1)]),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{ref:"report",attrs:{center:"",top:"8vh","append-to-body":!0,"custom-class":"app-container__dialog",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"show-close":!1,width:"1440px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("print",{ref:"print",attrs:{params:t.temp}}),t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.enablePrint,expression:"!enablePrint"}],staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.handlePrint}},[t._v("打印")])],1)],1)],1)},i=[],l=a("0a1f"),r=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"report print"},[a("h2",{staticStyle:{"text-align":"center",margin:"0"}},[t._v("智能巡检机器人巡检报告")]),t._v(" "),a("div",{staticClass:"report-head",staticStyle:{"text-align":"center","margin-top":"5px"}},[t._v("汇总报表")]),t._v(" "),a("div",{staticClass:"report-body"},[a("p",[t._v("1、检测工况：")]),t._v(" "),a("table",[a("tbody",[a("tr",[a("td",[t._v("巡检路线名称")]),t._v(" "),a("td",{attrs:{colspan:"3"}},[t._v(t._s(t._f("defaultValue")(t.detail.lineName)))])]),t._v(" "),a("tr",[a("td",[t._v("任务开始时间")]),t._v(" "),a("td",[t._v(t._s(t._f("defaultValue")(t.detail.startTimeText)))]),t._v(" "),a("td",[t._v("任务结束时间")]),t._v(" "),a("td",[t._v(t._s(t._f("defaultValue")(t.detail.endTimeText)))])]),t._v(" "),a("tr",[a("td",[t._v("巡检点总数")]),t._v(" "),a("td",[t._v(t._s(t.lineInfo?t.lineInfo.pointList.length:0)+"个")]),t._v(" "),a("td",[t._v("巡检任务总耗时")]),t._v(" "),a("td",[t._v(t._s(t._f("filterTime")(t.detail)))])]),t._v(" "),a("tr",[a("td",[t._v("告警总数")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.alarmTotalNum)+"个")]),t._v(" "),a("td",[t._v("阻挡告警")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.blockAlarmNum)+"个")])]),t._v(" "),a("tr",[a("td",[t._v("高温告警")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.tempHighNum)+"个")]),t._v(" "),a("td",[t._v("低温告警")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.tempLowNum)+"个")])]),t._v(" "),a("tr",[a("td",[t._v("人体感应告警")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.humanaAlarmNum)+"个")]),t._v(" "),a("td",[t._v("电量低告警")]),t._v(" "),a("td",[t._v(t._s(t.computedCount.lowPowerNum)+"个")])]),t._v(" "),a("tr",[a("td",[t._v("测温点总数")]),t._v(" "),a("td",[t._v(t._s(t.total?t.total:0)+"个")]),t._v(" "),a("td",[t._v("测温报警")]),t._v(" "),a("td",[t._v(t._s(t.computedError)+"个")])])])]),t._v(" "),a("p",[t._v("2、结果汇总：")]),t._v(" "),a("p",[t._v("测温数据")]),t._v(" "),a("table",{staticStyle:{"margin-bottom":"15px"}},[t._m(0),t._v(" "),a("tbody",[t.list&&t.list.length>0?t._l(t.list,function(e,n){return a("tr",{key:n},[a("td",[t._v(t._s(n+1))]),t._v(" "),a("td",[t._v(t._s(e.targetName))]),t._v(" "),a("td",[t._v(t._s(e.time))]),t._v(" "),1===e.isError?a("td",[t._v(t._s(e.currentValue)+" ℃ ("),a("span",{staticStyle:{color:"#ea403c"}},[t._v("异常")]),t._v(")")]):a("td",[t._v(t._s(e.currentValue)+" ℃ ("),a("span",{staticStyle:{color:"#23f11e"}},[t._v("正常")]),t._v(")")])])}):a("tr",[a("td",{staticClass:"text-center",attrs:{colspan:"4"}},[t._v("暂无测温数据")])])],2)]),t._v(" "),a("p",[t._v("3、诊断分析和缺陷分析：")]),t._v(" "),a("textarea",{staticStyle:{background:"transparent",width:"100%"},attrs:{rows:"4"}}),t._v(" "),a("p",[t._v("4、处理意见：")]),t._v(" "),a("textarea",{attrs:{rows:"4"}}),t._v(" "),a("p",[t._v("5、备注：")]),t._v(" "),a("textarea",{attrs:{rows:"4"}}),t._v(" "),a("table",{staticStyle:{"margin-top":"15px"}},[a("tbody",[a("tr",{staticClass:"row"},[a("td",[t._v("审核:")]),t._v(" "),t._m(1),t._v(" "),a("td",[t._v("批准:")]),t._v(" "),t._m(2),t._v(" "),a("td",[t._v("日期:")]),t._v(" "),a("td",[a("el-date-picker",{attrs:{name:"time",size:"mini",type:"datetime",placeholder:"选择日期时间"},model:{value:t.time,callback:function(e){t.time=e},expression:"time"}})],1)])])])])])},o=[function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("thead",[a("tr",[a("th",[t._v("序号")]),t._v(" "),a("th",[t._v("设备名称")]),t._v(" "),a("th",[t._v("测温时间")]),t._v(" "),a("th",[t._v("测温结果")])])])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("td",[a("input",{attrs:{type:"text"}})])},function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("td",[a("input",{attrs:{type:"text"}})])}],s=(a("ac6a"),a("ed08")),c=l["patrol"].findPatrolReportDetail,d=l["patrol"].getLineInfoByLineName,u=l["patrol"].searchTemperatureRecordList,p={name:"Print",inject:["parseTime"],filters:{filterTime:function(t){var e=t.startTimeText,a=t.endTimeText;if(e&&a){var n=Object(s["d"])(e),i=Object(s["d"])(a),l=i-n,r=Math.floor(l/864e5),o=l%864e5,c=Math.floor(o/36e5),d=o%36e5,u=Math.floor(d/6e4),p=d%6e4,m=Math.round(p/1e3);return r+"天 "+c+"时 "+u+" 分"+m+" 秒"}}},props:{params:{type:Object,default:function(){return{}}}},data:function(){return{detail:{},lineInfo:null,list:[],total:null,time:this.parseTime(new Date)}},computed:{computedCount:function(){var t=this.detail,e=0,a=0,n=0,i=0,l=0,r=0;if("undefined"!==typeof t.alarmPics){var o=t.alarmPics;Array.isArray(o)&&o.length>0&&o.forEach(function(t){var r=t.alarmTypeName;switch(r){case"高温告警":e+=1;break;case"低温告警":a+=1;break;case"电量低告警":l+=1;break;case"人体感应告警(热成像)":i+=1;break;case"阻挡告警":n+=1;break}})}return{tempHighNum:e,tempLowNum:a,blockAlarmNum:n,humanaAlarmNum:i,lowPowerNum:l,alarmTotalNum:r}},computedError:function(){var t=this.list;if(!t)return 0;var e=t.rows,a=0;return Array.isArray(e)&&e.forEach(function(t){1===t.isError&&(a+=1)}),a}},watch:{params:{deep:!0,handler:function(t){this.fetchData()}}},mounted:function(){this.fetchData()},methods:{fetchData:function(){var t=this,e=this.params.patrolId;c({statId:e}).then(function(e){t.detail=e.data;var a=t.detail,n=a.deviceId,i=a.lineName,l=a.startTimeText,r=a.endTimeText,o=void 0===r?"":r;d({deviceId:n,lineName:i}).then(function(e){t.lineInfo=e.data},function(){}),l&&o&&u({beginTime:l,endTime:o}).then(function(e){t.list=e.data.rows,t.total=e.data.total},function(){})},function(){})}}},m=p,_=(a("b083"),a("2877")),v=Object(_["a"])(m,r,o,!1,null,"1cd439e3",null),f=v.exports,h=a("088d"),b=l["report"].patrolReport,g=l["report"].updatePatrolRemark,y={name:"PatrolReportForm",inject:["parseTime"],filters:{filterType:function(t){var e="巡逻";return"2"===t&&(e="导览"),e}},components:{print:f},data:function(){var t=new Date;return t.setTime(t.getTime()-36e5),{emptyText:null,list:[],total:null,listLoading:!0,pickerOptions:s["m"],listQuery:{page:1,limit:10,lineName:null,planType:null,beginTime:this.parseTime(t),endTime:null},selectOptions:[{value:"",label:"请选择 - 计划类型"},{value:1,label:"巡逻记录"},{value:2,label:"导览记录"}],needModal:!0,closeOnClickModel:!1,dialogVisible:!1,temp:{},enablePrint:!1,filename:this.$t("route.patrol-report-form")}},created:function(){},mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.listLoading=!0,this.list=[],this.emptyText=null,b(this.listQuery).then(function(e){t.list=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(){t.listLoading=!1,t.emptyText="网络错误"})},rowKey:function(t){return t.id},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleCommand:function(t){if("undefined"!==typeof t)switch(t){case"xlsx":var e=["no","plan_type","lineName","alarms","patrolTime","patrolEndTime","video","picUrls","patrolLaserPic","patrolAerialPic","remark"],a=["序号","记录类型","线路名称","告警","巡逻开始时间","巡逻结束时间","录像地址","照片","激光图巡逻轨迹","航拍图巡逻轨迹","备注"],n=this.list,i=this.filename;this.$g_exportToExcel({field:e,field_ZH:a,list:n,filename:i},this.formatJson);break}},formatJson:function(t,e){return e.map(function(e){return t.map(function(t){if("plan_type"===t){var a="巡逻";return 2===+e[t]&&(a="导览"),a}return e[t]})})},handleRemark:function(t){var e=this;if("undefined"!==typeof t){var a=t.patrolId;this.$prompt("请填写相关内容（必须）","提示 -- 修改巡逻备注",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"请输入正确的巡逻备注"}).then(function(n){var i=n.value;g({patrolId:a,remark:i}).then(function(a){e.$message.success(a.msg),t.remark=i},function(t){console.log(t)})})}},handleDetail:function(t){if("undefined"===typeof t)return t;this.temp=Object.assign({},t),this.dialogVisible=!0},handlePrint:function(){var t=this;this.$nextTick(function(){if(-1===Object(s["h"])()){var e=window.open("about:blank","g-toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=yes, copyhistory=no, width=100%, height=100%"),a=t.$refs["print"].$el.cloneNode(!0);e.document.body.appendChild(a);var n=document.createElement("style");n.setAttribute("type","text/css"),n.innerHTML="@media print{@page{size:21cm 29.7cm;margin:2.54cm 1.91cm}html,body{margin:0;padding:0;border:none}.noprint{display:none}body{overflow:hidden;overflow-y:auto}table{width:100%;border-spacing:0;border-collapse:collapse;border:1px solid;width:100%;max-width:100%;margin-bottom:20px;font-size:12px;text-align:left}table th,table td{border:1px solid;padding:8px;line-height:1.42857143;vertical-align:top}textarea,input,select{background:transparent}input{border:none;width:100%}textarea{width:100%}}",e.document.getElementsByTagName("head")[0].appendChild(n),e.document.title="智能巡检机器人巡检报告",e.print(),e.close()}else{var i=t.$createElement;t.$msgbox({title:"提示",message:i(h["a"],{props:{text:window.location.href,tip:"IE暂不支持报表（.pdf）导出，请复制相关URL到最新版Chrome或者360下操作 "}}),lockScroll:!0,closeOnClickModal:!1,confirmButtonText:"确定",type:"warning",center:!0}).then(function(t){}).catch(function(){})}})}}},w=y,x=Object(_["a"])(w,n,i,!1,null,"696943e9",null);e["default"]=x.exports}}]);