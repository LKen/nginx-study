(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b7cf6386"],{"174e":function(e,t,a){},"4b59":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container new"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-body"},[a("div",{staticClass:"card-module bg flex"},[a("Toolbar",{attrs:{name:"基础配置",bg:!0,size:"small"}},[a("span",{staticClass:"action",on:{click:e.saveBaseConfig}},[a("g-icon",{class:{"icon-loading":e.sending2},attrs:{"icon-class":e.sending2?"loading":"save"}}),e._v(" "),a("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.save")))])],1)]),e._v(" "),a("div",{staticClass:"card-module__content"},[a("el-form",{ref:"baseForm",attrs:{inline:!0,model:e.temp_base,size:e.formSize,"label-width":"240px"}},[a("el-form-item",{attrs:{label:"手工关闭告警的超时时间（秒）"}},[a("el-input-number",{attrs:{controls:!1},model:{value:e.temp_base.AlarmManualCloseTime,callback:function(t){e.$set(e.temp_base,"AlarmManualCloseTime",t)},expression:"temp_base.AlarmManualCloseTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"保留多少天的告警原始记录（天）"}},[a("el-input-number",{attrs:{controls:!1},model:{value:e.temp_base.AlarmDeleteDay,callback:function(t){e.$set(e.temp_base,"AlarmDeleteDay",t)},expression:"temp_base.AlarmDeleteDay"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"多长时间之后自动关闭告警（秒）"}},[a("el-input-number",{attrs:{controls:!1},model:{value:e.temp_base.AlarmAutoCloseTime,callback:function(t){e.$set(e.temp_base,"AlarmAutoCloseTime",t)},expression:"temp_base.AlarmAutoCloseTime"}})],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"card-module bg main"},[a("div",{staticClass:"main-left"},[a("Toolbar",{attrs:{name:"告警级别设置",bg:!0,size:"small"}},[a("span",{staticClass:"action",on:{click:e.handleSearchOpen}},[a("svg-icon",{attrs:{"icon-class":"search"}}),e._v(" "),a("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.search")))])],1),e._v(" "),a("span",{staticClass:"action",on:{click:e.fetchData}},[a("svg-icon",{attrs:{"icon-class":"refresh"}}),e._v(" "),a("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.refresh")))])],1),e._v(" "),a("transition",{attrs:{name:"el-zoom-in-center"}},[a("div",{directives:[{name:"show",rawName:"v-show",value:e.searchBar,expression:"searchBar"}],staticClass:"g-toolbar__search",staticStyle:{display:"block"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.searchValue,expression:"searchValue"}],ref:"searchInput",attrs:{type:"text",autofocus:"",placeholder:"搜索...       (Enter/回车)"},domProps:{value:e.searchValue},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch(t)},input:function(t){t.target.composing||(e.searchValue=t.target.value)}}}),e._v(" "),a("i",{staticClass:"el-icon-back g-toolbar__search__close",on:{click:e.handleSearchClose}}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:e.searchError,expression:"searchError"}],staticClass:"g-toolbar__search__error"},[e._v("无相关结果")])])])],1),e._v(" "),a("div",{staticClass:"alarm-list"},[a("el-scrollbar",{ref:"scroll"},[e.level_search.length<1?[a("p",{staticClass:"label"},[e._v("告警等级：严重")]),e._v(" "),e._l(e.computedALarmLevel_1,function(t){return a("div",{key:t.id,staticClass:"alarm-listItem",on:{click:function(a){return e.handleAlarmClick(t,a)}}},[a("div",{staticClass:"alarm-listItem__type",class:1===t.isError?"alarm-listItem__type--open":"alarm-listItem__type--close"},[a("img",{attrs:{src:t.defaultPic,alt:""}})]),e._v(" "),a("div",{staticClass:"alarm-listItem__name"},[e._v(e._s(t.alarmName))])])}),e._v(" "),a("p",{staticClass:"label"},[e._v("告警等级：重要")]),e._v(" "),e._l(e.computedALarmLevel_2,function(t){return a("div",{key:t.id,staticClass:"alarm-listItem",on:{click:function(a){return e.handleAlarmClick(t,a)}}},[a("div",{staticClass:"alarm-listItem__type",class:1===t.isError?"alarm-listItem__type--open":"alarm-listItem__type--close"},[a("img",{attrs:{src:t.defaultPic,alt:""}})]),e._v(" "),a("div",{staticClass:"alarm-listItem__name"},[e._v(e._s(t.alarmName))])])}),e._v(" "),a("p",{staticClass:"label"},[e._v("告警等级：一般")]),e._v(" "),e._l(e.computedALarmLevel_3,function(t){return a("div",{key:t.id,staticClass:"alarm-listItem",on:{click:function(a){return e.handleAlarmClick(t,a)}}},[a("div",{staticClass:"alarm-listItem__type",class:1===t.isError?"alarm-listItem__type--open":"alarm-listItem__type--close"},[a("img",{attrs:{src:t.defaultPic,alt:""}})]),e._v(" "),a("div",{staticClass:"alarm-listItem__name"},[e._v(e._s(t.alarmName))])])})]:[a("p",{staticClass:"label"},[e._v("搜索结果：全部")]),e._v(" "),e._l(e.level_search,function(t){return a("div",{key:t.id,staticClass:"alarm-listItem",on:{click:function(a){return e.handleAlarmClick(t,a)}}},[a("div",{staticClass:"alarm-listItem__type",class:1===t.isError?"alarm-listItem__type--open":"alarm-listItem__type--close"},[a("img",{attrs:{src:t.defaultPic,alt:""}})]),e._v(" "),a("div",{staticClass:"alarm-listItem__name"},[e._v(e._s(t.alarmName))])])})]],2)],1)],1),e._v(" "),a("div",{staticClass:"main-right"},[a("div",{staticClass:"main-right__header"},[a("Toolbar",{attrs:{name:e.temp.alarmName+"    配置 -- "+(e.settingMode||""),bg:!0,size:"small"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.settingMode,expression:"settingMode"}],staticClass:"action",on:{click:e.handleSave}},[a("svg-icon",{class:{"icon-loading":e.sending},attrs:{"icon-class":e.sending?"loading":"save"}}),e._v(" "),a("span",{staticClass:"action__desc"},[e._v(e._s(e.$t("base.save")))])],1),e._v(" "),a("el-popover",{directives:[{name:"show",rawName:"v-show",value:e.settingMode,expression:"settingMode"}],attrs:{placement:"top",width:"160"},model:{value:e.refreshVisible,callback:function(t){e.refreshVisible=t},expression:"refreshVisible"}},[a("p",[e._v("注意未保存数据，确定重置吗？")]),e._v(" "),a("div",{staticStyle:{"text-align":"right",margin:"0"}},[a("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(t){e.refreshVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.handleRefresh}},[e._v("确定")])],1),e._v(" "),a("span",{staticClass:"action",attrs:{slot:"reference"},slot:"reference"},[a("svg-icon",{attrs:{"icon-class":"refresh"}}),e._v(" "),a("span",{staticClass:"action__desc"},[e._v("重置")])],1)])],1)],1),e._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.sending,expression:"sending"}],staticClass:"main-right__content",attrs:{"element-loading-text":"正在保存...","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[a("transition",{attrs:{name:"fade"}},[a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.settingMode,expression:"settingMode"}],ref:"dataForm",attrs:{rules:e.rules,model:e.temp,size:e.formSize,"label-position":e.formAlign,"label-width":"100px"}},[a("el-form-item",{staticStyle:{width:"500px"},attrs:{label:"告警名称",prop:"alarmName"}},[a("el-input",{attrs:{placeholder:"输入简称"},model:{value:e.temp.alarmName,callback:function(t){e.$set(e.temp,"alarmName","string"===typeof t?t.trim():t)},expression:"temp.alarmName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否异常处理",prop:"isError"}},[a("el-switch",{attrs:{"active-color":e.activeColor,"active-value":e.switchValue.activeValue,"inactive-value":e.switchValue.inactiveValue},model:{value:e.temp.isError,callback:function(t){e.$set(e.temp,"isError",t)},expression:"temp.isError"}}),e._v(" "),a("span",{staticClass:"form-tip"},[e._v("若做此勾选，将会在巡逻报告中会作为异常处理")])],1),e._v(" "),a("el-form-item",{attrs:{label:"告警关闭"}},[a("el-radio-group",{model:{value:e.temp.needClose,callback:function(t){e.$set(e.temp,"needClose",t)},expression:"temp.needClose"}},[a("el-radio",{attrs:{label:0}},[e._v("自动识别关闭")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("触发即关闭")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"弹窗提示"}},[a("el-radio-group",{model:{value:e.temp.needPopover,callback:function(t){e.$set(e.temp,"needPopover",t)},expression:"temp.needPopover"}},[a("el-radio",{attrs:{label:0}},[e._v("无弹窗")]),e._v(" "),a("el-radio",{attrs:{label:1}},[e._v("右上角弹窗")]),e._v(" "),a("el-radio",{attrs:{label:2}},[e._v("居中弹窗")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"告警等级",prop:"alarmLevel"}},[a("el-radio-group",{model:{value:e.temp.alarmLevel,callback:function(t){e.$set(e.temp,"alarmLevel",e._n(t))},expression:"temp.alarmLevel"}},[a("el-radio",{attrs:{label:3}},[a("span",{staticStyle:{color:"#F1C40F"}},[e._v("一般")])]),e._v(" "),a("el-radio",{attrs:{label:2}},[a("span",{staticStyle:{color:"#E67F22"}},[e._v("重要")])]),e._v(" "),a("el-radio",{attrs:{label:1}},[a("span",{staticStyle:{color:"#DC4B3F"}},[e._v("严重")])])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"告警图标上传"}},[a("upload",{attrs:{accept:"image/jpeg, image/png","list-type":"picture",files:e.temp.defaultPic},on:{file:e.handleFileChange}},[a("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件，格式 30*30")])])],1)],1)],1)],1)])])])])])},i=[],l=a("db72"),n=(a("ac6a"),a("0a1f")),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload-component"},[a("div",{staticClass:"upload upload--picture",attrs:{tabindex:"0"},on:{click:e.handleClick}},[a("div",{staticClass:"upload-dragger",class:{"is-dragover":e.dragover},on:{drop:function(t){return t.preventDefault(),e.onDrop(t)},dragover:function(t){return t.preventDefault(),e.onDragover(t)},dragleave:function(t){t.preventDefault(),e.dragover=!1}}},[a("i",{staticClass:"el-icon-upload"}),e._v(" "),e._m(0)]),e._v(" "),a("input",{ref:"input",staticClass:"upload__input",attrs:{type:"file",name:"file",accept:e.accept},on:{change:e.handleChange}})]),e._v(" "),e._t("tip"),e._v(" "),a("ul",{staticClass:"upload-list upload-list--picture"},e._l(e.computedFIles,function(t){return a("li",{key:t.name,class:["upload-list__item","is-success",e.focusing?"focusing":""],attrs:{tabindex:"0"},on:{focus:function(t){e.focusing=!0},blur:function(t){e.focusing=!1}}},[["picture-card","picture"].indexOf(e.listType)>-1?a("img",{staticClass:"upload-list__item-thumbnail",attrs:{src:t.src,alt:""}}):e._e(),e._v(" "),a("a",{staticClass:"upload-list__item-name"},[a("i",{staticClass:"el-icon-picture"}),e._v(e._s(t.name))]),e._v(" "),e._m(1,!0),e._v(" "),a("i",{staticClass:"el-icon-close",on:{click:e.handleClearFile}})])}),0)],2)},c=[function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"upload__text"},[e._v("将文件拖到此处，或\n        "),a("em",[e._v("点击上传")])])},function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("label",{staticClass:"upload-list__item-status-label"},[a("i",{staticClass:"el-icon-upload-success el-icon-check"})])}],o=(a("a481"),a("7f7f"),a("28a5"),{name:"SimpleUpload",props:{disabled:Boolean,accept:{type:String,default:""},listType:{type:String,default:""},files:{type:[Array,String],default:function(){return[]}}},data:function(){return{dragover:!1,focusing:!1,ownFiles:this.files}},computed:{computedFIles:function(){var e=this.ownFiles;if(Array.isArray(e))return e;if("string"===typeof e&&e){var t=e.split("/");return[{src:e,name:t.pop()}]}return[]}},watch:{files:{deep:!0,handler:function(e){this.ownFiles=e}}},created:function(){},mounted:function(){},methods:{handleClick:function(){this.disabled||(this.$refs.input.value=null,this.$refs.input.click())},handleChange:function(e){var t=e.target.files;this.matchFileSuccess([].slice.call(t))},onDragover:function(){this.disabled||(this.dragover=!0)},onDrop:function(e){if(console.log(e),!this.disabled){var t=this.accept;this.dragover=!1,t?this.matchFileSuccess([].slice.call(e.dataTransfer.files).filter(function(e){var a=e.type,s=e.name,i=s.indexOf(".")>-1?".".concat(s.split(".").pop()):"",l=a.replace(/\/.*$/,"");return t.split(",").map(function(e){return e.trim()}).filter(function(e){return e}).some(function(e){return/\..+$/.test(e)?i===e:/\/\*$/.test(e)?l===e.replace(/\/\*$/,""):!!/^[^\/]+\/[^\/]+$/.test(e)&&a===e})})):this.matchFileSuccess(e.dataTransfer.files)}},matchFileSuccess:function(e){var t=this;e&&e.length>0&&(this.images=[],e.map(function(e){var a=new FileReader,s=e.name;a.onload=function(){t.ownFiles=[{name:s,src:a.result}]},a.readAsDataURL(e)})),this.$emit("file",e)},handleClearFile:function(){this.ownFiles=[],this.$emit("file",[])}}}),m=o,u=(a("a17d"),a("2877")),d=Object(u["a"])(m,r,c,!1,null,"bc541094",null),p=d.exports,v=a("26a1"),f=n["user"].selectCompanyConfig,h=n["user"].saveCompanyConfig,_=n["device"].findAllAlarmType,g=n["device"].setAlarmTypeConfig,b=n["device"].deleteAlarmTypeConfig,C={name:"AlarmLevelConfig",components:{upload:p},data:function(){return{sending:!1,refreshVisible:!1,source:null,currentTypeName:null,searchBar:!1,searchError:!1,searchValue:null,level_search:[],settingMode:null,currentTarget:null,temp:{alarmName:"",alarmLevel:1,isError:1,needReply:1,needClose:1,needRemind:1,needPopover:1,file:null,defaultPic:""},tempModified:!1,activeColor:"rgba(19, 206, 102, 0.4)",switchValue:{activeValue:1,inactiveValue:0},alarmLevelOption:{alarmText:["严重","重要","一般"].reverse(),alarmColors:["#DC4B3F","#E67F22","#F1C40F"].reverse(),textColor:"#909399"},rules:{alarmLevel:[{required:!0,message:"告警等级不为空",trigger:"blur"}],alarmName:[{required:!0,message:"告警名称不能为空",trigger:"blur"}]},temp_base:{AlarmManualCloseTime:null,AlarmDeleteDay:null,AlarmAutoCloseTime:null},sending2:!1}},computed:{computedALarmLevel_1:function(){var e=this.source;return e?e.filter(function(e){return 1===+e.alarmLevel}):[]},computedALarmLevel_2:function(){var e=this.source;return e?e.filter(function(e){return 2===+e.alarmLevel}):[]},computedALarmLevel_3:function(){var e=this.source;return e?e.filter(function(e){return 3===+e.alarmLevel}):[]}},mounted:function(){this.fetchData(),this.getConfig()},methods:{fetchData:function(){var e=this;_().then(function(t){e.source=t.data},function(e){console.log(e)})},getConfig:function(){var e=this;f().then(function(t){var a=e.temp_base,s=t.data;s.length>0&&s.forEach(function(e){e.code in a&&(a[e.code]=+e.value)})},function(e){console.log(e)})},resetTemp:function(){this.temp=Object.assign({},this.temp,{alarmName:"",alarmLevel:1,isError:1,needReply:1,needClose:1,needRemind:1,needPopover:1,file:null,defaultPic:""})},handleCreate:function(){var e=this;"create"!==this.settingMode&&(this.resetTemp(),this.settingMode="create",this.$nextTick(function(){e.$refs["dataForm"].clearValidate()}))},handleSave:function(){var e=this;if(!this.sending){var t=this;this.$refs["dataForm"].validate(function(a){a&&(e.sending=!0,g(e.temp).then(function(a){if("create"===t.settingMode)t.source.push(a.data),t.temp=Object(l["a"])({},t.temp,{id:a.data.id}),t.settingMode="update";else{var s=t.source,i=a.data.id;s.some(function(e,t,l){return e.id===i&&(s.splice(t,1,a.data),!0)}),console.log(a.data)}e.$message.success(a.msg),e.sending=!1,e.tempModified=!1},function(t){console.log(t),e.sending=!1}))})}},handleRefresh:function(){this.refreshVisible=!1,this.resetTemp()},handleAlarmClick:function(e,t){var a=this;this.tempModified?this.$confirm("检测到表单数据已被改动, 是否保存?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.handleSave()}).catch(function(){a.handleUpdate(e,t)}):this.handleUpdate(e,t)},handleUpdate:function(e,t){var a=this,s=t.currentTarget;this.$nextTick(function(){if(s&&s.className.indexOf("alarm-listItem")>-1){var e=a.currentTarget;e&&Object(v["f"])(e,"is-active"),Object(v["a"])(s,"is-active"),a.currentTarget=s}}),"undefined"!==typeof e&&(this.tempWatch&&this.tempWatch(),this.settingMode="update",this.temp=Object.assign({},this.temp,e),this.tempModified=!1,this.tempWatch=this.$watch("temp",function(){a.tempModified=!0},{deep:!0}),this.$nextTick(function(){a.$refs["dataForm"].clearValidate()}))},handleDelete:function(){var e=this,t=this,a=this.temp,s=a.id,i=a.alarmName;this.$prompt("请输入删除指定类型的名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(a){var l=a.value;i===l&&s?b({id:s}).then(function(a){e.$message.success(a.msg);var i=t.source,l=i.some(function(e,t,a){return e.id===s&&(a.splice(t,1),!0)});l&&(t.resetTemp(),t.settingMode=null)},function(e){console.log(e)}):e.$message({message:"请输入正确的告警名称",type:"warning"})})},handleSearch:function(e){var t=e.target.value,a=this.source;this.searchError=!1,this.level_search=a.filter(function(e){var a=e.alarmName;return a.indexOf(t)>-1}),0===this.level_search.length&&(this.searchError=!0)},handleSearchClose:function(){this.searchBar=!1,this.level_search=[],this.searchValue=null,this.searchError=!1},handleSearchOpen:function(){var e=this.$refs["searchInput"];this.searchBar=!0,this.$nextTick(function(){e.focus()})},handleFileChange:function(e){if("undefined"!==typeof e)if(e.length>0){var t=e[0];this.temp.file=t}else this.temp.file=null,this.temp.defaultPic=""},saveBaseConfig:function(){var e=this;this.sending2||(this.sending2=!0,h({config:this.temp_base}).then(function(t){e.sending2=!1,e.$message.success(t.msg)},function(t){e.sending2=!1,console.log(t)}))}}},y=C,k=(a("e7a5"),Object(u["a"])(y,s,i,!1,null,"713f372c",null));t["default"]=k.exports},a17d:function(e,t,a){"use strict";var s=a("174e"),i=a.n(s);i.a},caaf:function(e,t,a){},e7a5:function(e,t,a){"use strict";var s=a("caaf"),i=a.n(s);i.a}}]);