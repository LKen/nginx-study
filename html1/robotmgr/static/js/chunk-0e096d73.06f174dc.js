(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0e096d73"],{"832d":function(t,e,a){"use strict";var i=a("9970"),l=a.n(i);l.a},9970:function(t,e,a){},bd00:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"app-container new bg with-pagination"},[a("div",{staticClass:"card"},[a("div",{staticClass:"card-title"},[a("Toolbar",{attrs:{name:t.filename}},[a("span",{staticClass:"action",on:{click:t.getList}},[a("svg-icon",{attrs:{"icon-class":"search"}}),t._v(" "),a("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.search")))])],1),t._v(" "),a("span",{staticClass:"action",on:{click:t.handlePlus}},[a("svg-icon",{attrs:{"icon-class":"plus"}}),t._v(" "),a("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.plus")))])],1)])],1),t._v(" "),a("div",{staticClass:"card-body"},[a("el-row",{staticClass:"filter-container",attrs:{gutter:40}},[a("el-col",{attrs:{xs:12,sm:8,md:4}},[a("el-input",{staticClass:"filter-item",attrs:{size:t.searchSize,placeholder:"设备名称",type:"text",clearable:""},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getList(e)}},model:{value:t.listQuery.targetName,callback:function(e){t.$set(t.listQuery,"targetName","string"===typeof e?e.trim():e)},expression:"listQuery.targetName"}},[a("i",{staticClass:"el-input__icon el-icon-document",attrs:{slot:"prefix"},slot:"prefix"})])],1)],1),t._v(" "),a("div",{staticClass:"card-table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dataTable",staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":""}},[a("el-table-column",{attrs:{align:t.tableAlign,label:"告警编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.deviceId)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"告警设备名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.targetName)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"负责的机器人"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.robotName)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"点类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.pointType?a("el-tag",[t._v("导航点")]):a("el-tag",{attrs:{type:"warning"}},[t._v("巡逻点")])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"联动导航点"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.beaconPointName)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"联动巡逻点"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.patrolPoint)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"动作组"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.actionName)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"创建时间",width:"180px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.addTime)))]}}])}),t._v(" "),a("el-table-column",{attrs:{align:t.tableAlign,label:"操作",width:"150px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(a){return t.handleEdit(e.row)}}}),t._v(" "),a("i",{staticClass:"gosuncn-icon  el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(a){return t.handleDelete(e.row)}}}),t._v(" "),a("el-tooltip",{attrs:{effect:"light",content:"立刻执行",placement:"top"}},[a("i",{staticClass:"gosuncn-icon  el-icon-ext-issue card-table__icon",on:{click:function(a){return t.handleIssue(e.row)}}})])]}}])})],1)],1)],1)]),t._v(" "),a("div",{staticClass:"pagination-container"},[a("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{"append-to-body":!0,top:"15vh",title:t.dialogTitle,visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"550px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("el-form",{ref:"dataForm",staticStyle:{width:"80%",margin:"0 auto"},attrs:{rules:t.rules,model:t.temp,"label-position":t.formAlign,"label-width":"100px",size:t.formSize}},[a("el-form-item",{attrs:{label:"告警编号",prop:"deviceId"}},[a("el-input",{attrs:{placeholder:""},model:{value:t.temp.deviceId,callback:function(e){t.$set(t.temp,"deviceId","string"===typeof e?e.trim():e)},expression:"temp.deviceId"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"告警设备名称",prop:""}},[a("el-input",{attrs:{placeholder:""},model:{value:t.temp.targetName,callback:function(e){t.$set(t.temp,"targetName","string"===typeof e?e.trim():e)},expression:"temp.targetName"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"机器人",prop:"robotId"}},[a("el-select",{staticClass:"filter-item robotList__select",attrs:{filterable:"",placeholder:"请选择 - 机器人"},on:{change:t.fetchDataByRobotId},model:{value:t.temp.robotId,callback:function(e){t.$set(t.temp,"robotId",e)},expression:"temp.robotId"}},[t._l(t.robotsList,function(e){return a("el-option",{key:e.deviceId,attrs:{label:e.robotName,value:e.deviceId}},[t._v("\n            "+t._s(e.robotName)+"\n            "),a("span",{staticClass:"robotList__select--suffix",class:t._f("handleOnline")(e.online)},[a("svg-icon",{attrs:{"icon-class":t._f("handleOnline")(e.online)}})],1)])}),t._v(" "),a("svg-icon",{attrs:{slot:"prefix","class-name":"el-input__icon","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),a("el-form-item",{attrs:{label:"点类型",prop:"pointType"}},[a("el-select",{attrs:{placeholder:"默认 - 请选择"},model:{value:t.temp.pointType,callback:function(e){t.$set(t.temp,"pointType",e)},expression:"temp.pointType"}},[a("el-option",{attrs:{label:"导航点",value:1}}),t._v(" "),a("el-option",{attrs:{label:"巡逻点",value:2}}),t._v(" "),a("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],1)],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1===t.temp.pointType,expression:"temp.pointType === 1"}],attrs:{label:"联动导航点"}},[a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],attrs:{placeholder:"默认 - 请选择导航点",clearable:""},model:{value:t.temp.beaconPoint,callback:function(e){t.$set(t.temp,"beaconPoint",e)},expression:"temp.beaconPoint"}},[t._l(t.beaconPointList,function(t){return a("el-option",{key:t.id,attrs:{label:t.name+"-地图"+t.mapName,value:t.code}})}),t._v(" "),a("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!==t.temp.pointType,expression:"temp.pointType !== 1"}],attrs:{label:"联动巡逻点"}},[a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],attrs:{placeholder:"默认 - 请选择巡逻点",clearable:""},model:{value:t.temp.patrolPoint,callback:function(e){t.$set(t.temp,"patrolPoint",e)},expression:"temp.patrolPoint"}},[t._l(t.patrolLinePointList,function(t){return a("el-option",{key:t.id,attrs:{label:t.pointName+"-地图"+t.mapName,value:t.id}})}),t._v(" "),a("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),a("el-form-item",{attrs:{label:"动作组",prop:"actionId"}},[a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.dataLoading,expression:"dataLoading"}],attrs:{placeholder:"默认 - 请选择",clearable:""},model:{value:t.temp.actionId,callback:function(e){t.$set(t.temp,"actionId",e)},expression:"temp.actionId"}},[t._l(t.actionsList,function(t){return a("el-option",{key:t.actionId,attrs:{label:t.actionName,value:t.actionId}})}),t._v(" "),a("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),a("el-form-item",{attrs:{label:"告警等级",prop:"alarmType"}},[a("el-select",{attrs:{placeholder:"默认 - 请选择",clearable:""},model:{value:t.temp.alarmType,callback:function(e){t.$set(t.temp,"alarmType",e)},expression:"temp.alarmType"}},[a("el-option",{attrs:{label:"低",value:1}}),t._v(" "),a("el-option",{attrs:{label:"中",value:2}}),t._v(" "),a("el-option",{attrs:{label:"高",value:3}}),t._v(" "),a("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],1)],1)],1),t._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),a("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],on:{click:t.handleSave}},[t._v("保存")])],1)],1)],1)},l=[],n=(a("ac6a"),a("5df3"),a("768b")),o=(a("96cf"),a("3b8d")),s=a("db72"),r=a("2f62"),c=a("0a1f"),d=Object(r["a"])("robot"),p=d.mapState,u=c["device"].addAlarmLinkageConfig,m=c["device"].modifyAlarmLinkageConfig,f=c["device"].sendAlarmLinkageCommand,g=c["device"].deleteAlarmLinkageConfig,v=c["device"].findAlarmLinkageConfigByParam,b=c["patrol"].searchPatrolLinePointList,_=c["patrol"].searchBeaconPointList,h=c["patrol"].searchRobotActionList,y={name:"AlarmLinkageConfig",filters:{handleOnline:function(t){return 1===t?"online":"offline"}},data:function(){return{emptyText:null,list:[],total:null,listLoading:!0,listQuery:{page:1,limit:10,targetName:""},dialogTitle:"添加告警联动配置",needModal:!0,closeOnClickModel:!1,dialogVisible:!1,sending:!1,temp:{id:"",deviceId:"",targetName:"",alarmType:"",beaconPoint:"",actionId:"",robotId:"",pointType:1,patrolPoint:""},beaconPointList:[],actionsList:[],patrolLinePointList:[],dataLoading:!1,rules:{deviceId:[{required:!0,message:"不能为空",trigger:"blur"}],robotId:[{required:!0,message:"不能为空",trigger:"blur"}],pointType:[{required:!0,message:"不能为空",trigger:"blur"}],alarmType:[{required:!0,message:"不能为空",trigger:"blur"}],actionId:[{required:!0,message:"不能为空",trigger:"blur"}]},filename:this.$t("route.alarm-linkage-config")}},computed:Object(s["a"])({},p({robotsList:function(t){return t.robotsList}})),mounted:function(){this.getList()},methods:{getList:function(){var t=this;this.listLoading=!0,this.emptyText=null,v(this.listQuery).then(function(e){t.list=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(e){console.log(e),t.listLoading=!1,t.emptyText="网络错误"})},rowKey:function(t){return t.id},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handlePlus:function(){var t=this;this.temp={id:"",deviceId:"",targetName:"",alarmType:"",beaconPoint:"",actionId:"",robotId:"",pointType:1,patrolPoint:""},this.dialogVisible=!0,this.$nextTick(function(){t.$refs["dataForm"].clearValidate()})},fetchDataByRobotId:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(e){var a,i,l,o,s;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,this.dataLoading=!0,t.next=4,Promise.all([_({deviceId:e,page:1,limit:999}),b({deviceId:e,page:1,limit:999}),h({deviceId:e,page:1,limit:999})]);case 4:a=t.sent,i=Object(n["a"])(a,3),l=i[0],o=i[1],s=i[2],this.beaconPointList=l.data.rows,this.patrolLinePointList=o.data.rows,this.actionsList=s.data.rows,this.dataLoading=!1,t.next=19;break;case 15:t.prev=15,t.t0=t["catch"](0),this.dataLoading=!1,console.log(t.t0);case 19:case"end":return t.stop()}},t,this,[[0,15]])}));function e(e){return t.apply(this,arguments)}return e}(),handleEdit:function(t){var e=this,a=t.id,i=t.deviceId,l=t.targetName,n=t.alarmType,o=t.robotId,s=t.pointType,r=t.beaconPoint,c=t.patrolPoint,d=t.actionId;this.dialogTitle="更新告警联动配置",this.temp=Object.assign({},{id:a,deviceId:i,targetName:l,alarmType:+n,robotId:o,pointType:s,actionId:d,beaconPoint:r,patrolPoint:c}),this.fetchDataByRobotId(o),this.dialogVisible=!0,this.$nextTick(function(){e.$refs["dataForm"].clearValidate()})},handleSave:function(){var t=this,e=this.temp.id,a=e?m:u;this.$refs["dataForm"].validate(function(e){if(e){var i=t._.cloneDeep(t.temp);t.sending=!0,a(i).then(function(e){t.$message.success(e.msg),t.sending=!1,t.getList(),t.$nextTick(function(){t.dialogVisible=!1})},function(e){t.sending=!1,console.log(e)})}})},handleDelete:function(t){var e=this,a=t.id;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){g({id:a}).then(function(a){e.$message.success(a.msg),e.list.splice(e.list.indexOf(t),1)},function(t){console.log(t)})}).catch(function(){})},handleIssue:function(t){var e=this,a=t.id,i=t.point,l=t.actionCode,n=t.robotId,o=t.pointType;f({alarmLinkId:a,alarmLevel:1,beaconPoint:i,actionId:l,robotId:n,pointType:o}).then(function(t){e.$message.success(t.msg)},function(t){console.log(t)})}}},x=y,k=(a("832d"),a("2877")),L=Object(k["a"])(x,i,l,!1,null,"4e8268da",null);e["default"]=L.exports}}]);