(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6659e826"],{"5cbc":function(t,e,i){},7718:function(t,e,i){},7942:function(t,e,i){"use strict";var a=i("ae044"),n=i.n(a);n.a},ae044:function(t,e,i){},b103:function(t,e,i){"use strict";var a=i("7718"),n=i.n(a);n.a},cb20:function(t,e,i){"use strict";var a=i("5cbc"),n=i.n(a);n.a},d224:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container new bg"},[i("div",{staticClass:"card"},[i("div",{staticClass:"card-title"},[i("Toolbar",{attrs:{name:t.filename}})],1),t._v(" "),i("h6",{staticClass:"card-subtitle"},[t._v("可动态（批量）添加、编辑点位，和操作各地图对应点位路径组合，以及相关预览")]),t._v(" "),i("div",{staticClass:"card-body"},[i("div",{staticClass:"config"},[i("section",{staticClass:"left"},[i("div",{staticClass:"left-flex"},[i("Toolbar",{staticClass:"is-bg",attrs:{name:"树节点",auto:!1}}),t._v(" "),i("div",{staticClass:"tree__filter"},[i("el-input",{attrs:{size:t.formSize,placeholder:"筛选节点",clearable:""},model:{value:t.filterText,callback:function(e){t.filterText=e},expression:"filterText"}})],1),t._v(" "),i("p",{staticClass:"tree__tip"},[t._v("提示：括号内数字为当前节点的点位数量")]),t._v(" "),i("div",{staticClass:"tree-preview"},[i("el-scrollbar",[i("el-tree",{ref:"tree",staticClass:"el-tree--line",attrs:{indent:0,data:t.tree,"node-key":"id","empty-text":t.treeEmptyText,"filter-node-method":t.filterNode,props:t.defaultProps,"highlight-current":"","expand-on-click-node":!1},on:{"node-click":t.handleNodeClick},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.node,n=e.data;return i("span",{staticClass:"custom-tree-node"},[i("g-icon",{attrs:{"icon-class":1===+n.type?"device":"region"}}),t._v(" "),i("span",{staticStyle:{"margin-left":"5px"}},[t._v(t._s(a.label)+"   ("+t._s(n.patrolPointCount)+")")]),t._v(" "),n.errorNum?i("span",{staticStyle:{color:"#D82D35","margin-left":"1rem","vertical-align":"middle"}},[t._v("（"+t._s(n.errorNum)+"）")]):t._e()],1)}}])})],1)],1)],1)]),t._v(" "),i("section",{staticClass:"main"},[i("div",{staticClass:"pagination-wrapper"},[i("Toolbar",{staticClass:"is-bg",attrs:{name:"点位列表",auto:!1}},[i("span",{staticClass:"action"},[i("div",{staticClass:"g-search-group g-search-group--prepend",staticStyle:{width:"100%"}},[i("div",{staticClass:"g-search-group__prepend",staticStyle:{color:"#409EFF"}},[t._v("地图")]),t._v(" "),i("el-select",{staticClass:"g-search-group__inner",attrs:{placeholder:"全部",size:"mini",filterable:"",clearable:""},on:{change:t.handleMapChange},model:{value:t.listQuery.mapId,callback:function(e){t.$set(t.listQuery,"mapId",e)},expression:"listQuery.mapId"}},t._l(t.mapList,function(t){return i("el-option",{key:t.id,attrs:{label:t.mapName,value:t.id}})}),1)],1)]),t._v(" "),i("span",{staticClass:"action",on:{click:t.openBatchDialog}},[i("svg-icon",{attrs:{"icon-class":"batch"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.plusMore")))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.openDialog}},[i("svg-icon",{attrs:{"icon-class":"plus"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.plus")))])],1)]),t._v(" "),i("div",{staticClass:"scroll-container"},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"dataTable",staticStyle:{width:"96%",margin:"0 auto"},attrs:{data:t.computedList,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,height:"100%"},on:{select:t.handleTableSelection}},[t.listQuery.mapId?i("el-table-column",{attrs:{type:"selection",width:"45"}}):t._e(),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"点位名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.patrolPointName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"点位类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.patrolPointType)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"点位子类型",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.subtype)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"设备名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.devName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"点排序",width:"70px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.sort)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"地图名称","show-overflow-tooltip":!0},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.mapName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"路线巡逻点",width:"90px"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.naviPointName?i("span",[t._v(t._s(e.row.naviPointName))]):i("span",{staticClass:"g-color-danger"},[t._v("未关联")])]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"创建时间",width:"160px"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.addTime)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"操作",width:"100px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleDel(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-position2 card-table__icon",class:{"not-allowed g-color-danger":!e.row.naviPointName},attrs:{title:"当前位置"},on:{click:function(i){return t.handlePosi(e.row)}}})]}}])})],1)],1),t._v(" "),i("div",{staticClass:"pagination-container"},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)]),t._v(" "),i("section",{staticClass:"right"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.sending2,expression:"sending2"}],staticClass:"right-flex",attrs:{"element-loading-text":"正在提交"}},[i("Toolbar",{staticClass:"is-bg",attrs:{name:"路线"}},[i("span",{staticClass:"action",on:{click:t.hanleSavePath}},[i("svg-icon",{attrs:{"icon-class":"save"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.save")))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.handlePathPreview}},[i("svg-icon",{attrs:{"icon-class":"preview"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.preview")))])],1)]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.createPathVisible,expression:"!createPathVisible"}],staticClass:"path__filter"},[i("el-select",{staticStyle:{width:"100%"},attrs:{size:t.formSize,placeholder:"选择路线",clearable:""},on:{change:t.handlePathChange},model:{value:t.currentPath,callback:function(e){t.currentPath=e},expression:"currentPath"}},[t._l(t.computedPathList,function(t){return i("el-option",{key:t.lineId,attrs:{label:t.lineName+(t.mapName?" -- "+t.mapName+" (地图)":""),value:t.lineId}})}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.createPathVisible,expression:"!createPathVisible"}],staticClass:"path-preview"},[i("el-scrollbar",[i("draggable",t._b({staticClass:"path",attrs:{tag:"ul"},model:{value:t.pointList,callback:function(e){t.pointList=e},expression:"pointList"}},"draggable",t.dragOptions,!1),t._l(t.pointList,function(e,a){return i("li",{key:e.id,staticClass:"path-point"},[i("div",{staticClass:"path-point__label"},[t._v(t._s(t._f("defaultValue")(e.patrolPointName)))]),t._v(" "),i("div",{staticClass:"path-point__actions"},[i("g-icon",{attrs:{"icon-class":"delete"},on:{click:function(i){return t.handlePointDelete(e,a)}}}),t._v(" "),i("g-icon",{staticClass:"move",attrs:{"icon-class":"move"}})],1)])}),0)],1),t._v(" "),i("div",{staticClass:"path-preview__foot"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.currentPath,expression:"currentPath"}],attrs:{size:"small"},on:{click:function(e){return t.pointList.splice(0)}}},[t._v("清空")]),t._v(" "),i("el-button",{directives:[{name:"show",rawName:"v-show",value:t.currentPath&&"new"!==t.currentPath,expression:"currentPath && currentPath !== 'new'"}],attrs:{size:"small"},on:{click:t.deletePath}},[t._v("删除")])],1)],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.createPathVisible,expression:"createPathVisible"}],staticClass:"create",staticStyle:{position:"relative",top:"20%"}},[i("el-form",{ref:"createPathForm",staticStyle:{width:"90%",margin:"0 auto"},attrs:{model:t.temp2,size:t.formSize,"label-position":"top"}},[i("el-form-item",{attrs:{label:"创建新路线",prop:"lineName",rules:{required:!0,message:"新路线名称不能为空",trigger:"change"}}},[i("el-input",{attrs:{placeholder:"名称"},model:{value:t.temp2.lineName,callback:function(e){t.$set(t.temp2,"lineName","string"===typeof e?e.trim():e)},expression:"temp2.lineName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"机器人",prop:"deviceId",rules:{required:!0,message:"新路线名称不能为空",trigger:"change"}}},[i("el-select",{staticClass:"robotList__select",staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:t.temp2.deviceId,callback:function(e){t.$set(t.temp2,"deviceId",e)},expression:"temp2.deviceId"}},t._l(t.robotsList,function(e){return i("el-option",{key:e.deviceId,attrs:{label:e.robotName,value:e.deviceId}},[t._v("\n                      "+t._s(e.robotName)+"\n                      "),i("span",{staticClass:"robotList__select--suffix",class:1===e.online?"online":"offline"},[i("svg-icon",{attrs:{"icon-class":1===e.online?"online":"offline"}})],1)])}),1)],1),t._v(" "),i("el-form-item",[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:t.handlePathSubmit}},[t._v("立即创建")]),t._v(" "),i("el-button",{attrs:{size:"mini"},on:{click:function(e){t.createPathVisible=!1}}},[t._v("取消")])],1)],1)],1)],1)])])])]),t._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{center:"",title:t.dialogTitle,"append-to-body":!0,top:"12vh",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"1080px"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.dialogClosed,opened:t.dialogOpened}},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.actionLoading,expression:"actionLoading"}],ref:"formWrapper",staticClass:"actionGroup",attrs:{"element-loading-text":"正在获取最新数据"}},[i("el-form",{ref:"dataForm",staticStyle:{width:"95%",margin:"0 auto"},attrs:{rules:t.rules,model:t.temp,size:"mini","label-position":"right","label-width":"160px"}},[i("el-form-item",{attrs:{label:"点位名称",prop:"patrolPointName"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:""},model:{value:t.temp.patrolPointName,callback:function(e){t.$set(t.temp,"patrolPointName","string"===typeof e?e.trim():e)},expression:"temp.patrolPointName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"点位类型",prop:"patrolPointType"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"",clearable:""},model:{value:t.temp.patrolPointType,callback:function(e){t.$set(t.temp,"patrolPointType",e)},expression:"temp.patrolPointType"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"子类型",prop:"subType"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"",clearable:""},model:{value:t.temp.subType,callback:function(e){t.$set(t.temp,"subType",e)},expression:"temp.subType"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"巡检设备",prop:"devId"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"",clearable:""},model:{value:t.temp.devId,callback:function(e){t.$set(t.temp,"devId",e)},expression:"temp.devId"}},t._l(t.deviceList,function(t){return i("el-option",{key:t.id,attrs:{label:t.devName,value:t.id}})}),1)],1),t._v(" "),i("el-form-item",{attrs:{label:"路线巡逻点",prop:"linePointId"}},[i("el-select",{staticStyle:{width:"240px"},attrs:{placeholder:"",clearable:""},model:{value:t.temp.linePointId,callback:function(e){t.$set(t.temp,"linePointId",e)},expression:"temp.linePointId"}},t._l(t.navPointList,function(t){return i("el-option",{key:t.id,attrs:{label:t.pointName,value:t.id}})}),1)],1),t._v(" "),i("el-form-item",{attrs:{label:"排序",prop:"sort"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:""},model:{value:t.temp.sort,callback:function(e){t.$set(t.temp,"sort",t._n(e))},expression:"temp.sort"}})],1),t._v(" "),i("el-form-item",{attrs:{prop:"action"}},[i("span",{staticStyle:{color:"#409EFF"},attrs:{slot:"label"},slot:"label"},[t._v("动作组合")])])],1),t._v(" "),i("action-group",{ref:"actionForm",staticStyle:{width:"95%",margin:"0 auto"},attrs:{units:t.actionSource}})],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleAddAction}},[t._v("新增动作")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleDiaologSubmit}},[t._v("提交")])],1)]),t._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{center:"",title:"点位批量添加","append-to-body":!0,top:"12vh",visible:t.dialogVisible2,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"1280px"},on:{"update:visible":function(e){t.dialogVisible2=e},closed:t.batchDialogClosed,opened:t.batchDialogOpened}},[i("div",{staticClass:"batchConfig"},[i("table",{staticClass:"head-label",staticStyle:{"margin-bottom":"20px"},attrs:{cellspacing:"0",border:"0"}},[i("thead",[i("th",{staticClass:"label--required",staticStyle:{width:"114px"}},[t._v("点位名称")]),t._v(" "),i("th",{staticStyle:{width:"134px"}},[t._v("点位类型")]),t._v(" "),i("th",{staticStyle:{width:"134px"}},[t._v("子类型")]),t._v(" "),i("th",{staticStyle:{width:"134px"}},[t._v("巡检设备")]),t._v(" "),i("th",{staticStyle:{width:"134px"}},[t._v("路线巡逻点")]),t._v(" "),i("th",{staticStyle:{width:"95px"}},[t._v("点排序")]),t._v(" "),i("th",{staticStyle:{"padding-left":"30px"}},[t._v("动作组合")])])]),t._v(" "),i("div",{staticClass:"batchConfig-content"},[i("el-collapse",{attrs:{accordion:""},model:{value:t.activeGroup,callback:function(e){t.activeGroup=e},expression:"activeGroup"}},t._l(t.batchTemp,function(e,a){return i("el-collapse-item",{key:e.key,attrs:{name:a}},[i("template",{slot:"title"},[i("div",{staticClass:"left"},[i("el-form",{ref:"batchForm"+a,refInFor:!0,staticClass:"batchForm",attrs:{inline:!0,model:e,"label-width":"0px",size:"mini"}},[i("el-form-item",{attrs:{prop:"patrolPointName",rules:{required:0===a,message:"点位名称不能为空",trigger:"blur"}}},[i("el-input",{staticStyle:{width:"100px"},attrs:{placeholder:"必填"},model:{value:e.patrolPointName,callback:function(i){t.$set(e,"patrolPointName","string"===typeof i?i.trim():i)},expression:"form.patrolPointName"}})],1),t._v(" "),i("el-form-item",{attrs:{prop:"patrolPointType"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:0===a?"必填":"",clearable:""},model:{value:e.patrolPointType,callback:function(i){t.$set(e,"patrolPointType",i)},expression:"form.patrolPointType"}},[0===a?t._l(t.typeList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}):t._l(t.computedTypeList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),i("el-form-item",{attrs:{prop:"subType"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:0===a?"必填":"",clearable:""},model:{value:e.subType,callback:function(i){t.$set(e,"subType",i)},expression:"form.subType"}},[0===a?t._l(t.subTypeList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}):t._l(t.computedSubTypeList,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})],2)],1),t._v(" "),i("el-form-item",{attrs:{prop:"devId"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:0===a?"必填":"",clearable:""},model:{value:e.devId,callback:function(i){t.$set(e,"devId",i)},expression:"form.devId"}},[0===a?t._l(t.deviceList,function(t){return i("el-option",{key:t.id,attrs:{label:t.devName,value:t.id}})}):t._l(t.computedDeviceList,function(t){return i("el-option",{key:t.id,attrs:{label:t.devName,value:t.id}})})],2)],1),t._v(" "),i("el-form-item",{attrs:{prop:"linePointId"}},[i("el-select",{staticStyle:{width:"120px"},attrs:{placeholder:0===a?"必填":"",clearable:""},model:{value:e.linePointId,callback:function(i){t.$set(e,"linePointId",i)},expression:"form.linePointId"}},[0===a?t._l(t.navPointList,function(t){return i("el-option",{key:t.id,attrs:{label:t.pointName,value:t.id}})}):t._l(t.computedNavPatrolList,function(t){return i("el-option",{key:t.id,attrs:{label:t.pointName,value:t.id}})})],2)],1),t._v(" "),i("el-form-item",{attrs:{prop:"sort"}},[i("el-input",{staticStyle:{width:"80px"},attrs:{placeholder:""},model:{value:e.sort,callback:function(i){t.$set(e,"sort",t._n(i))},expression:"form.sort"}})],1)],1)],1),t._v(" "),i("div",{staticClass:"right"},[i("g-icon",{staticClass:"batchConfig__icon",attrs:{"icon-class":"plus"},on:{click:function(e){return e.stopPropagation(),t.batchAddAction(e,a)}}})],1)]),t._v(" "),i("div",{staticStyle:{"min-height":"30px"}},[i("action-group",{ref:"batchAction"+a,refInFor:!0})],1)],2)}),1)],1)]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible2=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.batchSubmit}},[t._v("提交")])],1)]),t._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{center:"",title:"预览","append-to-body":!0,top:"6vh",visible:t.dialogPreviewVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"800"},on:{"update:visible":function(e){t.dialogPreviewVisible=e}}},[i("g-alarm-position",{attrs:{row:t.mapInfo}}),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogPreviewVisible=!1}}},[t._v("关闭")])],1)],1)],1)},n=[],l=(i("ac6a"),i("96cf"),i("3b8d")),o=(i("0d6d"),i("55dd"),i("20d6"),i("db72")),s=i("0a1f"),r=i("310e"),c=i.n(r),d=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-form",{ref:"form",attrs:{model:t.temp,size:"mini","label-position":"right","label-width":"160px"}},[i("draggable",t._b({model:{value:t.temp.configs,callback:function(e){t.$set(t.temp,"configs",e)},expression:"temp.configs"}},"draggable",t.dragOptions,!1),[i("transition-group",{staticStyle:{position:"relative"},attrs:{name:"flip-change",tag:"div"}},t._l(t.temp.configs,function(e,a){return i("div",{key:e.unitId||e.animationId,staticClass:"form-group"},[i("el-select",{staticClass:"form-item--prefix",attrs:{size:"mini"},on:{change:function(i){return t.handleActionTypeChange(i,e,a)}},model:{value:e.actionType,callback:function(i){t.$set(e,"actionType",i)},expression:"item.actionType"}},t._l(t.actionType,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),i("el-form-item",{ref:"formItem"+a,refInFor:!0,attrs:{prop:"configs."+a+".field.actionWait",rules:{validator:t.validator,trigger:"blur"}}},["1"===e.actionType||"12"===e.actionType||"13"===e.actionType||"15"===e.actionType||"20"===e.actionType||"21"===e.actionType||"22"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"2"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"选择预置点"},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},t._l(t.prePositions,function(t){return i("el-option",{key:t.presetCode,attrs:{label:t.presetName,value:t.presetCode}})}),1)]:"3"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"文件类型（.wav）",disabled:!0},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}},[i("template",{slot:"append"},[i("span",{staticClass:"form-item__uploadTxt",on:{click:t.handleUploadFile}},[t._v("上传文件")]),t._v(" "),i("input",{staticClass:"form-item__upload",attrs:{type:"file",accept:".wav",name:"file"},on:{change:function(i){return t.handleFileChange(i,e)}}})])],2)]:"6"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"7"===e.actionType?[i("div",{staticClass:"form-box"},[i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{type:"number",placeholder:"最低温度"},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",t._n(i))},expression:"item.field.minValue"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{type:"number",placeholder:"最高温度"},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",t._n(i))},expression:"item.field.maxValue"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{placeholder:"例:x1,y1,x2,y2"},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})],1)]:"8"===e.actionType?[i("div",{staticClass:"form-item",staticStyle:{display:"inline-block"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"textarea",maxlength:"1000","show-word-limit":"",rows:3,placeholder:"室内款最多500字，室外1000字"},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.soundText.length/3)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}})],1)]:"9"===e.actionType?[i("div",{staticClass:"form-item g-search-group g-search-group--append",staticStyle:{width:"240px"}},[i("el-input-number",{staticClass:"form-item g-search-group__inner",attrs:{"controls-position":"right",step:20,min:0,max:600},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.actionValue>0?35*e.field.actionValue/600:1)}},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}}),t._v(" "),i("div",{staticClass:"g-search-group__append"},[t._v("毫米")])],1)]:"10"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{type:"number"},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",t._n(i))},expression:"item.field.actionValue"}},[i("template",{slot:"append"},[t._v("度")])],2)]:"11"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择旋转方向"},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",i)},expression:"item.field.minValue"}},[i("el-option",{attrs:{label:"左转",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"右转",value:"2"}})],1),t._v(" "),i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("转速")]),t._v(" "),i("el-input-number",{staticClass:"form-item g-search-group__inner",attrs:{placeholder:"0-100","controls-position":"right",min:0,max:100},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",i)},expression:"item.field.maxValue"}})],1)]:"17"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择房间",clearable:""},on:{change:function(i){return t.handleRoomChange(i,e)}},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},t._l(t.roomInfo,function(t){return i("el-option",{key:t.prisonHouseId,attrs:{label:"房间"+t.prisonHouseId,value:t.prisonHouseId}})}),1),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"人员名单"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"18"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"格式：货架-货架列号"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"23"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"遗留物信息，以逗号隔开"},on:{blur:function(i){return t.filterDot(i,e)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})]:"24"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},[i("el-option",{attrs:{label:"开",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"关",value:"0"}})],1),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"门的编号"},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})]:"25"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择模块",clearable:""},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}},t._l(t.tblockIps,function(t){return i("el-option",{key:t.id,attrs:{label:t.moduleName,value:t.moduleIp}})}),1)]:"26"===e.actionType?[i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("速度")]),t._v(" "),i("el-input-number",{staticClass:"form-item",attrs:{"controls-position":"right",precision:2,step:.1,min:.1,max:.6},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",i)},expression:"item.field.minValue"}})],1),t._v(" "),i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("角度")]),t._v(" "),i("el-input-number",{staticClass:"form-item",attrs:{"controls-position":"right",step:20,min:-360,max:360},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",i)},expression:"item.field.maxValue"}})],1)]:"27"===e.actionType?[i("div",{staticClass:"form-item",staticStyle:{display:"inline-block"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"textarea",maxlength:"1000","show-word-limit":"",rows:3,placeholder:"室内款最多500字，室外1000字"},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.soundText.length/3)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}})],1),t._v(" "),i("el-select",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},[i("el-option",{attrs:{label:"开",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"关",value:"0"}})],1)]:"28"===e.actionType?void 0:"29"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"图片名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:[t._v("暂无内容")],t._v(" "),i("div",{staticClass:"form-item--suffix"},[i("el-input",{directives:[{name:"show",rawName:"v-show",value:"23"!==e.actionType,expression:"item.actionType !== '23'"}],staticStyle:{width:"240px"},attrs:{type:"number"},model:{value:e.field.actionWait,callback:function(i){t.$set(e.field,"actionWait",t._n(i))},expression:"item.field.actionWait"}},[i("template",{slot:"prepend"},[t._v("动作持续时间")]),t._v(" "),i("template",{slot:"append"},[t._v("秒")])],2),t._v(" "),i("g-icon",{staticClass:"form-item__icon form-item__icon--bg",attrs:{"icon-class":"minus"},on:{click:function(i){return t.deleteAction(e)}}}),t._v(" "),i("g-icon",{staticClass:"form-item__icon form-item__move",attrs:{"icon-class":"move"}})],1)],2)],1)}),0)],1)],1)},p=[],u=(i("a481"),i("28a5"),i("ed08")),m=[{label:"抓拍",value:"1"},{label:"预置点",value:"2"},{label:"播报音频",value:"3"},{label:"仪表识别",value:"6"},{label:"温度检测",value:"7"},{label:"播报文字",value:"8"},{label:"伸缩杆控制",value:"9"},{label:"角度转向",value:"10"},{label:"环视一周",value:"11"},{label:"车辆检测",value:"12"},{label:"进出粮监管",value:"13"},{label:"墙体脱落检测",value:"15"},{label:"点名",value:"17"},{label:"二维码抓拍",value:"18"},{label:"无人告警",value:"20"},{label:"物品清点",value:"21"},{label:"车辆违停检测",value:"22"},{label:"遗留物检测",value:"23"},{label:"开关门",value:"24"},{label:"LoRa SNMP采集",value:"25"},{label:"本体转向角度",value:"26"},{label:"巡逻全程播报",value:"27"},{label:"充电",value:"28"},{label:"资产盘点",value:"29"}],f={name:"GActionGroup2",inject:["api"],components:{draggable:c.a},props:{units:{type:[Array,String],default:function(){return[]}}},data:function(){return{dragOptions:{animation:200,group:"description",disabled:!1,handle:".form-item__move",ghostClass:"ghost"},actionType:Object.freeze(Object.assign([],m)),roomInfo:[],personInfo:[],tblockIps:[],temp:{configs:[]}}},mounted:function(){var t=this.units,e=function(t){return"string"===typeof t?[]:t.map(function(t){var e=t.unitId,i=t.actionType;return t.actionWait/=1e3,Object.assign({},{animationId:Math.floor(1e4*Math.random()),unitId:e,actionType:""+i,field:t})})};this.$watch("units",function(t,i){this.temp.configs=e(t)}),this.temp.configs=e(t)},methods:{fetchPersonInfo:function(){var t=this,e=this.api.patrol.findPersonInfoGroupByHouseId;0===this.roomInfo.length&&e().then(function(e){t.roomInfo=e.data},function(t){console.log(t)})},fetchTblockIps:function(){var t=this,e=this.api.patrol.findTblockIps;0===this.tblockIps.length&&e().then(function(e){t.tblockIps=e.data},function(t){console.log(t)})},validator:function(t,e,i){var a=this.temp,n=t.field,l=n.split(".")[1],o=a["configs"][l],s=o.actionType;"2"!==s||o.field.actionValue?"3"!==s||o.field.soundText?"7"!==s||o.field.minValue&&o.field.maxValue?"7"===s&&o.field.minValue&&o.field.maxValue&&+o.field.minValue>+o.field.maxValue?i(new Error("最低温度不能高于最高温度")):"8"!==s||o.field.soundText?"9"!==s||o.field.actionValue||0===o.field.actionValue?"10"!==s||o.field.actionValue?"11"!==s||o.field.minValue?"11"!==s||o.field.maxValue?"25"!==s||o.field.soundText?e?i():i(new Error("动作单位间隔不能为空")):i(new Error("rola模块Ip不能为空")):i(new Error("云台转向的速度不能为空")):i(new Error("云台转向的方向不能为空")):i(new Error("转向的角度不能为空")):i(new Error("伸缩杆高度不能为空")):i(new Error("语音内容不能为空")):i(new Error("温度不能为空")):i(new Error("播报音频不能为空")):i(new Error("预置点不能为空"))},handleActionTypeChange:function(t,e,i){switch(t){case"2":e.field={actionValue:"",actionWait:"1"};break;case"3":e.field={soundText:"",actionWait:1};break;case"6":e.field={actionUnitName:"",soundText:0,actionWait:1};break;case"7":e.field={minValue:"",maxValue:"",actionUnitName:"",soundText:"",actionWait:1};break;case"8":e.field={soundText:"",actionWait:1};break;case"9":e.field={actionValue:"",actionWait:1};break;case"10":e.field={actionValue:"",actionWait:1};break;case"11":e.field={minValue:"",maxValue:0,actionWait:1};break;case"17":e.field={actionValue:"",actionUnitName:"",actionWait:1};break;case"23":e.field={soundText:"",actionWait:1};break;case"24":e.field={soundText:"",actionValue:"1",actionWait:1};break;case"25":e.field={soundText:"",actionWait:1};break;case"26":e.field={minValue:"",maxValue:"",actionWait:1};break;case"27":e.field={soundText:"",actionValue:"1",actionWait:1};break;case"28":e.field={actionWait:1};break;default:e.field={actionValue:"1",actionUnitName:"",actionWait:1}}var a="formItem"+i;this.$refs[a].length>0&&this.$refs[a][0].clearValidate()},handleUploadFile:function(t){var e=t.target;e.className.indexOf("form-item__uploadTxt")>-1&&e.nextElementSibling&&e.nextElementSibling.click()},handleFileChange:function(t,e){var i=this,a=this.api.patrol.uploadSoundFile,n=t.target.files;Object(u["k"])([].slice.call(n)[0],".wav")?this.$confirm("确定上传该文件吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){a({soundFile:n[0]}).then(function(t){i.$message.success(t.msg),e.field.soundText=t.data.soundFileUrl},function(e){t.target.value="",console.log(e)})}).catch(function(){t.target.value=""}):this.$message.error("所选文件类型不符合")},handleRoomChange:function(t,e){var i=this;if(t)if(this.personInfo.length<1||this.personInfo[0].prisonHouseId!==t){var a=this.api.patrol.getPersonInfo;a({prisonHouseId:t}).then(function(t){i.personInfo=t.data,e.field.actionUnitName=Array.isArray(t.data)?t.data.map(function(t){return t.personName}).join(","):""},function(t){console.log(t)})}else e.field.actionUnitName=this.personInfo.map(function(t){return t.personName}).join(",")},filterDot:function(t,e){var i=t.target.value;e.field.soundText=i.replace(/，+/g,",")},deleteAction:function(t){var e=this;console.log(t);var i=t.unitId;if(i){var a=this.api.patrol.deleteActionUnit;a({unitId:i}).then(function(i){e.$message.success(i.msg),e.temp.configs.splice(e.temp.configs.indexOf(t),1)},function(t){console.log(t)})}else this.temp.configs.splice(this.temp.configs.indexOf(t),1)},addAction:function(){this.temp.configs.push({animationId:Math.floor(1e4*Math.random()),actionId:"",unitId:"",actionType:"1",field:{actionValue:"1",actionUnitName:"",actionWait:1}});var t=this.$refs["form"].$el,e=t.parentNode;e&&t.scrollHeight>e.clientHeight&&this.$nextTick(function(){e.scrollTop=t.scrollHeight-e.clientHeight+5})},getData:function(){var t=this;return new Promise(function(e,i){t.$refs["form"].validate(function(a){if(a){var n=t._.cloneDeep(t.temp),l=0,o=n.configs.map(function(t){return"6"===t.actionType&&(t.field.soundText=l++),t.field.actionWait*=1e3,JSON.stringify(Object.assign({},t.field,{actionType:t.actionType,unitId:t.unitId}))}).join("@");e(o)}else i(!1)})})}}},h=f,v=(i("cb20"),i("2877")),g=Object(v["a"])(h,d,p,!1,null,"02268fbc",null),b=g.exports,_=i("104b"),y=i("2f62"),x=s["patrol"].deletePatrolLine,P=s["patrol"].getLineCode,w=s["patrol"].uploadPatrolLineInfoApp,T=s["patrol"].getPatrolpointLineList,I=s["patrol"].savePatrolPoints,k=s["patrol"].deletePatrolPoint,C=s["patrol"].savePatrolPoint,N=s["patrol"].searchPatrolLinePointList,S=s["patrol"].getPatrolDeviceList,L=s["patrol"].getLaserMapListByUser,V=s["patrol"].getAllPatrolDeviceAreaTree,$=s["patrol"].findPatrolPointByParam,A=Object(y["a"])("robot"),O=A.mapState,U={name:"PatrolPointPath",components:{Draggable:c.a,ActionGroup:b,GAlarmPosition:_["a"]},data:function(){return{filename:this.$t("route.patrol-point-path"),emptyText:"点击左边设备获取",textAlign:"left",list:[],total:null,listLoading:!1,formSize:"small",listQuery:{page:1,limit:10,devId:"",mapId:""},sending:!1,dialogTitle:"",needModal:!0,closeOnClickModel:!1,dialogVisible:!1,mapList:[],treeEmptyText:null,filterText:"",tree:null,defaultProps:{label:"areaName"},currentPath:"",pathList:[],pointList:[],temp2:{deviceId:"",pointList:"",lineCode:"",lineName:"",lineId:"",lineType:2,mapId:"",mapName:"",patrolLinePointIds:""},sending2:!1,createPathVisible:!1,dragOptions:{animation:200,group:"description",disabled:!1,handle:".move",ghostClass:"ghost"},actionLoading:!1,actionSource:"",temp:{patrolPointId:"",patrolPointName:"",patrolPointType:"",subtype:"",devId:"",mapId:"",naviPointName:"",linePointId:"",sort:"",action:[]},rules:{patrolPointName:{required:!0,message:"不能为空",trigger:"blur"}},typeList:[],subTypeList:[],deviceList:[],navPointList:[],dialogVisible2:!1,batchLen:10,batchTemp:Array.apply(null,{length:10}).map(function(t,e){return{patrolPointId:"",patrolPointName:"",patrolPointType:0===e?"":"same",subType:0===e?"":"same",devId:0===e?"":"same",mapId:"",naviPointName:"",linePointId:0===e?"":"same",sort:"",action:[],key:Math.random()}}),activeGroup:"",dialogPreviewVisible:!1,mapInfo:{}}},computed:Object(o["a"])({computedList:{get:function(){var t=this;return this.listQuery.mapId?this.list.filter(function(e){return+e.mapId===t.listQuery.mapId}):this.list}},computedPathList:{get:function(){var t=this;return this.listQuery.mapId?Array.prototype.concat.call([],{lineId:"new",lineName:"创建"},this.pathList.filter(function(e){return+e.mapId===t.listQuery.mapId})):this.pathList}},computedTypeList:{get:function(){return[{label:"同上",value:"same"}].concat(this.typeList)}},computedSubTypeList:{get:function(){return[{label:"同上",value:"same"}].concat(this.subTypeList)}},computedDeviceList:{get:function(){return[{devName:"同上",id:"same"}].concat(this.deviceList)}},computedNavPatrolList:{get:function(){return[{pointName:"同上",id:"same"}].concat(this.navPointList)}}},O({robotsList:function(t){return t.robotsList}})),created:function(){},mounted:function(){this.getTree(),this.getMapList(),this.getPatrolLines()},methods:{getTree:function(){var t=this;this.treeEmptyText=null,V({parentId:1}).then(function(e){t.tree=e.data},function(e){t.treeEmptyText="网络错误",console.log(e)})},getList:function(){var t=this;this.listLoading=!0,this.emptyText=null,$(this.listQuery).then(function(e){t.list=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(e){console.log(e),t.emptyText="网络错误",t.listLoading=!1})},getMapList:function(){var t=this;0===this.mapList.length&&L().then(function(e){t.mapList=e.data},function(t){console.log(t)})},getPatrolLines:function(){var t=this;return T().then(function(e){t.pathList=e.data})},fetchData:function(){var t=this;0===this.deviceList.length&&S().then(function(e){t.deviceList=e.data.rows}),0===this.navPointList.length&&N().then(function(e){t.navPointList=e.data.rows})},rowKey:function(t){return t.id},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},handleMapChange:function(t){this.currentPath="",this.pointList.splice(0)},filterNode:function(t,e){return!t||-1!==e.areaName.indexOf(t)},handleNodeClick:function(t,e){var i=t.type,a=t.id;1===i&&this.listQuery.devId!==a&&(this.listQuery.devId=a,this.getList())},handleTableSelection:function(t,e){var i=this;if(!this.currentPath)return this.$message({message:"请先选择合适的路径再添加",type:"warning"}),void(this.$refs["dataTable"]&&this.$refs["dataTable"].toggleRowSelection(e,!1));var a=this.pointList,n=e.id,l=e.mapId,o=this._.findIndex(a,{id:n});o>-1?a.splice(o,1):a.length>0&&+a[0].mapId!==+l?this.$confirm("所选点位与路线地图不符，是否自动切换到相应地图?","提示",{confirmButtonText:"切换",cancelButtonText:"取消",type:"warning"}).then(function(){i.listQuery.mapId=a[0].mapId,i.$nextTick(function(){var t=i.computedList;i.$refs["dataTable"]&&a.map(function(e){var a=i._.findIndex(t,{id:e.id});i.$refs["dataTable"].toggleRowSelection(t[a],!0)})})}).catch(function(){i.$refs["dataTable"]&&i.$refs["dataTable"].toggleRowSelection(e,!1)}):a.push(e)},openDialog:function(){var t=this;this.dialogTitle="添加点位",this.actionSource=[],this.dialogVisible=!0,this.$nextTick(function(){t.$refs["dataForm"].clearValidate()}),this.fetchData()},handleEdit:function(t){var e=t.id,i=t.patrolPointType,a=t.patrolPointName,n=t.subtype,l=t.devId,o=t.linePointId,s=t.mapId,r=t.naviPointName,c=t.sort,d=t.action;this.temp=Object.assign({},{patrolPointId:e,patrolPointType:i,patrolPointName:a,subtype:n,devId:+l,linePointId:+o,mapId:s,naviPointName:r,sort:c,action:""}),this.actionSource=Object.freeze(Object.assign([],d)),this.dialogTitle="编辑点位",this.dialogVisible=!0,this.fetchData()},handleDel:function(t){var e=this;this.$confirm("此操作将永久删除该文数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var i=t.id;k({id:i}).then(function(i){e.$message.success("删除成功!"),e.list.splice(e.list.indexOf(t),1)})}).catch(function(){})},handlePosi:function(t){var e,i,a=this.mapList,n=t.mapId,l=t.mapName,o=t.mapPicUrl,s=t.x,r=t.y;a.some(function(t){return t.id===+n&&(i=t.picWidth,e=t.picHeight,!0)}),this.mapInfo=Object.assign({},{mapId:n,mapName:l,mapPicWidth:i,mapPicHeight:e,mapPicUrl:o,pointList:[[s,r]]}),this.dialogPreviewVisible=!0},handlePathChange:function(t){var e=this;if(this.pointList.splice(0),this.$refs["dataTable"]&&this.$refs["dataTable"].clearSelection(),t){var i=this.pathList,a=this.computedList;i.some(function(i){return i.lineId===t&&(e.pointList=e._.cloneDeep(i.patrolLinePointIds),e.$refs["dataTable"]&&e.pointList.map(function(t){var i=e._.findIndex(a,{id:t.id});e.$refs["dataTable"].toggleRowSelection(a[i],!0)}),!0)})}},handlePointDelete:function(t,e){this.pointList.splice(e,1);var i=t.id,a=this._.findIndex(this.list,{id:i});a>-1&&this.$refs["dataTable"]&&this.$refs["dataTable"].toggleRowSelection(this.list[a],!1)},hanleSavePath:function(){var t=this;if(this.currentPath)return"new"===this.currentPath?(this.createPathVisible=!0,void this.$nextTick(function(){t.$refs["createPathForm"]&&t.$refs["createPathForm"].resetFields()})):void this.handlePathSubmit();this.$message({message:"请先选择合适的路径再保存",type:"warning"})},handlePathSubmit:function(){var t=this;this.$refs["createPathForm"].validate(function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(i){var a,n,l,o,s,r,c,d,p,u,m,f,h,v,g,b,_;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!i&&"new"===t.currentPath){e.next=43;break}if(t.createPathVisible=!1,t.sending2=!0,e.prev=3,a=t.currentPath,n=t.temp2,l=t.pointList,o=t.pathList,"new"===a){e.next=11;break}s=o.filter(function(t){return t.lineId===a})[0],r=s.deviceId,c=s.lineName,d=s.mapId,p=s.mapName,u=s.lineType,m=void 0===u?2:u,f=s.lineId,h=s.lineCode,Object.assign(t.temp2,{deviceId:r,lineName:c,mapId:d,mapName:p,lineType:m,lineId:f,lineCode:h}),e.next=23;break;case 11:return e.next=13,P({deviceId:n.deviceId});case 13:if(v=e.sent,n.lineCode=v.data,0===l.length){e.next=20;break}n.mapId=l[0].mapId,n.mapName=l[0].mapName,e.next=23;break;case 20:return t.$message.warning("请添加至少一个点位信息"),t.sending2=!1,e.abrupt("return",!1);case 23:return g=[],b=[],l.map(function(t){var e=t.id,i=t.x,a=t.y,n=t.actionGroupId,l=t.angle,o=t.pointType,s=t.linePointId;g.push(e),b.push({id:e,X:i,Y:a,action_id:n,angle:l,type:o,originPointId:s})}),console.log(b),n.patrolLinePointIds=g.join(","),n.pointList=b,e.next=31,w(n);case 31:return _=e.sent,t.$message.success(_.msg),e.next=35,t.getPatrolLines();case 35:t.currentPath=_.data.id,t.sending2=!1,e.next=43;break;case 39:e.prev=39,e.t0=e["catch"](3),t.sending2=!1,console.log(e.t0);case 43:case"end":return e.stop()}},e,null,[[3,39]])}));return function(t){return e.apply(this,arguments)}}())},deletePath:function(){var t=this,e=this.currentPath,i=this.pathList;i.some(function(a,n){return a.lineId===e&&(x({lineId:a.lineId,deviceId:a.deviceId}).then(function(e){t.$message.success(e.msg),i.splice(n,1),t.currentPath="",t.pointList.splice(0)}),!0)})},handlePathPreview:function(){var t=this.pointList,e=this.mapList;if(t.length>0){var i,a,n,l=t[0].mapId;e.some(function(t){return t.id===+l&&(i=t.mapPicUrl,a=t.picWidth,n=t.picHeight,!0)}),this.mapInfo={mapId:l,mapPicUrl:i,mapPicWidth:a,mapPicHeight:n,pointList:t.map(function(t){return[t.x,t.y]})},this.dialogPreviewVisible=!0}else this.$message.warning("请选择至少一个点位信息")},dialogOpened:function(){},dialogClosed:function(){this.temp={patrolPointId:"",patrolPointType:"",patrolPointName:"",subtype:"",devId:"",mapId:"",naviPointName:"",sort:"",linePointId:"",action:[]};var t=this.$refs["dataForm"].$el.querySelector('input[type="file"]');t&&(t.value=""),this.$refs["dataForm"]&&this.$refs["dataForm"].clearValidate()},handleAddAction:function(){this.$refs["actionForm"]&&this.$refs["actionForm"].addAction()},handleDiaologSubmit:function(){var t=this;this.$refs["dataForm"].validate(function(e){if(e){var i=t.temp,a=t.navPointList;a.some(function(t){if(t.id===i.linePointId){var e=t.mapId,a=t.pointName;return i.mapId=e,i.naviPointName=a,!0}return!1}),t.$refs["actionForm"].getData().then(function(e){i.action=e,t.sending=!0,C(i).then(function(e){if(t.$message.success(e.msg),i.patrolPointId){var a=t.list,n=e.data,l=t._.findIndex(a,{id:n.id});l>-1&&a.splice(l,1,n)}else t.getTree(),t.getList();t.sending=!1,t.dialogVisible=!1},function(e){t.sending=!1,console.log(e)})})}})},openBatchDialog:function(){this.dialogVisible2=!0,this.fetchData(),this.batchTemp=Array.apply(null,{length:this.batchLen}).map(function(t,e){return{patrolPointId:"",patrolPointName:"",patrolPointType:0===e?"":"same",subType:0===e?"":"same",devId:0===e?"":"same",mapId:"",naviPointName:"",linePointId:0===e?"":"same",sort:"",action:[],key:Math.random()}})},batchDialogOpened:function(){},batchDialogClosed:function(){},batchAddAction:function(t,e){if(t.stopPropagation&&t.stopPropagation(),"undefined"!==typeof e){this.activeGroup!==e&&(this.activeGroup=e);var i=this.$refs["batchAction".concat(e)][0];return i&&i.addAction(),!1}},batchSubmit:function(){var t=this;this.$refs["batchForm0"].length>0&&this.$refs["batchForm0"][0].validate(function(){var e=Object(l["a"])(regeneratorRuntime.mark(function e(i){return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:if(!i){e.next=2;break}return e.delegateYield(regeneratorRuntime.mark(function e(){var i,a,n,l,o,s,r,c,d;return regeneratorRuntime.wrap(function(e){while(1)switch(e.prev=e.next){case 0:i=t.batchTemp,a=t.navPointList,n=i.filter(function(t){return t.patrolPointName.trim()}),l=n.length,o=0,s=[],r=null,c=null;case 7:if(!(l>o)){e.next=29;break}if(c=n[o],"same"===c.patrolPointType&&(c.patrolPointType=r.patrolPointType),"same"===c.subType&&(c.subType=r.subType),"same"===c.devId&&(c.devId=r.devId),"same"===c.linePointId?(c.linePointId=r.linePointId,c.mapId=r.mapId,c.naviPointName=r.naviPointName):a.some(function(t){return t.id===c.linePointId&&(c.mapId=t.mapId,c.naviPointName=t.pointName,!0)}),r=c,e.prev=14,!(t.$refs["batchAction"+o].length>0)){e.next=20;break}return e.next=18,t.$refs["batchAction"+o][0].getData();case 18:d=e.sent,c.action=d;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](14),console.log(e.t0);case 25:s.push(c),++o,e.next=7;break;case 29:t.sending=!0,I(s).then(function(e){t.$message.success(e.msg),t.getTree(),t.getList(),t.sending=!1,t.dialogVisible2=!1},function(e){t.sending=!1,console.log(e)}),console.log(s);case 32:case"end":return e.stop()}},e,null,[[14,22]])})(),"t0",2);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())}}},F=U,D=(i("b103"),i("7942"),Object(v["a"])(F,a,n,!1,null,"0489a011",null));e["default"]=D.exports}}]);