(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-20e1e32a"],{"0811":function(t,e,i){"use strict";var a,n,o=i("db72"),l=i("2f62"),s=i("26a1"),r=Object(l["a"])("robot"),c=r.mapActions,d=r.mapState,u={name:"",filters:{filterOnline:function(t){return 1===t?"online":"offline"}},data:function(){return{LoadingRobot:!1,loadingText:"开始准备机器人",robotId:"",isReverse:!1,selectVisible:!1}},computed:Object(o["a"])({},Object(l["c"])(["fromRoute"]),{},d({robotsList:function(t){return t.robotsList}})),beforeRouteUpdate:function(t,e,i){console.log("%cbeforeRouteUpdate","color: #67C23A"),this.$_dispose(this.robotId),i()},beforeRouteLeave:function(t,e,i){console.log("beforeRouteLeave"),this.$_dispose(this.robotId),i()},created:function(){var t=this;this.$bus.$on("SwitchResult",function(e){t.loadingText=e?"加载数据成功":"加载数据成失败",t.LoadingRobot=!1})},methods:Object(o["a"])({$_robotVisible:function(t){t.preventDefault&&t.preventDefault(),t.stopPropagation&&t.stopPropagation(),this.isReverse=!this.isReverse,this.selectVisible=!this.selectVisible;var e=this;return this.selectVisible&&Object(s["e"])(document.body,"click",function(t){return t.preventDefault&&t.preventDefault(),e.isReverse=!1,e.selectVisible=!1,!1}),!1},$_robotChange:function(t){this.robotId=t,this.LoadingRobot=!0,this.loadingText="机器人加载中",this.changeRobotID({robotId:+t,params:{LineInfoPushSwitch:"1",FaceCapturePushSwitch:"1",RobotStatusPushSwitch:"1",CoordinatePushSwitch:"1"}}),this.update&&this.update()},$_dispose:function(t){return this.$store.dispatch("robot/disableByRobotID",{robotId:t,params:{LineInfoPushSwitch:"0",FaceCapturePushSwitch:"0",RobotStatusPushSwitch:"0",CoordinatePushSwitch:"0"}})}},c(["changeRobotID"]))},p=u,h=(i("43f2"),i("2877")),m=Object(h["a"])(p,a,n,!1,null,null,null);e["a"]=m.exports},"0c0e":function(t,e,i){"use strict";var a=i("78e4"),n=i.n(a);n.a},"119a":function(t,e,i){"use strict";var a=i("99d2"),n=i.n(a);n.a},1870:function(t,e,i){"use strict";var a=i("a21e"),n=i.n(a);n.a},"293e":function(t,e,i){"use strict";var a=i("3917"),n=i.n(a);n.a},"2fc0":function(t,e,i){},"313b":function(t,e,i){"use strict";var a=i("c9df"),n=i.n(a);n.a},"386b":function(t,e,i){var a=i("5ca1"),n=i("79e5"),o=i("be13"),l=/"/g,s=function(t,e,i,a){var n=String(o(t)),s="<"+e;return""!==i&&(s+=" "+i+'="'+String(a).replace(l,"&quot;")+'"'),s+">"+n+"</"+e+">"};t.exports=function(t,e){var i={};i[t]=e(s),a(a.P+a.F*n(function(){var e=""[t]('"');return e!==e.toLowerCase()||e.split('"').length>3}),"String",i)}},"386d":function(t,e,i){"use strict";var a=i("cb7c"),n=i("83a1"),o=i("5f1b");i("214f")("search",1,function(t,e,i,l){return[function(i){var a=t(this),n=void 0==i?void 0:i[e];return void 0!==n?n.call(i,a):new RegExp(i)[e](String(a))},function(t){var e=l(i,t,this);if(e.done)return e.value;var s=a(t),r=String(this),c=s.lastIndex;n(c,0)||(s.lastIndex=0);var d=o(s,r);return n(s.lastIndex,c)||(s.lastIndex=c),null===d?-1:d.index}]})},3917:function(t,e,i){},"3b7b":function(t,e,i){},"3c29":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container new"},[i("div",{staticClass:"card"},[i("el-scrollbar",[i("div",{staticClass:"card-title"},[i("Toolbar",{attrs:{name:t.filename,"prefix-icon":"back"},on:{"prefix-callback":t.goBack}},[i("span",{staticClass:"action no-click"},[i("svg-icon",{attrs:{"icon-class":"robot"}}),t._v(" "),i("el-popover",{ref:"popover",attrs:{"popper-class":"robot-popover",placement:"bottom",width:"200",trigger:"manual"},model:{value:t.selectVisible,callback:function(e){t.selectVisible=e},expression:"selectVisible"}},[i("div",{staticClass:"robot-popover__content"},[i("el-scrollbar",[i("ul",{staticClass:"robot-select"},t._l(t.robotsList,function(e){return i("li",{key:e.deviceId,staticClass:"robot-select__item",attrs:{"data-id":e.deviceId},on:{click:function(i){return t.selectClick(e.deviceId)}}},[t._v("\n                      "+t._s(e.robotName)+"\n                      "),i("span",{staticClass:"robot-select--suffix",class:t._f("filterOnline")(e.online)},[i("svg-icon",{attrs:{"icon-class":t._f("filterOnline")(e.online)}})],1)])}),0)])],1),t._v(" "),i("span",{staticClass:"action__desc robot-select",staticStyle:{cursor:"pointer"},attrs:{slot:"reference"},on:{click:function(e){return t.$_robotVisible(e)}},slot:"reference"},[t._v("\n                "+t._s(t.robotname)+"\n                "),i("i",{staticClass:"robot-select__caret el-input__icon el-icon-arrow-up",class:{"is-reverse":t.isReverse}})])])],1)])],1),t._v(" "),i("h6",{staticClass:"card-subtitle"},[t._v("配置值守点、动作组等信息，根据需求制定巡逻路线计划、值守计划，同时关联地图信息，以及地图的同步更新、激光地图与百度地图之间的校准等等")]),t._v(" "),i("div",{staticClass:"card-body"},[i("div",{staticClass:"card-module bg flex",staticStyle:{height:"400px"}},[i("Toolbar",{attrs:{name:"计划"}},[i("span",{staticClass:"action",on:{click:t.openPlanDialog}},[i("g-icon",{attrs:{"icon-class":"plus"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.plus")))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.handlePlanSynchronous}},[i("g-icon",{class:{"icon-loading":t.synchronousPlan},attrs:{"icon-class":t.synchronousPlan?"loading":"issue"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.issue")))])],1)]),t._v(" "),i("p",{staticClass:"card-module__subtitle"},[t._v("注意：1. 为了保证可点击性，时间过短的计划适当延长; 2. 单计划不具备结束时间，为了可显示化，显示一定长度; 3. 不同颜色区分："),i("span",{staticClass:"dot",staticStyle:{"border-color":"rgba(255,255,255,.6)"}}),t._v("巡逻循环计划"),i("span",{staticClass:"dot",staticStyle:{"border-color":"rgba(64, 158, 255, 0.7)"}}),t._v("巡逻单次计划"),i("span",{staticClass:"dot",staticStyle:{"border-color":"rgba(102, 224, 197, 0.7)"}}),t._v("值守计划")]),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.planLoading,expression:"planLoading"}],staticClass:"card-chart"},[i("div",{staticClass:"card-chart__content"},[i("bar",{attrs:{"data-source":t.computedPlanConfig}})],1)]),t._v(" "),i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!1,top:"15vh",title:t.dialogPlanTitle,visible:t.dialogPlanVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"600px"},on:{"update:visible":function(e){t.dialogPlanVisible=e},close:function(e){t.showChartTip=!0}}},[i("el-tabs",{directives:[{name:"loading",rawName:"v-loading",value:t.loadingOnePlan,expression:"loadingOnePlan"}],staticStyle:{height:"400px"},attrs:{"tab-position":"left"},on:{"tab-click":t.tagChange},model:{value:t.currentPlan,callback:function(e){t.currentPlan=e},expression:"currentPlan"}},[i("el-tab-pane",{staticStyle:{height:"400px"},attrs:{disabled:"patrol"===t.hiddenPlan,label:"巡逻计划",name:"patrol"}},[i("el-scrollbar",{attrs:{"wrap-class":"patrol-wrapper"}},[i("el-form",{ref:"patrolForm",staticStyle:{width:"85%"},attrs:{rules:t.rules,model:t.temp_patrol,size:t.formSize,"label-position":"right","label-width":"140px"}},[i("el-form-item",{attrs:{label:"机器人名称",prop:"deviceName"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.temp_patrol.deviceName,callback:function(e){t.$set(t.temp_patrol,"deviceName","string"===typeof e?e.trim():e)},expression:"temp_patrol.deviceName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"巡逻计划名称",prop:"planName"}},[i("el-input",{model:{value:t.temp_patrol.planName,callback:function(e){t.$set(t.temp_patrol,"planName","string"===typeof e?e.trim():e)},expression:"temp_patrol.planName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"计划类型",prop:"type"}},[i("el-select",{staticClass:"filter-item",attrs:{placeholder:"默认 - 请选择模式"},model:{value:t.temp_patrol.type,callback:function(e){t.$set(t.temp_patrol,"type",e)},expression:"temp_patrol.type"}},[i("el-option",{attrs:{label:"巡逻",value:1}}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],1)],1),t._v(" "),1===+t.ver?i("el-form-item",{attrs:{label:"执行模式",prop:"singleExecution"}},[i("el-radio-group",{model:{value:t.temp_patrol.singleExecution,callback:function(e){t.$set(t.temp_patrol,"singleExecution",e)},expression:"temp_patrol.singleExecution"}},[i("el-radio",{attrs:{label:"0"}},[t._v("循环执行")]),t._v(" "),i("el-radio",{attrs:{label:"1"}},[t._v("单次执行")])],1)],1):t._e(),t._v(" "),1===+t.ver?i("el-form-item",{attrs:{label:"重复",prop:"weekly"}},[i("el-checkbox-group",{model:{value:t.temp_patrol.weekly,callback:function(e){t.$set(t.temp_patrol,"weekly",e)},expression:"temp_patrol.weekly"}},[i("el-checkbox",{attrs:{label:"1"}},[t._v("星期一")]),t._v(" "),i("el-checkbox",{attrs:{label:"2"}},[t._v("星期二")]),t._v(" "),i("el-checkbox",{attrs:{label:"3"}},[t._v("星期三")]),t._v(" "),i("el-checkbox",{attrs:{label:"4"}},[t._v("星期四")]),t._v(" "),i("el-checkbox",{attrs:{label:"5"}},[t._v("星期五")]),t._v(" "),i("el-checkbox",{attrs:{label:"6"}},[t._v("星期六")]),t._v(" "),i("el-checkbox",{attrs:{label:"7"}},[t._v("星期日")])],1)],1):t._e(),t._v(" "),i("el-form-item",{attrs:{label:"开始时间",prop:"beginTime"}},[i("el-time-picker",{attrs:{"value-format":"HH:mm:ss"},model:{value:t.temp_patrol.beginTime,callback:function(e){t.$set(t.temp_patrol,"beginTime",e)},expression:"temp_patrol.beginTime"}})],1),t._v(" "),"0"===t.temp_patrol.singleExecution?i("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[i("el-time-picker",{attrs:{"value-format":"HH:mm:ss"},model:{value:t.temp_patrol.endTime,callback:function(e){t.$set(t.temp_patrol,"endTime",e)},expression:"temp_patrol.endTime"}})],1):t._e(),t._v(" "),"0"===t.temp_patrol.singleExecution?i("el-form-item",{attrs:{label:"巡逻周期时长",prop:"timeInterval"}},[i("el-input",{model:{value:t.temp_patrol.timeInterval,callback:function(e){t.$set(t.temp_patrol,"timeInterval","string"===typeof e?e.trim():e)},expression:"temp_patrol.timeInterval"}},[i("template",{slot:"append"},[t._v("分钟")])],2)],1):t._e(),t._v(" "),t._l(t.temp_patrol.line,function(e,a){return i("el-form-item",{key:e.key,attrs:{label:"线路名称"+(a+1),prop:"line."+a+".value",rules:{required:!0,message:"路线名称",trigger:"blur"}}},[i("el-select",{staticClass:"filter-item",attrs:{placeholder:"默认 - 请选择地图"},model:{value:e.value,callback:function(i){t.$set(e,"value",i)},expression:"item.value"}},[t._l(t.patrolLineInfo,function(t,e){return i("el-option",{key:e,attrs:{label:t.lineName+"-地图"+t.mapName,value:t.lineId}})}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2),t._v(" "),i("g-icon",{staticClass:"form-item__icon form-item__icon--bg",attrs:{"icon-class":"minus"},on:{click:function(i){return t.handleLineDel(e)}}})],1)})],2)],1)],1),t._v(" "),i("el-tab-pane",{staticStyle:{height:"400px"},attrs:{disabled:"guard"===t.hiddenPlan,label:"值守计划",name:"guard"}},[i("el-scrollbar",[i("el-form",{ref:"guardForm",staticStyle:{width:"85%"},attrs:{rules:t.rules2,model:t.temp_guard,"label-position":"right",size:t.formSize,"label-width":"140px"}},[i("el-form-item",{attrs:{label:"计划名称",prop:"planName"}},[i("el-input",{model:{value:t.temp_guard.planName,callback:function(e){t.$set(t.temp_guard,"planName","string"===typeof e?e.trim():e)},expression:"temp_guard.planName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"值守点",prop:"beaconPointCode"}},[i("div",{staticClass:"g-search-group g-search-group--append",staticStyle:{width:"100%"}},[i("el-select",{staticClass:"filter-item",attrs:{placeholder:"默认 - 请选择"},on:{change:t.handleBeaconChange},model:{value:t.temp_guard.beaconPointCode,callback:function(e){t.$set(t.temp_guard,"beaconPointCode",e)},expression:"temp_guard.beaconPointCode"}},[t._l(t.beaconPointList,function(t){return i("el-option",{key:t.id,attrs:{label:t.name+"-地图"+t.mapName,value:t.code}})}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2),t._v(" "),i("div",{staticClass:"g-search-group__append",staticStyle:{cursor:"pointer"},on:{click:t.handleSyncBeacon}},[i("g-icon",{attrs:{"icon-class":"synchronous"}})],1)],1)]),t._v(" "),i("el-form-item",{attrs:{label:"值守点地图名"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.temp_guard.mapName,callback:function(e){t.$set(t.temp_guard,"mapName","string"===typeof e?e.trim():e)},expression:"temp_guard.mapName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"值守动作",prop:"actionName"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.temp_guard.actionName,callback:function(e){t.$set(t.temp_guard,"actionName","string"===typeof e?e.trim():e)},expression:"temp_guard.actionName"}},[i("template",{slot:"append"},[i("span",{staticClass:"form-item__uploadTxt",on:{click:function(e){t.dialogActionTableVisible=!0}}},[t._v("选择")])])],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"值守类型"}},[i("el-select",{staticClass:"filter-item",attrs:{placeholder:"默认 - 请选择"},model:{value:t.temp_guard.type,callback:function(e){t.$set(t.temp_guard,"type",e)},expression:"temp_guard.type"}},[i("el-option",{attrs:{label:"普通值守",value:1}}),t._v(" "),i("el-option",{attrs:{label:"药剂库值守",value:2}}),t._v(" "),i("el-option",{attrs:{label:"站岗值守",value:3}}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],1)],1),t._v(" "),i("el-form-item",{attrs:{label:"动作循环时长",prop:"actionInterval"}},[i("el-input",{attrs:{type:"number"},model:{value:t.temp_guard.actionInterval,callback:function(e){t.$set(t.temp_guard,"actionInterval",t._n(e))},expression:"temp_guard.actionInterval"}},[i("template",{slot:"append"},[t._v("分钟")])],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"开始时间",prop:"beginTime"}},[i("el-time-picker",{attrs:{"value-format":"HH:mm:ss"},model:{value:t.temp_guard.beginTime,callback:function(e){t.$set(t.temp_guard,"beginTime",e)},expression:"temp_guard.beginTime"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"结束时间",prop:"endTime"}},[i("el-time-picker",{attrs:{"value-format":"HH:mm:ss"},model:{value:t.temp_guard.endTime,callback:function(e){t.$set(t.temp_guard,"endTime",e)},expression:"temp_guard.endTime"}})],1)],1)],1)],1)],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"20vh",title:"查找动作列表",visible:t.dialogActionTableVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"600px"},on:{"update:visible":function(e){t.dialogActionTableVisible=e}}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list_actions,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":"",height:t.tableHeight},on:{"row-dblclick":t.handleSelectActionCode}},[i("el-table-column",{attrs:{align:"center",label:"动作组编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.actionCode))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:"center",label:"动作组名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.actionName))]}}])})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"show",rawName:"v-show",value:"guard"!==t.currentPlan,expression:"currentPlan !== 'guard'"}],on:{click:t.handleLineAdd}},[t._v("添加路线")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogPlanVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handlePlanSubmit}},[t._v("提交")])],1)],1)],1),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.patrolLoading,expression:"patrolLoading"}],staticClass:"card-module bg flex",attrs:{"element-loading-text":"正在加载图表"}},[i("Toolbar",{attrs:{name:"巡逻路线"}},[5===+t.naviType?i("span",{staticClass:"action",on:{click:t.handleSyncQRCode}},[i("g-icon",{class:{"is-synchronous":t.synchronousQR},attrs:{"icon-class":"synchronous"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.synchronous")+"二维码"))])],1):t._e(),t._v(" "),i("span",{staticClass:"action",on:{click:t.handleSyncMap}},[i("g-icon",{class:{"is-synchronous":t.synchronousMap},attrs:{"icon-class":"synchronous"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.synchronous")+"地图"))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.handleSyncGuardPoints}},[i("g-icon",{class:{"is-synchronous":t.synchronousGuard},attrs:{"icon-class":"synchronous"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.synchronous")+"值守点"))])],1)]),t._v(" "),i("div",{staticClass:"card-module__content",staticStyle:{"max-height":"650px","min-height":"300px","overflow-x":"hidden","overflow-y":"auto"}},[i("div",{staticClass:"g-flexbox mapsGroup"},t._l(t.list_map,function(e){return i("div",{key:e.id||e.mapId,staticClass:"g-flexbox__item"},[i("div",{staticClass:"map"},[i("section",{staticClass:"fl map-info"},[i("div",{staticClass:"map-info__head"},[t._v("地图名称："),i("span",[t._v(t._s(t._f("defaultValue")(e.mapName)))])]),t._v(" "),i("div",{staticClass:"map-info__body"},[i("img",{style:e.picWidth>e.picHeight?{width:"100%"}:{height:"100%"},attrs:{src:e.mapPicUrl,alt:"激光地图"}})]),t._v(" "),i("div",{staticClass:"map-info__foot"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"上传地图",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"upload"},on:{click:function(i){return t.handleOpenUploadDialog(e)}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"删除地图",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"delete"},on:{click:function(i){return t.handleMapDelete(e)}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"百度地图标定",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"Bmap"},on:{click:function(i){return t.handleBmapAdjustment(e)}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"航拍地图标定",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"aerial"},on:{click:function(i){return t.handleAerialAdjustment(e)}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"编辑路线巡逻点",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"waypoint"},on:{click:function(i){return t.handleWaypoint(e)}}})],1),t._v(" "),"QRCodeMap"===e.mapType?i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"下发二维码地图",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"issue"},on:{click:function(i){return t.issueQRCode(e)}}})],1):t._e()],1)]),t._v(" "),i("section",{staticClass:"map-form"},[i("div",{staticClass:"map-form__head"},[i("div",{staticClass:"g-tabs__nav-wrap"},[i("div",{staticClass:"g-tabs__nav"},[i("span",{staticClass:"g-tabs__item",class:{"is-active":"GPatrol"===e.component},attrs:{"data-type":"GPatrol"},on:{click:function(t){e.component="GPatrol"}}},[t._v("巡逻路线")]),t._v(" "),i("span",{staticClass:"g-tabs__item",class:{"is-active":"GGuard"===e.component},attrs:{"data-type":"GGuard"},on:{click:function(t){e.component="GGuard"}}},[t._v("值守点管理")])]),t._v(" "),"GGuard"===e.component?i("div",{staticClass:"g-tabs__nav--sufiix"},[i("transition",{attrs:{name:"fade",mode:"out-in"}},[e.extra.searchGuard?i("div",{staticClass:"g-search-group g-search-group--append",staticStyle:{width:"180px"}},[i("input",{directives:[{name:"model",rawName:"v-model",value:e.extra.searchGuardKey,expression:"item.extra.searchGuardKey"}],staticClass:"el-input__inner",attrs:{type:"text",placeholder:"编号和名称(Enter)",size:"mini"},domProps:{value:e.extra.searchGuardKey},on:{keyup:function(i){return!i.type.indexOf("key")&&t._k(i.keyCode,"enter",13,i.key,"Enter")?null:t.handleSearchPlanBykey(i,e.extra.searchGuardKey,e,!1)},input:function(i){i.target.composing||t.$set(e.extra,"searchGuardKey",i.target.value)}}}),t._v(" "),i("div",{staticClass:"g-search-group__append"},[i("g-icon",{attrs:{"icon-class":"right"},on:{click:function(i){return t.handleSearchPlanBykey(i,e.extra.searchGuardKey,e,!0)}}})],1)]):i("g-icon",{attrs:{"icon-class":"search"},on:{click:function(t){e.extra.searchGuard=!e.extra.searchGuard}}})],1)],1):t._e()])]),t._v(" "),i("div",{staticClass:"map-form__content"},[i("transition",{attrs:{name:"fade-transform",mode:"out-in"}},[i("keep-alive",[i(e.component,{tag:"component",attrs:{"device-id":t.robotId,source:"GPatrol"===e.component?e.patrolLineInfo:e.beaconPointInfo},on:{edit:t.openMap}})],1)],1)],1)])])])}),0)])],1),t._v(" "),i("div",{staticClass:"card-module bg"},[i("Toolbar",{attrs:{name:"动作组"}},[i("span",{staticClass:"action",on:{click:t.handleActionDelMore}},[i("g-icon",{attrs:{"icon-class":"batch-delete"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.batchdelete")))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.handleActionPlus}},[i("g-icon",{attrs:{"icon-class":"plus"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.plus")))])],1),t._v(" "),i("span",{staticClass:"action",on:{click:t.handleActionIssue}},[i("g-icon",{class:{"icon-loading":t.synchronousAction},attrs:{"icon-class":t.synchronousAction?"loading":"issue"}}),t._v(" "),i("span",{staticClass:"action__desc"},[t._v(t._s(t.$t("base.issue")))])],1)]),t._v(" "),i("div",{staticClass:"card-module__content "},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.list_actions,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":"",height:t.tableHeight},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"动作组编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.actionCode))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"动作组名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.actionName))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"单元个数"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.unitNum))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.createTime))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"操作",width:"120px"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon  el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionDelete(e.row)}}})]}}])})],1)],1),t._v(" "),i("div",{staticClass:"pagination-container",staticStyle:{padding:"1rem 0.5rem"}},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)])])],1),t._v(" "),i("GActionGroup",{attrs:{"device-id":t.robotId,"action-id":t.actionId,visible:t.dialogActionVisible,title:t.dialogActionTitle},on:{"update:visible":function(e){t.dialogActionVisible=e},submit:t.handleActionSubmit}}),t._v(" "),i("GPatrolDetail",{attrs:{row:t.lineInfo,"robot-id":t.robotId,visible:t.dialogMapVisible},on:{"update:visible":function(e){t.dialogMapVisible=e},ActionGroup:t.handlePatrolDetail}}),t._v(" "),i("el-dialog",{attrs:{center:"","append-to-body":!0,top:"25vh",title:"上传激光地图",visible:t.dialogUploadVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"400px"},on:{"update:visible":function(e){t.dialogUploadVisible=e}}},[i("el-upload",{ref:"upload",staticClass:"dialog-upload",staticStyle:{width:"100%","text-align":"center"},attrs:{action:"",drag:"","auto-upload":!1,"on-change":t.handleFileChange,"list-type":"picture",limit:1,"on-remove":t.handleFileRemove,accept:".jpeg,.jpg,.png,.gif",multiple:!1}},[i("i",{staticClass:"el-icon-upload"}),t._v(" "),i("div",{staticClass:"el-upload__text"},[t._v("\n        将文件拖到此处，或\n        "),i("em",[t._v("点击上传")])])]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleUploadClose}},[t._v("取消")]),t._v(" "),i("el-button",{attrs:{disabled:!t.temp_upload.picFile},on:{click:t.handleMapUpload}},[t._v("提交")])],1)],1),t._v(" "),i("GBmapAdjustment",{attrs:{source:t.lineInfo,visible:t.dialogBmapVisible},on:{"update:visible":function(e){t.dialogBmapVisible=e}}}),t._v(" "),i("GAerialAdjustment",{attrs:{source:t.lineInfo,visible:t.dialogAerialVisible},on:{"update:source":function(e){t.lineInfo=e},"update:visible":function(e){t.dialogAerialVisible=e}}}),t._v(" "),i("PAtrolLinePoint",{attrs:{"p-map-name":t.mapName,visible:t.dialogPatrolLinePoint},on:{"update:visible":function(e){t.dialogPatrolLinePoint=e}}})],1)},n=[],o=(i("3b2b"),i("7f7f"),i("20d6"),i("ac6a"),i("5df3"),i("96cf"),i("3b8d")),l=(i("a481"),i("28a5"),i("768b")),s=i("b50b"),r=i.n(s),c=i("5c27"),d=i.n(c),u=i("0811"),p=i("0a1f"),h=i("b40f"),m=i("f6a3"),f=i("4b06"),g=i("7ac5"),v=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{"append-to-body":!0,top:"8vh",title:t.dialogTitle,visible:t.dialogMapVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"1040px"},on:{"update:visible":function(e){t.dialogMapVisible=e},opened:t.opened,closed:t.closed}},[i("div",{staticClass:"map-info"},[i("span",{staticClass:"dot start"},[t._v("开始巡逻点")]),t._v(" "),i("span",{staticClass:"dot action"},[t._v("有动作的巡逻点")]),t._v(" "),i("span",{staticClass:"dot no-action"},[t._v("无动作的巡逻点")]),t._v(" "),i("span",{staticClass:"dot end"},[t._v("结束巡逻点")]),t._v(" "),i("div",{staticClass:"speed"},[i("label",{staticClass:"radio__title"},[t._v("速度设置： ")]),t._v(" "),i("el-radio-group",{on:{change:t.handleSpeedChange},model:{value:t.lineSpeed,callback:function(e){t.lineSpeed=e},expression:"lineSpeed"}},[i("el-radio",{attrs:{label:3}},[t._v("高")]),t._v(" "),i("el-radio",{attrs:{label:2}},[t._v("中")]),t._v(" "),i("el-radio",{attrs:{label:1}},[t._v("低")])],1)],1)]),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],staticClass:"map",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[i("zr-component",{ref:"zr-components",attrs:{error:t.errorVisible},on:{resize:t.resize,loadComplete:t.loadComplete}}),t._v(" "),i("el-card",{directives:[{name:"show",rawName:"v-show",value:t.actionVisible,expression:"actionVisible"}],ref:"card",staticClass:"patrol-card",attrs:{shadow:"always"}},[i("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[i("span",[t._v("巡逻点："+t._s(t._f("defaultValue")(t.temp_action.pointCode)))])]),t._v(" "),i("table",{staticClass:"patrod-card__table"},[i("tr",[i("td",[t._v("动作编号")]),t._v(" "),i("td",[t._v("动作名称")])]),t._v(" "),t._l(t.temp_action.actions,function(e){return i("tr",{key:e.actionCode},[i("td",[t._v(t._s(t._f("defaultValue")(e.actionCode)))]),t._v(" "),i("td",[t._v(t._s(t._f("defaultValue")(e.actionName)))])])})],2)])],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"25vh",title:t.dialogActionTitle,visible:t.dialogActionVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"show-close":!1,width:"500px"},on:{"update:visible":function(e){t.dialogActionVisible=e}}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.temp_action.actions,"row-key":t.rowKey2,fit:"","empty-text":t.emptyText,"highlight-current-row":""}},[i("el-table-column",{attrs:{align:t.textAlign,label:"动作编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.actionCode)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"动作名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.actionName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign},scopedSlots:t._u([{key:"header",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-plus card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleOpenActionDialog(e.row)}}})]}},{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionGroupEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionGroupDelete(e.row)}}})]}}])})],1),t._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleSumbitAll}},[t._v("应用到所有点")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogActionVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleSumbit}},[t._v("应用到当前点")])],1)],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"25vh",title:"双击选择动作组",visible:t.dialogTableVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"show-close":!1,width:"700px"},on:{"update:visible":function(e){t.dialogTableVisible=e}}},[i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey2,fit:"","empty-text":t.emptyText,"highlight-current-row":"","max-height":t.tableHeight,height:t.tableHeight},on:{"row-dblclick":t.handleDblClick}},[i("el-table-column",{attrs:{align:t.textAlign,label:"编码"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.actionCode)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.actionName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.createTime)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign},scopedSlots:t._u([{key:"header",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-plus card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionGroupAdd(e.row)}}})]}},{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleActionGroupEdit(e.row)}}})]}}])})],1),t._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogTableVisible=!1}}},[t._v("确定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"25vh",title:"编辑机柜名称",visible:t.dialoDevVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"show-close":!1,width:"500px"},on:{"update:visible":function(e){t.dialoDevVisible=e}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"90%",margin:"0 auto"},attrs:{model:t.temp_dev,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"机柜名称",prop:"name"}},[i("el-input",{attrs:{size:t.formSize,placeholder:""},model:{value:t.temp_dev.name,callback:function(e){t.$set(t.temp_dev,"name","string"===typeof e?e.trim():e)},expression:"temp_dev.name"}},[i("template",{slot:"append"},[i("g-icon",{staticStyle:{"font-size":"16px",cursor:"pointer"},attrs:{"icon-class":"plus"},on:{click:t.handleDevAdd}})],1)],2)],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialoDevVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{on:{click:t.handleDevSubmit}},[t._v("确定")])],1)],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"17vh",title:"双击选择机柜设备",visible:t.dialoDevTableVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"show-close":!1,width:"800px"},on:{"update:visible":function(e){t.dialoDevTableVisible=e}}},[i("div",{staticClass:"cabinet"},[i("el-row",{staticClass:"filter-container",attrs:{gutter:20}},[i("el-col",{attrs:{span:8}},[i("el-input",{staticClass:"filter-item",attrs:{size:"mini",placeholder:"仪表名称"},model:{value:t.devQuery.deviceName,callback:function(e){t.$set(t.devQuery,"deviceName",e)},expression:"devQuery.deviceName"}},[i("svg-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"document"},slot:"prefix"})],1)],1),t._v(" "),i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{size:"mini"},on:{click:t.fetchDevData}},[t._v("查询")])],1)],1),t._v(" "),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading2,expression:"listLoading2"}],ref:"devTable",staticStyle:{width:"100%"},attrs:{data:t.list_dev,"row-key":t.rowKey3,fit:"",border:"","empty-text":t.emptyText,"highlight-current-row":"","max-height":t.tableHeight,height:t.tableHeight},on:{"row-dblclick":t.handleDevDblclick}},[i("el-table-column",{attrs:{align:t.textAlign,label:"仪表名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.devName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"仪表编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.devCode)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"仪表类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.type)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.textAlign,label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.addTime)))]}}])})],1),t._v(" "),i("div",{staticClass:"pagination-container",staticStyle:{"margin-top":"35px"}},[i("el-pagination",{attrs:{"current-page":t.devQuery.page,"page-sizes":[10,20,30,50],"page-size":t.devQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total_dev},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialoDevTableVisible=!1}}},[t._v("确定")])],1)]),t._v(" "),i("div",{staticClass:"dialog-footer",staticStyle:{"text-align":"center"},attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.closed}},[t._v("确定")])],1)],1)},b=[],_=(i("c5f6"),i("95c0")),y=i.n(_),x=i("ed08"),k=i("f3a3"),w=i("c7b2"),C=i("55ee"),I=i("edc0"),A=i("26a1"),T=i("bc19"),P=p["patrol"].modifyPatrolSpeedLevel,S=p["patrol"].addBeaconPointAndDevicePanel,V=p["patrol"].searchDeviceList,z=p["patrol"].findDevByDevCode,N=p["patrol"].findRobotActionByCode,L=p["patrol"].modifyLaserLineInfo,$=p["patrol"].searchRobotActionList,O=p["patrol"].getVitrualWallInfo,M={name:"GPatrolDetail",filters:{filterTitle:function(t){return Array.isArray(t)&&t.map(function(t){return t.pointCode}).join(" -> ")}},components:{ZrComponent:T["a"]},mixins:[w["a"]],props:{robotId:{type:[Number,String],default:null},visible:{type:Boolean,default:!1},row:{type:Object,default:function(){return{}}}},data:function(){return{emptyText:null,textAlign:"center",tableHeight:"300px",listLoading:!0,listLoading2:!0,list:[],formSize:"small",dialogTitle:"",dialogActionTitle:"",needModal:!0,closeOnClickModel:!1,dialogMapVisible:!1,dialogActionVisible:!1,dialogTableVisible:!1,dialoDevVisible:!1,dialoDevTableVisible:!1,sending:!1,errorVisible:!1,mapLoading:!0,zrwidth:0,zrheight:0,zr:null,zposition:[0,0],zscale:[1,1],zorigin:[0,0],zrotation:0,group_back:null,group_overlay:null,mapInfo:{},wall:{},actionVisible:!1,temp_action:{},temp_dev:{code:"",name:"",deviceId:"",actionIds:"",devId:""},devQuery:{page:1,limit:10,deviceName:""},list_dev:[],total_dev:null,lineSpeed:null}},watch:{visible:function(t){this.dialogMapVisible=t}},created:function(){},mounted:function(){this.closed(),this.$bus.$on("GPatrolDetail:updateActionGroup",this.handleConnection)},methods:{handleConnection:function(t){t&&this.fetchActionGroups()},opened:function(){var t=this,e=this.row,i=this.mapInfo,a=this.robotId;i.mapId&&i.mapId===e.mapId&&i.lineNo===e.lineNo||(this.mapInfo=e,this.lineSpeed=e.lineSpeed,this.dialogTitle="编辑地图 -- 名称【".concat(e.lineName,"】，ID【").concat(e.lineNo,"】"),this.reset(),O({deviceId:a,lineCode:this.mapInfo.lineNo}).then(function(e){t.wall=e.data?e.data.virtualWall:{},t.update()},function(t){console.log(t)}))},closed:function(){this.$emit("update:visible",!1),this.dialogMapVisible=!1},loadComplete:function(t){this.zr=t},resize:function(){this.zr&&this.reset()},reset:function(){this.zr&&this.zr.clear(),this.mapLoading=!1,this.errorVisible=!1,this.init(),this.$emit("mapTransform",this.group_back,{enableRotation:!0}),this.draw().catch(this.drawErrorCallback)},init:function(){var t=this.mapInfo,e=this.$refs["zr-components"].$el;if(this.zrwidth=t.mapPicWidth,this.zrheight=t.mapPicHeight,this.zrwidth&&this.zrheight){var i=Object(k["c"])(e,this.zrwidth,this.zrheight),a=i.left,n=i.top,o=Object(k["b"])(e,this.zrwidth,this.zrheight);this.zorigin=[this.zrwidth/2,this.zrheight/2],this.zscale=[o,o],this.zposition=[a,n],this.group_back=new y.a.Group,this.group_overlay=new y.a.Group,this.group_overlay.silent=!1,this.zr.add(this.group_back),this.zr.add(this.group_overlay),this.zr.refreshImmediately()}},update:function(){this.errorVisible=!1,this.group_overlay&&this.group_overlay.removeAll(),this.draw().catch(this.drawErrorCallback)},draw:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,s,r,c,d,u,p,h,m,f,g,v,b,_,y,k,w,T,P,S,V,z,N,L,$,O,M,E,D,B,j,G,R,U,F,W,H,Q,q,J,Y;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.zrwidth,i=this.zrheight,a=this.group_back,n=this.group_overlay,o=this.zposition,s=this.zscale,r=this.zrotation,c=this.mapInfo,d=this,a||n){t.next=4;break}return t.abrupt("return");case 4:if(a.position=o.slice(0),a.scale=s.slice(0),a.rotation=r,!(a.childCount()<1)){t.next=15;break}return this.mapLoading=!1,u=c.mapPicUrl,t.next=12,Object(x["j"])(u);case 12:p=t.sent,h=Object(C["c"])(p,e,i),h&&a.add(h);case 15:if(m=c.pointActions,Array.isArray(m)&&m.length>0){f=0,g=null,v=null;while(-1!==f)g=null,v=null,b=this._.findIndex(m,function(t){return t.radius&&0!==t.radius},f+1),-1!==b?(1===b||b-f===1?v=m.slice(b-1,b+1):(g=m.slice(f,b),v=m.slice(b-1,b+1)),f=b):(g=m.slice(f),f=b),g&&(_=g.map(function(t){return[parseFloat(t.x),parseFloat(t.y)]}),y={style:{lineWidth:3,opacity:.8,stroke:"#99f3be"},shape:{points:_,smooth:0}},k=Object(C["f"])(y,e,i,o,s,r),k&&n.add(k)),v&&(w=v[0],T=w.x,P=w.y,S=v[1],V=S.x,z=S.y,N=S.radius,L=Object(I["b"])([+T,+P],[+V,+z],N),L&&($=Object(l["a"])(L,2),O=$[0],M=$[1],E=this.calculateAngle([+T,+P],[+O,+M]),D=this.calculateAngle([+V,+z],[+O,+M]),B={style:{lineWidth:3,opacity:.8,stroke:"#99f3be"},shape:{cx:parseFloat(O),cy:parseFloat(M),r:Math.abs(N),startAngle:E,endAngle:D,clockwise:D>E&&D-E<Math.PI}},j=Object(C["a"])(B,e,i,o,s,r),j&&n.add(j)))}if(Array.isArray(m)&&m.length>0&&m.forEach(function(t,a,l){var c="#2DAB61",u=Array.isArray(t.actions)&&t.actions.length>0?"#f9bb01":"#777777",p="red",h={fill:"#43f88e",lineWidth:2,stroke:"#43f88e"},m={style:{strokeNoScale:!0,fill:u,lineWidth:2,stroke:u},shape:{cx:parseFloat(t.x),cy:parseFloat(t.y),r:5},onclick:function(e){d.currentLineNo,d.temp_action=d._.cloneDeep(t),d.dialogActionTitle="编辑巡逻点“".concat(t.pointCode,"”的动作组"),d.$nextTick(function(){d.dialogActionVisible=!0,d.actionVisible=!1,d.actionTimeout&&clearTimeout(d.actionTimeout)})},onmouseover:function(e){var i=e.target;i.attr({style:h}),d.temp_action=Object.assign({},t),d.actionVisible=!0,d.actionTimeout&&clearTimeout(d.actionTimeout),d.$nextTick(function(){var t=e.offsetX,i=e.offsetY,a=d.$refs["card"].$el,n=a.offsetWidth,o=a.offsetHeight,l=t-n/2,s=i-o-20;Object(A["g"])(a,"transform","translate(".concat(l,"px, ").concat(s,"px)"))})},onmouseout:function(t){var e=t.target;0===a?e.attr({style:{fill:c,lineWidth:2,stroke:c}}):a===l.length-1?e.attr({style:{fill:p,lineWidth:2,stroke:p}}):e.attr({style:{fill:u,lineWidth:2,stroke:u}}),d.actionTimeout=setTimeout(function(){d.actionVisible=!1},1e3)}},f=Object(C["b"])(m,e,i,o,s,r);0===a&&f.attr({style:{fill:c,lineWidth:2,stroke:c}}),a===l.length-1&&f.attr({style:{fill:p,lineWidth:2,stroke:p}}),f&&n.add(f)}),G=this.wall,R="#222222",U="#0000FF",G)for(Y in F=G.polylines,Array.isArray(F)&&F.length>0&&F.forEach(function(t){var a=t.points.map(function(t){return[t.x,t.y]}),l={shape:{points:a,smooth:0},style:{stroke:R,lineWidth:1}},c=Object(C["f"])(l,e,i,o,s,r);c&&n.add(c)}),W=G.lines,Array.isArray(W)&&W.length>0&&W.forEach(function(t){var a={style:{stroke:R,lineWidth:1},shape:{x1:t.start.x,y1:t.start.y,x2:t.end.x,y2:t.end.y,percent:1}},l=Object(C["d"])(a,e,i,o,s,r);l&&n.add(l)}),H=G.circles,Array.isArray(H)&&H.length>0&&H.forEach(function(t){var a={shape:{cx:t.x,cy:t.y,r:t.radius},style:{fill:R,lineWidth:1}},l=Object(C["b"])(a,e,i,o,s,r);l&&n.add(l)}),Q=G.polygons,Array.isArray(Q)&&Q.length>0&&Q.forEach(function(t){var a={style:{stroke:R,lineWidth:1},shape:{points:t.points.length<1?[]:t.points.map(function(t){return[t.x,t.y]}),smooth:0}},l=Object(C["e"])(a,e,i,o,s,r);l&&n.add(l)}),q=G.rectangles,Array.isArray(q)&&q.length>0&&q.forEach(function(t){var a={shape:{x:t.start.x,y:t.start.y,width:+t.end.x-+t.start.x,height:+t.end.y-+t.start.y,r:[0,0,0,0]},style:{fill:R,lineWidth:1}},l=Object(C["g"])(a,e,i,o,s,r);l&&n.add(l)}),J=G.slopes,Y="",J)"circles"===Y?Array.isArray(J[Y])&&J[Y].length>0&&J[Y].forEach(function(t){var a={shape:{cx:t.x,cy:t.y,r:t.radius},style:{fill:U,lineWidth:1}},l=Object(C["b"])(a,e,i,o,s,r);l&&n.add(l)}):"lines"===Y?Array.isArray(J[Y])&&J[Y].length>0&&J[Y].forEach(function(t){var a={style:{stroke:U,lineWidth:1},shape:{x1:t.start.x,y1:t.start.y,x2:t.end.x,y2:t.end.y,percent:1}},l=Object(C["d"])(a,e,i,o,s,r);l&&n.add(l)}):"polygons"===Y?Array.isArray(J[Y])&&J[Y].length>0&&J[Y].forEach(function(t){var a={style:{fill:U,lineWidth:1},shape:{points:t.length<1?[]:t.map(function(t){return[t.x,t.y]}),smooth:0}},l=Object(C["e"])(a,e,i,o,s,r);l&&n.add(l)}):"polylines"===Y?Array.isArray(J[Y])&&J[Y].length>0&&J[Y].forEach(function(t){var a=t.points.map(function(t){return[t.x,t.y]}),l={shape:{points:a,smooth:0},style:{stroke:U,lineWidth:1}},c=Object(C["f"])(l,e,i,o,s,r);c&&n.add(c)}):"rectangles"===Y&&Array.isArray(J[Y])&&J[Y].length>0&&J[Y].forEach(function(t){var a={shape:{x:t.start.x,y:t.start.y,width:+t.end.x-+t.start.x,height:+t.end.y-+t.start.y,r:[0,0,0,0]},style:{fill:U,lineWidth:1}},l=Object(C["g"])(a,e,i,o,s,r);l&&n.add(l)});this.group_back.dirty(),this.group_overlay.dirty(),this.mapLoading=!1;case 25:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),drawErrorCallback:function(t){console.log(t),this.errorVisible=!0,this.mapLoading=!1},calculateAngle:function(t,e){var i=Object(l["a"])(t,2),a=i[0],n=i[1],o=Object(l["a"])(e,2),s=o[0],r=o[1],c=Math.abs(Object(I["a"])([a,n],[s,r])),d=s-a,u=r-n;return d<=0&&u>=0?c:d>0&&u>0?Math.PI-c:d>=0&&u<=0?Math.PI+c:d<0&&u<0?2*Math.PI-c:void 0},closeActionDialog:function(){this.dialogActionVisible=!1},rowKey:function(t){return t.actionCode},rowKey2:function(t){return t.actionId},rowKey3:function(t){return t.id},handleActionGroupEdit:function(t){this.$emit("ActionGroup",t)},handleActionGroupAdd:function(){this.$emit("ActionGroup")},handleActionGroupDelete:function(t){var e=this.temp_action.actions;e.splice(e.indexOf(t),1)},handleOpenActionDialog:function(t){var e=this,i=this.temp_action.actions;Array.isArray(i)&&i.length>0?this.$message({message:"警告哦，一个巡逻点只能添加一个动作组",type:"warning"}):(this.fetchActionGroups(),this.$nextTick(function(){e.dialogTableVisible=!0}))},fetchActionGroups:function(){var t=this,e=this.robotId;this.listLoading=!0,this.emptyText=null,$({deviceId:e}).then(function(e){t.list=e.data.rows,t.listLoading=!1},function(e){console.log(e),t.listLoading=!1,t.emptyText="网络错误"})},handleDblClick:function(t,e,i){var a=this,n=t.actionCode,o=t.actionName,l=t.actionId;this.temp_action.hasOwnProperty("actions")?this.temp_action.actions.push({actionCode:n,actionName:o,actionId:l}):this.temp_action.actions=[{actionCode:n,actionName:o,actionId:l}],this.$nextTick(function(){a.dialogTableVisible=!1})},handleSumbit:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,l,s,r,c,d;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,e=this.row.id,i=this.robotId,this.sending=!0,t.next=6,L({lineId:e,pointActions:JSON.stringify(this.temp_action)});case 6:return a=t.sent,this.$message.success(a.msg),this.sending=!1,n=this.mapInfo.pointActions,o=this._.findIndex(n,{pointCode:this.temp_action.pointCode}),o>-1&&n.splice(o,1,this._.cloneDeep(this.temp_action)),this.update(),l=this.temp_action.actions[0].actionCode,t.next=16,N({deviceId:i,actionCode:l});case 16:if(s=t.sent,r=s.data.units,c=[],r.forEach(function(t){6===+t.actionType&&c.push(t.soundText)}),!(c.length<1)){t.next=22;break}return t.abrupt("return",!1);case 22:return this.temp_dev=Object.assign({},{code:l,deviceId:i,name:"",actionIds:c.join("|"),devId:""}),this.dialoDevVisible=!0,t.next=26,z({devCode:"".concat(i,"_").concat(l)});case 26:d=t.sent,this.temp_dev.name=d.data.devName,this.temp_dev.devId=d.data.id,t.next=34;break;case 31:t.prev=31,t.t0=t["catch"](0),this.sending=!1;case 34:case"end":return t.stop()}},t,this,[[0,31]])}));function e(){return t.apply(this,arguments)}return e}(),handleSumbitAll:function(){var t=this;this.sending=!0;var e=this.row.id;L({lineId:e,patch:"1",pointActions:JSON.stringify(this.temp_action)}).then(function(e){t.$message.success(e.msg),t.sending=!1;var i=t.temp_action.actions,a=t.mapInfo.pointActions;a.forEach(function(e){e.actions=t._.cloneDeep(i)}),t.update()},function(e){t.sending=!1,console.log(e)})},fetchDevData:function(){var t=this;this.listLoading2=!0,this.emptyText=null,V(this.devQuery).then(function(e){t.list_dev=e.data.rows,t.total_dev=e.data.total,t.listLoading2=!1},function(e){t.listLoading2=!1,t.emptyText="网络错误",console.log(e)})},handleDevSubmit:function(){var t=this;this.sending=!0,S(this.temp_dev).then(function(e){t.$message.success(e.msg),t.sending=!1,t.dialoDevVisible=!1},function(e){t.sending=!1,console.log(e)})},handleDevAdd:function(){var t=this;this.fetchDevData(),this.$nextTick(function(){t.dialoDevTableVisible=!0})},handleDevDblclick:function(t,e,i){var a=this,n=t.devName,o=t.devId;this.temp_dev.name=n,this.temp_dev.devId=o,this.$nextTick(function(){a.dialoDevTableVisible=!1})},handleSizeChange:function(t){this.devQuery.limit=t,this.fetchDevData()},handleCurrentChange:function(t){this.devQuery.page=t,this.fetchDevData()},handleSpeedChange:function(t){var e=this,i=this.robotId,a=this.mapInfo.lineNo;P({deviceId:i,lineCode:a,speed:t}).then(function(t){e.$message.success(t.msg)},function(t){console.log(t)})}}},E=M,D=(i("a16d"),i("2877")),B=Object(D["a"])(E,v,b,!1,null,"2eed0987",null),j=B.exports,G=i("aa60"),R=i("f72c"),U=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("el-dialog",{attrs:{center:"","append-to-body":!0,top:"10vh",title:"路线巡逻点管理",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"1024px"},on:{"update:visible":function(e){t.dialogVisible=e},opened:t.opened,closed:t.closed}},[i("div",{staticClass:"adjustment"},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":"",height:t.tableHeight},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"巡逻点名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.pointName))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"地图名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.mapName))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"动作组"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.actionName))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"点类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("filterType")(e.row.pointType)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"X坐标"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.x))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"Y坐标"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.y))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"角度"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.angle))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"创建时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(e.row.addTime))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleDelete(e.row)}}})]}}])})],1),t._v(" "),i("div",{staticClass:"pagination-container",staticStyle:{"margin-top":"1rem"}},[i("el-pagination",{attrs:{"current-page":t.listQuery.page,"page-sizes":[10,20,30,50],"page-size":t.listQuery.limit,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleDeleteBatch}},[t._v("批量删除")]),t._v(" "),i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("关闭")]),t._v(" "),i("el-button",{on:{click:t.handleBuildPatrolLine}},[t._v("组巡逻路线")])],1)]),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"20vh",title:t.dialogTitleEdit,visible:t.dialogVisibleEdit,modal:t.needModalEdit,"close-on-click-modal":t.closeOnClickModel,width:"550px"},on:{"update:visible":function(e){t.dialogVisibleEdit=e}}},[i("el-form",{ref:"dataForm",staticStyle:{width:"90%",margin:"0 auto"},attrs:{rules:t.rules,model:t.temp,size:t.formSize,"label-position":t.formAlign,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"巡逻点名称"}},[i("el-input",{attrs:{placeholder:""},model:{value:t.temp.pointName,callback:function(e){t.$set(t.temp,"pointName","string"===typeof e?e.trim():e)},expression:"temp.pointName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"动作组",prop:"actionId"}},[i("el-select",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{placeholder:"默认 - 请选择",clearable:""},model:{value:t.temp.actionId,callback:function(e){t.$set(t.temp,"actionId",e)},expression:"temp.actionId"}},[t._l(t.actionsList,function(t){return i("el-option",{key:t.actionCode,attrs:{label:t.actionName,value:t.actionCode}})}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],2)],1),t._v(" "),i("el-form-item",{attrs:{label:"点类型",prop:"type"}},[i("el-select",{attrs:{placeholder:"默认 - 请选择"},model:{value:t.temp.type,callback:function(e){t.$set(t.temp,"type",e)},expression:"temp.type"}},[i("el-option",{attrs:{label:"普通",value:1}}),t._v(" "),i("el-option",{attrs:{label:"二维码调整位置",value:2}}),t._v(" "),i("g-icon",{staticClass:"el-input__icon",attrs:{slot:"prefix","icon-class":"list"},slot:"prefix"})],1)],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisibleEdit=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sendingEdit,expression:"sendingEdit"}],on:{click:t.handleSave}},[t._v("保存")])],1)],1),t._v(" "),i("GABuildPatrolLine",{attrs:{linecode:0,"bmap-name":t.listQuery.mapName,visible:t.dialogBuildPatrolLineVisible},on:{"update:visible":function(e){t.dialogBuildPatrolLineVisible=e}}})],1)},F=[],W=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{attrs:{center:"","append-to-body":!0,top:"6vh",title:"组巡逻路线",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,"before-close":t.beforeClose,width:"850px"},on:{"update:visible":function(e){t.dialogVisible=e},opened:t.opened}},[i("el-form",{staticStyle:{width:"80%",margin:"0 auto"},attrs:{"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"路线名称"}},[i("el-input",{attrs:{placeholder:""},model:{value:t.lineName,callback:function(e){t.lineName="string"===typeof e?e.trim():e},expression:"lineName"}})],1)],1),t._v(" "),i("div",{staticStyle:{height:"600px"}},[i("div",{staticClass:"fl unrelevance"},[i("div",{staticClass:"unrelevance__head"},[t._v("未选择的巡逻点")]),t._v(" "),i("div",{staticClass:"unrelevance__content"},[i("el-scrollbar",[i("ul",{ref:"left",staticClass:"unrelevance__list"},t._l(t.list,function(e,a){return i("li",{key:a,staticClass:"unrelevance__listItem",class:{"is-active":e.active},attrs:{"data-id":e.id},on:{click:function(i){return t.handleLeftSelected(e)},dblclick:function(i){return t.handleDblForUnRelevance(e)}}},[t._v("\n              "+t._s(e.pointName)+"\n            ")])}),0)])],1)]),t._v(" "),i("div",{staticClass:"fr relevance"},[i("div",{staticClass:"relevance__head"},[t._v("已选择的巡逻点")]),t._v(" "),i("div",{staticClass:"relevance__content"},[i("el-scrollbar",[i("ul",{ref:"right",staticClass:"relevance__list"},t._l(t.list2,function(e,a){return i("li",{key:a,staticClass:"relevance__listItem",class:{"is-active":e.active},attrs:{"data-id":e.id},on:{click:function(i){return t.handleRightSelected(e)},dblclick:function(i){return t.handleDblForRelevance(e)}}},[t._v("\n              "+t._s(e.pointName)+"\n            ")])}),0)])],1)]),t._v(" "),i("div",{staticClass:"center"},[i("g-icon",{attrs:{"icon-class":"right2"},on:{click:t.handleRightAll}}),t._v(" "),i("g-icon",{attrs:{"icon-class":"right"},on:{click:t.handleRight}}),t._v(" "),i("g-icon",{attrs:{"icon-class":"swap"},on:{click:t.handleSwap}}),t._v(" "),i("g-icon",{attrs:{"icon-class":"left"},on:{click:t.handleLeft}}),t._v(" "),i("g-icon",{attrs:{"icon-class":"left2"},on:{click:t.handleLeftAll}})],1)]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.closeDialog}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],on:{click:t.submit}},[t._v("保存")])],1)],1)},H=[],Q=p["patrol"].searchPatrolLinePointList,q=p["patrol"].getLineCode,J=p["patrol"].uploadPatrolLineInfoApp,Y=p["patrol"].getLineInfo,Z={name:"GABuildPatrolLine",props:{bmapName:{type:String,default:""},linecode:{type:Number,default:null},visible:{type:Boolean,default:!1}},data:function(){return{formSize:"small",needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,listQuery:{page:1,limit:1e3,mapName:null,pointName:null},deviceId:null,lineName:"",mapName:"",activeColor:"rgba(19, 206, 102, 0.4)",switchValue:{activeValue:1,inactiveValue:0},temp:{userId:"",oldPassword:"",password:"",password2:""},list:[],list2:[],sending:!1}},watch:{id:function(t,e){this.getList()},visible:function(t){this.dialogVisible=t}},created:function(){},mounted:function(){},methods:{opened:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getList();case 2:0!==this.linecode&&this.getLinePointList();case 3:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),beforeClose:function(t){this.temp={userId:"",oldPassword:"",password:"",password2:""},this.$emit("update:visible",!1),t()},closeDialog:function(){this.temp={userId:"",oldPassword:"",password:"",password2:""},this.$emit("update:visible",!1),this.dialogVisible=!1},getList:function(){var t=this;this.listQuery.mapName=this.mapName,Q(this.listQuery).then(function(e){t.list=e.data.rows,t.deviceId=e.data.rows[0].robotId,t.mapName=e.data.rows[0].mapName,t.listLoading=!1},function(){t.listLoading=!1,t.emptyText="网络错误"})},getLinePointList:function(){var t=this;Y({deviceId:this.deviceId,lineCode:this.linecode}).then(function(e){for(var i=t._.map(e.data.rows,"id"),a=0;a<t.list.length;a++)-1!==i.indexOf(t.list[a].id)&&(t.list.splice(a,1),a--);t.list2=[],t.lineName=e.data.content[0].lineName,t.lineId=e.data.content[0].id;for(var n=0;n<e.data.content[0].pointActions.length;n++){var o=e.data.content[0].pointActions[n],l=o.originPointId,s=o.pointName;t.list2.push({id:l,pointName:s})}t.listLoading=!1},function(){t.listLoading=!1,t.emptyText="网络错误"})},submit:function(){var t=this,e=1,i=[],a=1;q({deviceId:this.deviceId}).then(function(t){e=t.data});for(var n=0;n<this.list2.length;n++){a=e,a+=n<9?"0"+(n+1):""+(n+1);var o={X:this.list2[n].x,Y:this.list2[n].y,angle:this.list2[n].angle,id:a,action_id:this.list2[n].actionId,originPointId:this.list2[n].id,type:this.list2[n].type};i.push(o)}var l={lineCode:e,pointList:JSON.stringify(i),mapName:this.mapName,deviceId:this.deviceId,lineName:this.lineName,lineType:2};0!==this.lineId&&(l.lineId=this.lineId),J(l).then(function(e){t.$message.success(e.msg),t.dialogVisible=!1},function(t){console.log(t)})},handleRightAll:function(){var t=this.list,e=this.list2;while(t.length>0){var i=t.splice(t.length-1)[0];e.push(Object.assign({},i,{ctrlKey:0}))}},handleRight:function(){var t=this.list,e=this.list2,i=t.length-1;while(i>-1){var a=t[i];a.hasOwnProperty("active")&&a.active&&e.push(Object.assign({},t.splice(i,1)[0],{active:!1})),--i}},handleLeftAll:function(){var t=this.list,e=this.list2;while(e.length>0){var i=e.splice(e.length-1)[0];t.push(Object.assign({},i,{ctrlKey:0}))}},handleLeft:function(){var t=this.list,e=this.list2,i=e.length-1;while(i>-1){var a=e[i];a.hasOwnProperty("active")&&a.active&&t.push(Object.assign({},e.splice(i,1)[0],{active:!1})),--i}},handleSwap:function(){var t=this.list,e=this.list2,i=t.slice(0),a=e.slice(0);this.list=a,this.list2=i},handleRightSelected:function(t){var e=this.list2,i=t.active;e.splice(e.indexOf(t),1,Object.assign({},t,{active:!i}))},handleDblForUnRelevance:function(t){var e=this.list2,i=this.list;e.push(i.splice(i.indexOf(t),1)[0])},handleDblForRelevance:function(t){var e=this.list2,i=this.list;i.push(e.splice(e.indexOf(t),1)[0])},handleLeftSelected:function(t){var e=this.list,i=t.active;e.splice(e.indexOf(t),1,Object.assign({},t,{active:!i}))},dealPatrolLinePointList:function(t){if(1===t.ret){this.list2=[];for(var e=0;e<t.row.length;e++){this.list2.push(t.row[e]);for(var i=0;i<this.list.length;i++)if(this.list[i].id===t.row[e].id){this.list.remove(i);break}}}}}},K=Z,X=(i("313b"),Object(D["a"])(K,W,H,!1,null,"77e05219",null)),tt=X.exports,et=p["patrol"].searchPatrolLinePointList,it=p["patrol"].searchRobotActionList,at=p["patrol"].modifyPatrolLinePoint,nt=p["patrol"].deletePatrolLinePoint,ot=p["patrol"].deletePatrolLinePointBatch,lt={name:"PAtrolLinePoint",components:{GABuildPatrolLine:tt},filters:{filterType:function(t){var e="";return e=1===t?"二维码调整位置":"普通",e}},props:{pMapName:{type:String,default:""},visible:{type:Boolean,default:!1}},data:function(){return{emptyText:null,textAlign:"left",tableHeight:565,list:[],total:null,formSize:"mini",listLoading:!1,listQuery:{page:1,limit:10,mapName:null,pointName:null},needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,sending:!1,dialogTitle:"编辑路线导航点",temp:{id:"",pointName:"",actionId:"",type:"",robotId:"",x:"",y:"",angle:"",mapId:""},needModalEdit:!0,closeOnClickModelEdit:!1,dialogVisibleEdit:this.visibleEdit,sendingEdit:!1,dialogTitleEdit:"编辑路线导航点",actionsList:[],rules:{pointName:[{required:!0,message:"不能为空",trigger:"blur"}]},dialogBuildPatrolLineVisible:!1,multipleSelection:[]}},watch:{visible:function(t){this.dialogVisible=t}},created:function(){},mounted:function(){},methods:{rowKey:function(t){return t.id},opened:function(){this.getList()},closed:function(){this.$emit("update:visible",!1)},handleSizeChange:function(t){this.listQuery.limit=t,this.getList()},handleCurrentChange:function(t){this.listQuery.page=t,this.getList()},getList:function(){var t=this;this.listLoading=!0,this.list=[],this.emptyText=null,this.listQuery.mapName=this.pMapName,et(this.listQuery).then(function(e){t.list=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(){t.listLoading=!1,t.emptyText="网络错误"})},handleSave:function(){var t=this;this.$refs["dataForm"].validate(function(e){if(e){var i=t._.cloneDeep(t.temp),a=t._.cloneDeep(t.actionsList);if(i.actionId)for(var n=0;n<a.length;n++)if(i.actionId===a[n].actionCode){i.actionId=a[n].actionId;break}t.sending=!0,at(i).then(function(e){t.$message.success(e.msg),t.sendingEdit=!1,t.getList(),t.$nextTick(function(){t.dialogVisibleEdit=!1})},function(e){t.sending=!1,console.log(e)})}})},handleDelete:function(t){var e=this,i=t.id;this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){nt({pointId:i}).then(function(i){e.$message({type:"success",message:i.msg}),e.list.splice(e.list.indexOf(t),1)},function(t){console.log(t)})}).catch(function(){})},handleEdit:function(t){var e=this,i=t.id,a=t.pointName,n=t.actionId,o=t.type,l=t.robotId,s=t.x,r=t.y,c=t.angle,d=t.mapId;this.dialogTitleEdit="编辑巡逻路线点",this.temp=Object.assign({},{id:i,pointName:a,actionId:n,type:o,robotId:l,x:s,y:r,angle:c,mapId:d}),this.getActionList(t.robotId),this.dialogVisibleEdit=!0,this.$nextTick(function(){e.$refs["dataForm"].clearValidate()})},getActionList:function(t){var e=this;it({deviceId:t,page:1,limit:999}).then(function(t){e.actionsList=t.data.rows,e.listLoading=!1},function(t){console.log(t),e.listLoading1=!1,e.emptyText="网络错误"})},handleBuildPatrolLine:function(){this.dialogBuildPatrolLineVisible=!0},handleSelectionChange:function(t){this.multipleSelection=t},handleDeleteBatch:function(){var t=this,e=this._.map(this.multipleSelection,"id").join(",");this.$confirm("此操作将永久删除该数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){ot({patrolLinePoints:e}).then(function(e){t.$message({type:"success",message:e.msg})},function(t){console.log(t)})}).catch(function(){})}}},st=lt,rt=(i("4d29"),Object(D["a"])(st,U,F,!1,null,"68fcc755",null)),ct=rt.exports,dt=p["patrol"].qrcodeMapImageEmit,ut=p["patrol"].qrcodeMapImageGeneration,pt=p["patrol"].deleteUnattendedPlan,ht=p["patrol"].changeUnattendedPlanState,mt=p["patrol"].modifyUnattendedPlan,ft=p["patrol"].addUnattendedPlan,gt=p["patrol"].searchBeaconPointList,vt=p["patrol"].deletePatrolPlan,bt=p["patrol"].findOnePatrolPlan,_t=p["patrol"].modifyPatrolPlan,yt=p["patrol"].addPatrolPlan,xt=p["patrol"].selectLineInfo,kt=p["patrol"].changePatrolPlanState,wt=p["patrol"].uploadPatrolLinePlans,Ct=p["patrol"].deliverUnattendedPlan,It=p["patrol"].selectRobotPatrolPlanList,At=p["patrol"].findUnattendedPlanByParam,Tt=p["patrol"].uploadCustomizeMap,Pt=p["patrol"].deleteLaserMap,St=p["patrol"].syncNaviPos,Vt=p["patrol"].syncMap,zt=p["patrol"].searchPatrolLineAndPoints,Nt=p["patrol"].setRobotAction,Lt=p["patrol"].deleteAction,$t=p["patrol"].deleteActionBatch,Ot=p["patrol"].searchRobotActionList;function Mt(t){if("undefined"===typeof t)return 0;var e=86400,i=t.split(":"),a=Object(l["a"])(i,3),n=a[0],o=a[1],s=a[2];return parseFloat(((3600*n+60*o+1*s)/e*24).toFixed(2))}var Et={name:"RobotPlan",components:{bar:h["a"],GActionGroup:m["a"],GGuard:f["a"],GPatrol:g["a"],GPatrolDetail:j,GBmapAdjustment:G["a"],GAerialAdjustment:R["a"],PAtrolLinePoint:ct},mixins:[u["a"]],data:function(){var t=this,e=function(e,i,a){var n=t.temp_guard.beginDate,o=n?new Date(n.replace(/-/g,"/")).getTime():0,l=i?new Date(i.replace(/-/g,"/")).getTime():0;o>l&&a(new Error("开始日期不能大于结束日期")),a()},i=function(e,i,a){var n=t.temp_guard.beginTime,o=n?new Date("1997/01/01 "+n):0,l=i?new Date("1997/01/01 "+i):0;o>l?a(new Error("开始时间不能大于结束时间")):a()},a=function(e,i,a){var n=t.temp_patrol.singleExecution;n?a():i?a():a(new Error("结束日期不能为空"))},n=function(e,i,a){var n=t.temp_patrol.singleExecution;n?a():i?a():a(new Error("周期时长不能为空"))};return{filename:this.$t("route.robot-plan",{}),emptyText:null,tableHeight:320,list:[],total:null,listLoading:!0,patrolLoading:!0,planLoading:!0,listQuery:{page:1,limit:10,deviceId:""},robotId:"",list_actions:[],deleteSelected:"",actionId:"",list_map:[],synchronousPlan:!1,synchronousQR:!0,synchronousMap:!1,synchronousGuard:!1,synchronousAction:!1,lineInfo:{},currentLineId:"",mapName:"",list_plan:{patrol:[],guard:[]},patrolLineInfo:[],beaconPointList:[],hiddenPlan:"",currentPlan:"guard",dialogActionTitle:"",dialogPlanTitle:"添加计划",needModal:!0,closeOnClickModel:!1,dialogActionVisible:!1,dialogMapVisible:!1,dialogUploadVisible:!1,dialogBmapVisible:!1,dialogAerialVisible:!1,dialogLaserVisible:!1,dialogPlanVisible:!1,dialogActionTableVisible:!1,sending:!1,dialogPatrolLinePoint:!1,temp_upload:{id:"",picFile:null},loadingOnePlan:!1,temp_patrol:{deviceId:"",deviceName:"",planId:"",planName:"",lineId:"",beginTime:"",endTime:"",timeInterval:"",singleExecution:"0",weekly:[],type:"",line:[{value:"",key:Date.now()}]},temp_guard:{deviceId:"",id:"",beaconPointCode:"",planName:"",actionCode:"",actionName:"",actionInterval:"",mapName:"",beginTime:"",endTime:"",type:""},rules:{planName:[{required:!0,message:"名称不能为空",trigger:"blur"}],type:[{required:!0,message:"类型不能为空",trigger:"blur"}],timeInterval:[{validator:n,trigger:"blur"}],beginTime:[{required:!0,message:"开始日期不能为空",trigger:"blur"}],weekly:[{required:!0,message:"请选择时间",trigger:"blur"}],endTime:[{validator:a,trigger:"blur"}]},rules2:{beaconPointCode:[{required:!0,message:"值守点不能为空",trigger:"blur"}],planName:[{required:!0,message:"计划名称不能为空",trigger:"blur"}],actionName:[{required:!0,message:"地图名不能为空",trigger:"blur"}],actionInterval:[{required:!0,message:"动作循环执行间隔不能为空",trigger:"blur"}],beginDate:[{required:!0,message:"开始日期不能为空",trigger:"blur"}],endDate:[{required:!0,message:"结束日期不能为空",trigger:"blur"},{validator:e,trigger:"blur"}],beginTime:[{required:!0,message:"开始时间不能为空",trigger:"blur"}],endTime:[{required:!0,message:"结束时间不能为空",trigger:"blur"},{validator:i,trigger:"blur"}]},showChartTip:!0,ver:0,naviType:""}},computed:{robotname:function(){var t=this.$store.getters["robot/getRobotById"](this.robotId);return t?t.robotName:"--"},computedPlanConfig:function(){var t=this,e=this.robotname,i=this.list_plan,a=this.handlePatrolPlan,n=this.handleGuardPlan,o=this.computedPlan(i.patrol,"patrol"),l=this.computedPlan(i.guard,"guard"),s=o.length,c=l.length,u="";u=s>c?Array.prototype.concat.call([],Array.apply(null,{length:s-c}),l.reverse(),void 0,o):Array.prototype.concat.call([],l.reverse(),void 0,o,Array.apply(null,{length:c-s}));var p=0,h=0,m=u.map(function(t,e){if(Array.isArray(t)&&t.length>0){for(var i=t.length,a=[],n=0;n<i;n++){var o=0===n?{s:0,e:0}:t[n-1],l=t[n];l.s>o.e&&a.push({s:o.e,e:l.s,transparent:!0}),a.push(t[n])}return a.length>p&&(p=a.length,h=e),a}return t}).map(function(t){return Array.isArray(t)?t.length<p?Array.apply(null,{length:p-t.length}).concat(t):t:Array.apply(null,{length:p})}),f=m[h];window.handlePatrolPlan=a,window.handleGuardPlan=n;var g=f.map(function(e,i){var a=Array.apply(null,{length:m.length}).map(function(e,a){if(m[a]&&m[a][i]){var n=m[a][i],o={value:n.e-n.s,label:{normal:{show:!!n.tag,formatter:"{tag|".concat(n.tag,"}  {iconbg|}"),rich:{tag:{color:"#000"},iconbg:{height:14,backgroundColor:{image:1===+n.state?r.a:d.a}}}},emphasis:{rich:{tag:{color:"#fff"},iconbg:{height:14,backgroundColor:{image:1===+n.state?r.a:d.a}}}}},tooltip:{showContent:t.showChartTip,triggerOn:"click",hideDelay:0,formatter:function(t){if(n.transparent)return"";var e=n.value,i=n.type;return"patrol"===i?'<table class="g-plan-tooltip">\n                        <tr><td>巡逻计划：<span>'.concat(e.planName||"--","</span></td><td>巡逻路线：<span>").concat(e.lineName||"--","</span></td></tr>\n                        <tr><td>巡逻周期时长（分）：<span>").concat(e.timeInterval/60||"--","</span></td><td>状态：<span>").concat(1===e.state?"已启用":"未启用",'</span></td></tr>\n                        <tr><td>启用：<input type="checkbox" id="enablePlan" ').concat(~~e.state?"checked":"",' style="vertical-align: middle; cursor: pointer;" onclick="handlePatrolPlan(\'').concat(e.planId,"', 'state', '").concat(e.state,'\')" /></td>\n                        <td>操作：\n                        <i style="cursor: pointer;" class="gosuncn-icon el-icon-ext-edit card-table__icon" onclick="handlePatrolPlan(\'').concat(e.planId,'\', \'edit\')" ></i>\n                        <i style="cursor: pointer;" class="gosuncn-icon el-icon-ext-delete card-table__icon" onclick="handlePatrolPlan(\'').concat(e.planId,"', 'del')\" ></i>\n                        </td></tr>\n                      </table>"):'<table class="g-plan-tooltip">\n                        <tr><td>计划名称：<span>'.concat(e.planName||"--","</span></td><td>值守点：<span>").concat(e.beaconPointName||"--","</span></td></tr>\n                        <tr><td>更新时间：<span>").concat(e.updateTime||"--","</span></td><td>状态：<span>").concat(1===e.state?"已启用":"未启用",'</span></td></tr>\n                        <tr><td>启用：<input type="checkbox" id="enablePlan" style="vertical-align: middle; cursor: pointer;" ').concat(~~e.state?"checked":""," onclick=\"handleGuardPlan('").concat(e.id,"', 'state', '").concat(e.state,'\')" /></td>\n                        <td>操作：\n                        <i style="cursor: pointer;" class="gosuncn-icon el-icon-ext-edit card-table__icon" onclick="handleGuardPlan(\'').concat(e.id,'\', \'edit\')" ></i>\n                        <i style="cursor: pointer;" class="gosuncn-icon el-icon-ext-delete card-table__icon" onclick="handleGuardPlan(\'').concat(e.id,"', 'del')\" ></i>\n                        </td></tr>\n                      </table>")}}},l="";return l=n.transparent?{itemStyle:{normal:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"},emphasis:{barBorderColor:"rgba(0,0,0,0)",color:"rgba(0,0,0,0)"}}}:"patrol"===n.type&&1===+n.singleExecution?{itemStyle:{normal:{color:"rgba(64, 158, 255, 0.4"},emphasis:{color:"rgba(64, 158, 255, 0.7)"}}}:"guard"===n.type?{itemStyle:{normal:{color:"rgba(102, 224, 197, 0.4)"},emphasis:{color:"rgba(102, 224, 197, 0.7)"}}}:{itemStyle:{normal:{color:"rgba(255,255,255,.25)"},emphasis:{color:"rgba(255,255,255,.6)"}}},Object.assign({},o,l)}return null});return{name:"entity".concat(i),type:"bar",stack:"总量",label:{normal:{show:!0,position:"inside"}},data:a}});return{direction:"vertical",grid:{top:"5%",left:"0.5%",right:"5%",bottom:"10%"},xAxis:{name:"单位：H",type:"value",min:0,max:24,offset:-130,interval:1},yAxis:{type:"category",splitLine:{show:!1},name:e||"暂无机器人 test",nameLocation:"center",data:Array.apply(null,{length:m.length}).map(function(t,e){return{value:"entity".concat(e),textStyle:{color:"transparent"}}})},barMaxWidth:25,tooltip:{show:!0,position:"top",trigger:"item",triggerOn:"click",backgroundColor:"rgba(0,0,0, .6)",borderColor:"rgba(255,255,255, 0.3)",borderWidth:1,enterable:!0},label:{show:!1},series:g}}},created:function(){var t=this.$route.params.id;this.ver=this.$route.query.ver,this.naviType=this.$route.query.naviType,this.robotId=t,this.update()},mounted:function(){},methods:{goBack:function(){var t=this.fromRoute;t.fullPath.indexOf("/dashboard")>-1?this.$router.go(-1):this.$router.replace({path:"/config-center/system-mgr/robot-mgr"})},selectClick:function(t){var e=this.robotId;if(!e||t===e)return!1;this.isReverse=!1,this.selectVisible=!1,this.robotId=t,this.update&&this.update()},update:function(){this.fetchActionList(),this.fetchPatrolData(),this.fetchPlan(),this.patrolLineInfo=[],this.beaconPointList=[]},handleIssue:function(){},rowKey:function(t){return t.id},handleSizeChange:function(t){this.listQuery.limit=t,this.fetchActionList()},handleCurrentChange:function(t){this.listQuery.page=t,this.fetchActionList()},fetchPlan:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.robotId,t.prev=1,this.planLoading=!0,t.next=5,Promise.all([It({deviceId:e,page:1,limit:999}),At({deviceId:e,page:1,limit:999})]);case 5:i=t.sent,a=Object(l["a"])(i,2),n=a[0],o=a[1],this.list_plan.patrol=n.data.rows,this.list_plan.guard=o.data.rows,this.planLoading=!1,t.next=18;break;case 14:t.prev=14,t.t0=t["catch"](1),this.planLoading=!1,console.log("计划配置:",t.t0);case 18:case"end":return t.stop()}},t,this,[[1,14]])}));function e(){return t.apply(this,arguments)}return e}(),fetchPatrolPlan:function(){var t=this,e=this.robotId;It({deviceId:e,page:1,limit:999}).then(function(e){t.list_plan.patrol=e.data.rows},function(t){console.log(t)})},fetchGuardPlan:function(){var t=this,e=this.robotId;At({deviceId:e,page:1,limit:999}).then(function(e){t.list_plan.guard=e.data.rows},function(t){console.log(t)})},resetPlanTemp:function(){this.temp_guard={deviceId:"",id:"",beaconPointCode:"",planName:"",actionCode:"",actionName:"",actionInterval:"",mapName:"",beginTime:"",endTime:"",type:""},this.temp_patrol={deviceId:"",deviceName:"",planId:"",planName:"",lineId:"",beginTime:"",endTime:"",timeInterval:"",singleExecution:"0",weekly:[],type:"",line:[{value:"",key:Date.now()}]}},openPlanDialog:function(){var t=this,e=this.robotId;this.resetPlanTemp(),this.hiddenPlan="",this.currentPlan="patrol",this.dialogPlanVisible=!0,this.temp_guard.deviceId=e,this.temp_patrol.deviceId=e,this.temp_patrol.deviceName=this.robotname,this.fetchLineInfo(),this.$nextTick(function(){t.$refs["patrolForm"]&&t.$refs["patrolForm"].clearValidate(),t.$refs["guardForm"]&&t.$refs["guardForm"].clearValidate()})},tagChange:function(t){var e=this,i=this.currentPlan;"guard"===i&&this.fetchBeacon(),this.$nextTick(function(){e.$refs["patrolForm"]&&e.$refs["patrolForm"].clearValidate(),e.$refs["guardForm"]&&e.$refs["guardForm"].clearValidate()})},handlePatrolPlan:function(t,e,i){var a=this;if("undefined"!==typeof e){var n=this.list_plan.patrol,o=this._.findIndex(n,{planId:+t}),l=n[o];switch(e){case"state":var s=document.getElementById("enablePlan").checked;kt({planId:t,state:~~s}).then(function(t){a.$message.success(t.msg),l.state=~~s},function(t){console.log(t)});break;case"edit":this.showChartTip=!1,document.querySelector(".g-plan-tooltip").parentNode.style.opacity=0,this.currentPlan="patrol",this.hiddenPlan="guard",this.dialogPlanTitle="编辑巡逻计划",this.temp_patrol.deviceId=this.robotId,this.temp_patrol.deviceName=this.robotname,this.temp_patrol.planId=t,this.fetchLineInfo(),this.loadingOnePlan=!0,bt({planId:t}).then(function(t){a.loadingOnePlan=!1;var e=t.data,i=e.beginTime,n=e.endTime,o=e.lineIds,l=e.planName,s=e.timeInterval,r=e.singleExecution,c=e.weekly,d=void 0===c?"":c,u=e.type;a.temp_patrol=Object.assign({},a.temp_patrol,{planName:l,beginTime:i,endTime:n,singleExecution:r,weekly:d.split(","),type:+u,timeInterval:s/60,lineId:o,line:o.split(",").map(function(t){return{key:Math.floor(1e4*Math.random()),value:+t}})})},function(t){a.loadingOnePlan=!1,console.log(t)}),this.dialogPlanVisible=!0,this.$nextTick(function(){a.$refs["patrolForm"]&&a.$refs["patrolForm"].clearValidate()});break;case"del":this.$confirm("此操作将永久删除该计划, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){vt({planId:t}).then(function(t){a.$message({type:"success",message:t.msg}),n.splice(o,1)},function(t){console.log(t)})}).catch(function(){});break}}},handleGuardPlan:function(t,e){var i=this;if("undefined"!==typeof e){var a=this.list_plan.guard,n=this._.findIndex(a,{id:+t}),o=a[n];switch(e){case"state":var l=document.getElementById("enablePlan").checked;ht({planId:t,state:~~l}).then(function(t){i.$message.success(t.msg),o.state=~~l},function(t){console.log(t)});break;case"edit":this.showChartTip=!1,document.querySelector(".g-plan-tooltip").parentNode.style.opacity=0,this.dialogPlanTitle="编辑值守计划",this.currentPlan="guard",this.hiddenPlan="patrol",this.temp_guard.deviceId=this.robotId,this.temp_guard.id=t,this.fetchBeacon();var s=o.beaconPointCode,r=o.planName,c=o.actionCode,d=o.actionName,u=o.actionInterval,p=o.mapName,h=o.beginTime,m=o.endTime,f=o.type;this.temp_guard=Object.assign({},this.temp_guard,{beaconPointCode:s,planName:r,actionCode:c,actionName:d,actionInterval:u,mapName:p,beginTime:h,endTime:m,type:f}),this.dialogPlanVisible=!0,this.currentPlan="guard",this.hiddenPlan="patrol",this.$nextTick(function(){i.$refs["guardForm"]&&i.$refs["guardForm"].clearValidate()});break;case"del":this.$confirm("此操作将永久删除该计划, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){pt({id:t}).then(function(t){i.$message({type:"success",message:t.msg}),a.splice(n,1)},function(t){console.log(t)})}).catch(function(){});break}}},fetchLineInfo:function(){var t=this,e=this.robotId;0===this.patrolLineInfo.length&&xt({deviceId:e}).then(function(e){t.patrolLineInfo=e.data},function(t){console.log(t)})},fetchBeacon:function(){var t=this,e=this.robotId;0===this.beaconPointList.length&&gt({deviceId:e,page:1,limit:999}).then(function(e){t.beaconPointList=e.data.rows},function(t){return console.log(t)})},handlePlanSynchronous:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,s,r=this;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.robotId,i=this.synchronousPlan,!i){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,this.synchronousPlan=!0,t.next=7,Promise.all([wt({deviceId:e},{timeout:0}),Ct({deviceId:e},{timeout:0})]);case 7:a=t.sent,n=Object(l["a"])(a,2),o=n[0],s=n[1],this.synchronousPlan=!1,1===o.ret&&this.$message({type:"success",message:"巡逻计划: ".concat(o.msg)}),1===s.ret&&setTimeout(function(){r.$message({type:"success",message:"值守计划：: ".concat(s.msg)})},0),t.next=20;break;case 16:t.prev=16,t.t0=t["catch"](3),this.synchronousPlan=!1,console.log(t.t0);case 20:case"end":return t.stop()}},t,this,[[3,16]])}));function e(){return t.apply(this,arguments)}return e}(),computedPlan:function(t,e){var i=[[]];if(Array.isArray(t)&&t.length>0){var a=this._.cloneDeep(t);a.forEach(function(t){var a=t.beginTime,n=t.endTime,o=t.planName,l=t.singleExecution,s=t.state,r="".concat(o);if(a&&n){var c=Mt(a),d=1===+l?c+3>24?24:c+3:Mt(n);if(d===c)return!1;d<c?d-0<.5&&(d=.5):d-c<.5&&(d=c+.5);var u={value:t,tag:r,singleExecution:l,state:s,type:e},p=function(t){return Object.assign({},u,t)},h=i.some(function(e){if(d<c){if(0===e.length)return e.push(p({s:c,e:24,value:t,transparent:!1})),e.unshift(p({s:0,e:d,transparent:!1})),!0;var i=e[e.length-1];return i.e<=c&&i.s>=d&&(e.push(p({s:c,e:24,transparent:!1})),e.unshift(p({s:0,e:d,transparent:!1})),!0)}if(0===e.length)return e.push(p({s:c,e:d,transparent:!1})),!0;for(var a=e.length,n=!1,o=0;o<a;++o){var l=a>1&&o>0?e[o-1]:{e:0},s=e[o],r=a>1&&o<a-1?e[o+1]:{s:24};if(s.e<=c&&d<=r.s){e.splice(o+1,0,p({s:c,e:d,transparent:!1})),n=!0;break}if(l.e<=c&&d<=s.s){e.splice(o,0,p({s:c,e:d,transparent:!1})),n=!0;break}n=!1}return n});if(!h){var m=[];d<c?(m.push(p({s:0,e:d,transparent:!1})),m.push(p({s:c,e:24,transparent:!1}))):m.push(p({s:c,e:d,transparent:!1})),i.push(m)}}})}return i},listenEcharts:function(t){console.log(t)},handleLineAdd:function(){var t=this.temp_patrol.line;t.push({key:Date.now(),value:""});var e=this.$refs["patrolForm"].$el,i=document.querySelector(".patrol-wrapper");e.scrollHeight>i.clientHeight&&this.$nextTick(function(){i.scrollTop=e.scrollHeight-i.clientHeight+5})},handleLineDel:function(t){var e=this.temp_patrol.line;e.splice(e.indexOf(t),1)},handleBeaconChange:function(t){var e=this,i=this.beaconPointList;i.some(function(i){return t===i.code&&(e.temp_guard.mapName=i.mapName,!0)})},handleSyncBeacon:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:return e=this.robotId,t.prev=1,t.next=4,St({deviceId:e});case 4:i=t.sent,this.$message.success(i.msg),a=gt({deviceId:e,page:1,limit:999}),this.beaconPointList=a.data.rows,t.next=13;break;case 10:t.prev=10,t.t0=t["catch"](1),console.log(t.t0);case 13:case"end":return t.stop()}},t,this,[[1,10]])}));function e(){return t.apply(this,arguments)}return e}(),handleSelectActionCode:function(t,e,i){var a=this;this.temp_guard.actionCode=t.actionCode,this.temp_guard.actionName=t.actionName,this.$nextTick(function(){a.dialogActionTableVisible=!1})},handlePlanSubmit:function(t){var e=this,i=this.currentPlan;if("patrol"===i){var a=this.temp_patrol,n=a.planId?_t:yt;this.$refs["patrolForm"].validate(function(t){if(t){var i=e._.cloneDeep(a);i.timeInterval*=60,i.lineId=i.line.map(function(t){return t.value}).join(","),i.line=null,i.weekly=i.weekly.join(","),e.sending=!0,n(i).then(function(t){e.$message.success(t.msg),e.sending=!1,e.fetchPatrolPlan(),e.$nextTick(function(){e.dialogPlanVisible=!1})},function(t){e.sending=!1,console.log(t)})}})}else{var o=this.temp_guard,l=o.id?mt:ft;this.$refs["guardForm"].validate(function(t){if(t){var i=e._.cloneDeep(o);i.actionInterval*=60,l(i).then(function(t){e.$message.success(t.msg),e.sending=!1,e.fetchGuardPlan(),e.$nextTick(function(){e.dialogPlanVisible=!1})},function(t){e.sending=!1,console.log(t)})}})}},fetchActionList:function(){var t=this,e=this.robotId;this.listQuery.deviceId=e,Ot(this.listQuery).then(function(e){t.list_actions=e.data.rows,t.total=e.data.total,t.listLoading=!1},function(e){console.log(e),t.listLoading=!1,t.emptyText="网络错误"})},handleActionPlus:function(){var t=this;this.dialogActionTitle="添加机器人动作组",this.actionId=null,this.$nextTick(function(){t.dialogActionVisible=!0})},handleActionEdit:function(t){var e=this,i=t.actionId;this.actionId=i,this.dialogActionTitle="修改机器人动作组",this.$nextTick(function(){e.dialogActionVisible=!0})},handleActionDelete:function(t){var e=this,i=t.actionId;this.$confirm("此操作将永久删除数据, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){Lt({actionId:i}).then(function(i){e.$message({type:"success",message:i.msg}),e.list_actions.splice(e.list_actions.indexOf(t),1)},function(t){console.log(t)})}).catch(function(){})},handleSelectionChange:function(t){this.deleteSelected=t},handleActionDelMore:function(){var t=this,e=this.deleteSelected,i="";i=e.length<1?"":e.map(function(t){return t.actionId}).join(","),this.$confirm("此操作将批量删除所选, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){$t({actionIds:i}).then(function(i){t.$message({type:"success",message:i.msg}),e.forEach(function(e){t.list_actions.splice(t.list_actions.indexOf(e),1)})},function(t){console.log(t)})}).catch(function(){})},handleActionIssue:function(){var t=this,e=this.robotId;this.$confirm("下发动作指令, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){t.synchronousAction=!0,Nt({deviceId:e}).then(function(e){t.synchronousAction=!1,t.$message({type:"success",message:e.msg})},function(e){t.synchronousAction=!1,console.log(e)})}).catch(function(){})},handleActionSubmit:function(t){this.fetchActionList(),this.$bus.$emit("GPatrolDetail:updateActionGroup",!0)},fetchPatrolData:function(){var t=this,e=this.robotId;this.patrolLoading=!0,zt({deviceId:e}).then(function(e){t.list_map=Object.assign({},e.data.map(function(e){e.component="GPatrol",e.originalBeaconPointInfo=t._.cloneDeep(e.beaconPointInfo),e.extra={searchGuard:!1,searchGuardKey:""};var i=e.patrolLineInfo;return Array.isArray(i)&&i.length>0&&i.forEach(function(t){try{delete t.robotConfigs}catch(e){t.robotConfigs=""}}),e})),t.$nextTick(function(){t.patrolLoading=!1})},function(e){t.patrolLoading=!1,console.log(e)})},handleSearchPlanBykey:function(t,e,i,a){var n=i.beaconPointInfo,o=i.originalBeaconPointInfo;if(a&&(i.extra.searchGuard=!i.extra.searchGuard),!e)return i.beaconPointInfo=o,!0;var l=n.filter(function(t){var i=t.code,a=t.name,n=new RegExp(e);return n.test(i)||n.test(a)});return i.beaconPointInfo=l,!0},handleSyncQRCode:function(){var t=this,e=this.list_map,i=this.robotId;e.some(function(t){return"QRCodeMap"===t.mapType})||(this.synchronousQR=!0,ut({deviceId:i}).then(function(e){t.synchronousQR=!1,t.$message.success(e.msg),t.fetchPatrolData()},function(e){t.synchronousQR=!1,console.log(e)}))},handleSyncMap:function(){var t=this,e=this.robotId,i=this.synchronousMap;i||(this.synchronousMap=!0,Vt({deviceId:e}).then(function(e){t.$message.success(e.msg),t.synchronousMap=!1,t.$$nextTick(function(){t.fetchPatrolData()})},function(e){t.synchronousMap=!1,console.log(e)}))},handleSyncGuardPoints:function(){var t=this,e=this.robotId,i=this.synchronousGuard;i||(this.synchronousGuard=!0,St({deviceId:e}).then(function(e){t.$message.success(e.msg),t.$nextTick(function(){t.synchronousGuard=!1,t.fetchPatrolData()})},function(e){t.synchronousGuard=!1,console.log(e)}))},handleOpenUploadDialog:function(t){var e=this,i=t.id;this.temp_upload.id=i,this.$nextTick(function(){e.dialogUploadVisible=!0})},handleUploadClose:function(){var t=this;this.$refs["upload"]&&this.$refs["upload"].clearFiles(),this.temp_upload.id=null,this.temp_upload.picFile=null,this.$nextTick(function(){t.dialogUploadVisible=!1})},handleFileRemove:function(){this.temp_upload.picFile=null},handleFileChange:function(t){"undefined"!==typeof t&&(this.temp_upload.picFile=t.raw)},handleMapUpload:function(){var t=this;Tt(this.temp_upload).then(function(e){t.$message.success(e.msg),t.handleUploadClose()},function(t){console.log(t)})},handleMapDelete:function(t){var e=this,i=t.id,a=t.mapName;this.$prompt("请输入删除地图的名称","提示",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:new RegExp(a),inputErrorMessage:"请输入正确的地图的名称"}).then(function(a){a.value;Pt({id:i}).then(function(i){e.$message.success(i.msg),e.list_map.splice(e.list_map.indexOf(t),1)},function(t){console.log(t)})},function(){})},handleBmapAdjustment:function(t){var e=this;this.lineInfo=t,this.$nextTick(function(){e.dialogBmapVisible=!0})},handleAerialAdjustment:function(t){var e=this;this.lineInfo=t,this.$nextTick(function(){e.dialogAerialVisible=!0})},handleWaypoint:function(t){this.mapName=t.mapName,this.dialogPatrolLinePoint=!0},issueQRCode:function(t){var e=this,i=this.id;dt({mapId:i}).then(function(t){e.$message.success(t.msg)},function(t){console.log(t)})},openMap:function(t){var e=this;this.lineInfo=t,this.$nextTick(function(){e.dialogMapVisible=!0})},handlePatrolDetail:function(t){var e=this;t&&0!==t.actionId&&t.actionId?(this.actionId=t.actionId,this.dialogActionTitle="修改机器人动作组",this.$nextTick(function(){e.dialogActionVisible=!0})):(this.dialogActionTitle="添加机器人动作组",this.actionId=null,this.$nextTick(function(){e.dialogActionVisible=!0}))}}},Dt=Et,Bt=(i("d08c"),i("1870"),Object(D["a"])(Dt,a,n,!1,null,"94ddb3d8",null));e["default"]=Bt.exports},"43f2":function(t,e,i){"use strict";var a=i("f77e"),n=i.n(a);n.a},"4b06":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"guard",staticStyle:{width:"100%",height:"100%"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":"",height:t.tableHeight}},[i("el-table-column",{attrs:{align:t.tableAlign,label:"值守点编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.code)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"值守点名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.name)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleDelete(e.row)}}})]}}])})],1),t._v(" "),i("el-dialog",{attrs:{"append-to-body":!0,top:"25vh",title:t.dialogTitle,visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"500px"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("el-form",{staticStyle:{width:"90%",margin:"0 auto"},attrs:{rules:t.rules,model:t.temp,size:t.formSize,"label-position":t.formAlign,"label-width":"120px"}},[i("el-form-item",{attrs:{label:"值守点编号",prop:"code"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.temp.code,callback:function(e){t.$set(t.temp,"code","string"===typeof e?e.trim():e)},expression:"temp.code"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"地图名称",prop:"mapName"}},[i("el-input",{attrs:{disabled:!0},model:{value:t.temp.mapName,callback:function(e){t.$set(t.temp,"mapName","string"===typeof e?e.trim():e)},expression:"temp.mapName"}})],1),t._v(" "),i("el-form-item",{attrs:{label:"值守点名称",prop:"name",rules:{required:!0,message:"值守点名称",trigger:"blur"}}},[i("el-input",{model:{value:t.temp.name,callback:function(e){t.$set(t.temp,"name","string"===typeof e?e.trim():e)},expression:"temp.name"}})],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleSave}},[t._v("保存")])],1)],1)],1)},n=[],o=(i("20d6"),i("c5f6"),i("0a1f")),l=o["patrol"].modifyBeaconPoint,s=o["patrol"].deleteBeaconPoint,r={name:"GGuard",props:{deviceId:{type:[Number,String],default:null},source:{type:Array,default:function(){return[]}}},data:function(){return{emptyText:null,tableHeight:"100%",list:this.source,formSize:"small",dialogTitle:"",needModal:!0,closeOnClickModel:!1,dialogVisible:!1,sending:!1,rules:{},temp:{}}},watch:{source:function(t,e){this.list=t}},created:function(){},mounted:function(){},activated:function(){},methods:{rowKey:function(t){return t.id},handleDelete:function(t){var e=this,i=t.id;this.$confirm("此操作将永久删除该配置, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s({id:i}).then(function(i){e.$message({type:"success",message:i.msg}),e.list.splice(e.list.indexOf(t),1)},function(t){console.log(t)})}).catch(function(){})},handleEdit:function(t){var e=this,i=this.deviceId;this.temp=Object.assign({},{deviceId:i},t),this.dialogTitle="编辑导航点",this.$nextTick(function(){e.dialogVisible=!0})},handleSave:function(){var t=this;this.sending=!0,l(this.temp).then(function(e){t.$message.success(e.msg),t.list.splice(t._.findIndex(t.list,{id:t.temp.id}),1,Object.assign({},t.temp)),t.$nextTick(function(){t.dialogVisible=!1,t.sending=!1})},function(e){t.sending=!1,console.log(e)})}}},c=r,d=(i("119a"),i("2877")),u=Object(d["a"])(c,a,n,!1,null,"e49b7db2",null);e["a"]=u.exports},"4d29":function(t,e,i){"use strict";var a=i("7bf6"),n=i.n(a);n.a},"4fc9":function(t,e,i){"use strict";var a=i("dcda"),n=i.n(a);n.a},"5c27":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFuUlEQVRoQ71aO3IbRxB9vYDB0HTmzHBul8ATkLyARYWORCZasmx89gSETrD42EVCCcETiC4fQKB9AIGJqxwJPIGpTAKBbdfMLsD9zOzMLkGhCqWAg5n3evrzukeEDXx8/6zufOXscoAGiBtg1EFUT2zNPANhBqYpOZgG98G1553MHns8ld1Agq7ScwYdAmiU3GdK4HGw4D/KkilMQACnCp2CJPDNfZjHvOTXRYlYE/D9i22nOm8z0N0c6uxOBHSDRa3veUd3NudYEfB/f9OgZfA249eKE5hxLX0d8hv/1EVsEGHXCIx5xhXnhffLq6lprZGAPzg7JHIudBsx8BHAlfh6TVf8a/z4w9EBAPkl4Gvt3hwcea2Tcd6GuQT6w/M2g3qqDSLgPSxqPdvrTu8j3BLVeQdAR0eEwJ1287ivI6El4A9GHSL4GvCXWNQ6ZYFriPQIeKk8j+F5LVdpSCUBndtEVj+0dRWjL6UWRK41Vt0Ga9wpQ0AGbMDv04dL8A7t2QRWUeDx9eJ8BDxRknBoJ31+goDwSap8fp/ONhL8olbflMuYCGpJiOy03NqJ40gSGI66BJzGD/hSls/EheYmGHjtNd11LVoTkBW26nxQuM6Lp/J5400MRyLNvs1gWgTfryr2A4HhSARPIgswcOk13c1KBhPqbGDn4pIEVNa38XsRM5XK/bNlBR+LBLcvXJXRBviOiby8G45qxSwd1BzdQkhAkfPTvqbK3VSdv1srUUav03I9k4H99E0z7ngZ7OSJOEk4HZtRbZAEesORSJtrSWxl/eF5j0DtBGDmcad1fKQjoQIi1jKCfa95MtH+LqzY6VuYdpruDmncx+j7GUuuTpeyeMtLp9zc4miRolXnCTci1cYMGDOPruBFPKa8qO2vSOQJQpuzpJsrMpKozuQrXKHTdI0qNdz0bA9wrjRCTJJA5dOBTs3q5IHKlWSRrc7/S9Yo7pM/GE3iGl3oea/l7pmCcfX3vNIP5n8Z9C1RVjIXAb8+S4GVeoPzD3HpUCb355MAkLrPMuDDbHl+RUTP18ZlnlFvOOKUdEiU6mI3EYwJ9CzzG3FCRKKMgdY3oEinGyMQFsSLbVQ+/U3k/KAiwcCfXsv9ydYomdrzZQjM/yLiHzN+Eyb8O0bgmdrEInVkYzcQZYmwMq+cUpPLSseA6gb84UhUuO/WdaiEgEuAt/SPMiTSxYyB20enUWV2iEgw+AaMf4joZxUvU8OeiQFVGn1MIYsqZEbuhu7ON1hs7YlqrJUdcmG+foqTyGZMWciycx+TuHpIawpBJ8Fn+2fDlMOYukXVJzgixmJlQEgJRSdmk6vLNP9aTcS467Tcb/LCR+UpUsyFbnA+TRQgqw0VFrGYXGjE463XdJPj+BSbrGLgG6953NA3NIaxXtgpfZ7EibNi7KGyanz+IzKJmMzldmUqN483NMqGXjHCyGQFWXnnhyBsA5gWaf6lAWr3dZtWNG19GfvxllKXTUxtpWXKf9QyZTsZq1UWY5X8du9R6Aw/Dsf6/C664YfsoxqrRLeQaZ5h4UpPQUJX3bWDLUkgbJ6ncWkRgUu0iE8BOL1netAQFkfcYlFraEeLkoRmuCuCNN7nPhWJPF2lynKFxutSDldo3yZzlCEYGU+8BmVePa3H62uZkPPAUfQhzoZMfzg6ZUYnHbChXCr4wGFDQgQ3OdRt/+pe2gDUren/NnrJAXd1D4h54MWexvGJ6ZFPuBXAVw6ccav16tqGzGDwZjcAH0B80y/6sQ1segYjgVVgI2Ax/1k3PnqgPAFjRkSJZ1ZmroNQB8g4spFS3HEObWLNikAsxYrXxMQDiI3Fi6wReb7Iy6c1gXVc+Gd1VB1R8JQvikXAxtcKCY9F0H2y/2qQBiYEICrOAYgPlbMgCyZhy0ljLIOrosBX2xe+ARWukAz2QNQAU0P4ejpeZBVlzEA8BfMUS0zKgo5j+B/RWKHg2O6e7wAAAABJRU5ErkJggg=="},"64a5":function(t,e,i){},"78e4":function(t,e,i){},"7ac5":function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"patrol",staticStyle:{width:"100%",height:"100%"}},[i("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list,"row-key":t.rowKey,fit:"","empty-text":t.emptyText,"highlight-current-row":"",height:t.tableHeight}},[i("el-table-column",{attrs:{align:t.tableAlign,label:"巡逻编号"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.lineNo)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"巡逻名称"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(t._s(t._f("defaultValue")(e.row.lineName)))]}}])}),t._v(" "),i("el-table-column",{attrs:{align:t.tableAlign,label:"操作"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("i",{staticClass:"gosuncn-icon el-icon-ext-edit card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleEdit(e.row)}}}),t._v(" "),i("i",{staticClass:"gosuncn-icon el-icon-ext-delete card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleDelete(e.row)}}}),t._v(" "),i("el-tooltip",{attrs:{effect:"light",content:"跳转“点位组路径”页面",placement:"top"}},[2===+e.row.lineType?i("i",{staticClass:"gosuncn-icon el-icon-ext-redirect card-table__icon",staticStyle:{cursor:"pointer"},on:{click:function(i){return t.handleDelete(e.row)}}}):t._e()])]}}])})],1)],1)},n=[],o=(i("c5f6"),i("0a1f")),l=o["patrol"].deletePatrolLine,s={name:"GPatrol",props:{linecode:{type:Number,default:null},source:{type:Array,default:function(){return[]}}},data:function(){return{emptyText:null,tableHeight:"100%",list:this.source,dialogBuildPatrolLineVisible:!1,lineNCode:0}},mounted:function(){},activated:function(){},methods:{rowKey:function(t){return t.id},handleDelete:function(t){var e=this,i=this.deviceId,a=t.id;this.$confirm("此操作将永久删除该配置, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var n={deviceId:i,lineId:a};l(n).then(function(i){e.$message({type:"success",message:i.msg}),e.list.splice(e.list.indexOf(t),1)},function(t){console.log(t)})}).catch(function(){})},handleSave:function(){var t=this;this.$nextTick(function(){t.dialogVisible=!1})},handleEdit:function(t){var e=this.deviceId;this.$emit("edit",t,e)}}},r=s,c=i("2877"),d=Object(c["a"])(r,a,n,!1,null,null,null);e["a"]=d.exports},"7bf6":function(t,e,i){},"83a1":function(t,e){t.exports=Object.is||function(t,e){return t===e?0!==t||1/t===1/e:t!=t&&e!=e}},8449:function(t,e,i){"use strict";i("386b")("anchor",function(t){return function(e){return t(this,"a","name",e)}})},"99d2":function(t,e,i){},a16d:function(t,e,i){"use strict";var a=i("3b7b"),n=i.n(a);n.a},a1f1:function(t,e,i){"use strict";var a=i("64a5"),n=i.n(a);n.a},a21e:function(t,e,i){},aa60:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{center:"","append-to-body":!0,top:"10vh",title:"百度地图标定",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"900px"},on:{"update:visible":function(e){t.dialogVisible=e},opened:t.opened,closed:t.closed}},[i("div",{staticClass:"adjustment"},[i("div",{ref:"bmap_wrap",staticClass:"bmap__wrap"},[i("baidu-map",{staticClass:"bmap-view",attrs:{"scroll-wheel-zoom":t.scrollWheelZoom,"double-click-zoom":t.doubleZlickZoom,center:t.CENTER,zoom:t.zoom,ak:t.APP_KEY},on:{ready:t.handleBMapReady}})],1),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.mapVisible,expression:"mapVisible"}],ref:"map_wrap",staticClass:"map__wrap"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],staticClass:"map",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[i("zr-component",{ref:"zr-components",attrs:{error:t.errorVisible},on:{resize:t.resize,loadComplete:t.loadComplete}})],1)]),t._v(" "),i("div",{staticClass:"sidebar",class:t.sidebarVisible?"sidebar--open":"sidebar--hidden"},[i("div",{staticClass:"sidebar-content"},[i("div",{staticClass:"tool"},[i("span",{staticClass:"tool__tag"},[t._v("搜索位置")]),t._v(" "),i("div",{staticClass:"tool__options"},[i("el-input",{ref:"bmapInput",attrs:{size:t.formSize,clearable:!0},model:{value:t.mapPosition,callback:function(e){t.mapPosition="string"===typeof e?e.trim():e},expression:"mapPosition"}},[i("template",{slot:"append"},[i("g-icon",{staticClass:"form-item__uploadTxt",attrs:{"icon-class":"search"},on:{click:t.handleSearchPlace}})],1)],2),t._v(" "),i("div",{staticStyle:{border:"1px solid #C0C0C0",width:"165px",height:"auto",display:"none"},attrs:{id:"searchResultPanel"}})],1)]),t._v(" "),i("div",{staticClass:"tool"},[i("span",{staticClass:"tool__tag"},[t._v("地图类型")]),t._v(" "),i("div",{staticClass:"tool__options"},[i("el-radio-group",{on:{change:t.handleMapTypeChange},model:{value:t.mapType,callback:function(e){t.mapType=e},expression:"mapType"}},[i("el-radio",{attrs:{label:"BMAP_NORMAL_MAP"}},[t._v("普通")]),t._v(" "),i("el-radio",{attrs:{label:"BMAP_SATELLITE_MAP"}},[t._v("卫星")]),t._v(" "),i("el-radio",{attrs:{label:"BMAP_HYBRID_MAP"}},[t._v("混合")])],1)],1)]),t._v(" "),i("div",{staticClass:"tool"},[i("span",{staticClass:"tool__tag"},[t._v("缩放比例")]),t._v(" "),i("div",{staticClass:"tool__options"},[i("el-input-number",{staticClass:"zoom-slider",attrs:{size:"small",step:1,min:1,max:8},on:{change:t.zoomControl},model:{value:t.sliderZoom,callback:function(e){t.sliderZoom=e},expression:"sliderZoom"}})],1)]),t._v(" "),i("div",{staticClass:"tool"},[i("div",{staticClass:"tool__options"},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"显示/隐藏激光地图",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"password"},on:{click:function(e){t.mapVisible=!t.mapVisible}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"Alt + 鼠标左键点击绿色原点即可删除",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"help-bg"}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"实时定位",placement:"top"}},[i("g-icon",{attrs:{"icon-class":"location"},on:{click:t.handleMapLocation}})],1)],1)])]),t._v(" "),i("a",{staticClass:"sidebar-tab",attrs:{href:"javascript:void(0)"},on:{click:function(e){return e.preventDefault(),t.handleSidebarClick(e)}}},[t._v("地图设置"),i("i",{staticClass:"sidebar-tab__icon",class:t.sidebarVisible?"el-icon-caret-left":"el-icon-caret-right"})])])]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleSubmit}},[t._v("保存")])],1)])},n=[],o=(i("386d"),i("ac6a"),i("96cf"),i("3b8d")),l=i("7618"),s=i("95c0"),r=i.n(s),c=i("ed08"),d=i("f3a3"),u=i("c7b2"),p=i("55ee"),h=i("9476"),m=i("bc19"),f=i("0a1f"),g=f["patrol"].modifyBmapCoordinate,v={name:"GBmapAdjustment",components:{BaiduMap:h["a"],ZrComponent:m["a"]},mixins:[u["a"]],props:{source:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1}},data:function(){return{emptyText:null,listLoading:!1,formSize:"mini",APP_KEY:"CdheGAoG7cgw72buOCzctrBoyuGtf7u7",CENTER:{lng:107.060695,lat:35.219636},zoom:19,scrollWheelZoom:!0,doubleZlickZoom:!0,bmap:null,geolocation:null,errorVisible:!1,mapLoading:!0,zrwidth:0,zrheight:0,zr:null,zposition:[0,0],zscale:[1,1],zrotation:0,zorigin:[0,0],group_back:null,group_overlay:null,globalAlpha:.65,mapInfo:{},temp_points:[],mapVisible:!0,sidebarVisible:!1,sidebarTimeout:null,mapType:"BMAP_NORMAL_MAP",mapPosition:"",autocomplete:null,sliderZoom:8,activeColor:"rgba(19, 206, 102, 0.4)",switchValue:{activeValue:1,inactiveValue:0},needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,sending:!1}},watch:{visible:function(t){this.dialogVisible=t}},created:function(){},mounted:function(){},methods:{opened:function(){var t=this.source,e=this.mapInfo;e.id&&e.id===t.id||(this.mapInfo=t,t.baiduMap.bmapView_coordinate&&"object"===Object(l["a"])(t.baiduMap.bmapView_coordinate)&&(this.CENTER=t.baiduMap.bmapView_coordinate,this.zoom=19),this.reset())},closed:function(){this.$emit("update:visible",!1)},handleBMapReady:function(t){var e=t.BMap,i=t.map;this.$BMap=e,this.bmap=i,this.isLoaded=!0;var a=new e.ScaleControl({anchor:BMAP_ANCHOR_BOTTOM_LEFT});i.addControl(a),this.geolocation=new e.Geolocation,this.initSearchControl()},loadComplete:function(t){this.zr=t},resize:function(){this.zr&&this.reset()},reset:function(){this.zr&&this.zr.clear(),this.zr.off(),this.mapLoading=!1,this.errorVisible=!1,this.temp_points=[],this.init(),this.$emit("mapTransform",this.group_back,{enableRotation:!0}),this.draw().catch(this.drawErrorCallback)},init:function(){var t=this.mapInfo,e=this.$refs["zr-components"].$el;if(this.zrwidth=t.picWidth,this.zrheight=t.picHeight,this.zrwidth&&this.zrheight){var i=Object(d["c"])(e,this.zrwidth,this.zrheight),a=i.left,n=i.top,o=Object(d["b"])(e,this.zrwidth,this.zrheight);this.zorigin=[this.zrwidth/2,this.zrheight/2],this.zscale=[o,o],this.zposition=[a,n],this.zrotation=0;var l=t.baiduMap,s=l.gmap_x1,c=l.gmap_x2,u=l.gmap_y1,p=l.gmap_y2,h=l.rotation,m=l.scale,f=l.translation;m&&(this.zscale=[m,m]),f&&(this.zposition=[f.x,f.y]),h&&(this.zrotation=h),s&&u&&this.temp_points.push({x:s,y:u}),c&&p&&this.temp_points.push({x:c,y:p}),this.group_back=new r.a.Group,this.group_overlay=new r.a.Group,this.group_overlay.silent=!1,this.zr.add(this.group_back),this.zr.add(this.group_overlay),this.zr.refreshImmediately(),this.listeners()}else console.log("缺失图片参数的，一概不处理")},update:function(){this.errorVisible=!1,this.group_overlay&&this.group_overlay.removeAll(),this.draw().catch(this.drawErrorCallback)},draw:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,l,s,r,d,u,h,m,f,g;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.zrwidth,i=this.zrheight,a=this.group_back,n=this.group_overlay,o=this.zposition,l=this.zscale,s=this.zrotation,r=this.globalAlpha,d=this.mapInfo,a||n){t.next=3;break}return t.abrupt("return");case 3:if(a.position=o.slice(0),a.scale=l.slice(0),a.rotation=s,u=this,!(a.childCount()<1)){t.next=15;break}return this.mapLoading=!1,h=d.mapPicUrl,t.next=12,Object(c["j"])(h);case 12:m=t.sent,f=Object(p["c"])(m,e,i,r),f&&a.add(f);case 15:g=this.temp_points,Array.isArray(g)&&g.length>0&&g.forEach(function(t,a,r){var c="#2DAB61",d={style:{strokeNoScale:!0,fill:c,lineWidth:2,stroke:c},shape:{cx:parseFloat(t.x),cy:parseFloat(t.y),r:5},onmousedown:function(t){var e=t.event||t;if(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!e.altKey)return!1;r.splice(a,1),u.update()}},h=Object(p["b"])(d,e,i,o,l,s);h&&n.add(h)}),this.group_back.dirty(),this.group_overlay.dirty(),this.mapLoading=!1;case 20:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),drawErrorCallback:function(t){console.log(t),this.errorVisible=!0,this.mapLoading=!1},listeners:function(){var t=this,e=this.group_back;e&&e.on("click",function(e){var i=e.event||e;if(i.altKey)return!0;console.log(123);var a=t.zrwidth,n=t.zrheight,o=t.zposition,l=t.zscale,s=t.zrotation,r=i.offsetX,c=i.offsetY,u=Object(d["e"])([r,c],a,n,o,l,s);t.temp_points.length<2&&t.temp_points.push({x:u[0],y:u[1]}),t.update()})},handleSidebarClick:function(){var t=this.sidebarVisible,e=this.isError,i=this.sidebarTimeout;this.sidebarVisible=!e&&!t,i&&clearTimeout(i),this.sidebarTimeout=null},handleMouseEnter:function(t){},handleMouseLeave:function(t){},handleMapTypeChange:function(t){if(!this.bmap)return console.log("BMap对象不存在"),!1;switch(t){case"BMAP_SATELLITE_MAP":this.bmap.setMapType(BMAP_SATELLITE_MAP);break;case"BMAP_HYBRID_MAP":this.bmap.setMapType(BMAP_HYBRID_MAP);break;default:this.bmap.setMapType(BMAP_NORMAL_MAP)}},handleMapLocation:function(){var t=this.geolocation,e=this;if(!t)return console.log("定位对象不存在"),!1;t.getCurrentPosition(function(t){this.getStatus()===BMAP_STATUS_SUCCESS?(console.log(t.accuracy),console.log(this.getStatus()),console.log("您的位置："+t.point.lng+","+t.point.lat),e.bmap.setZoom(19),e.bmap.panTo(t.point)):console.log("failed"+this.getStatus())},{enableHighAccuracy:!0})},handleSearchPlace:function(t){var e=this.autocomplete;e&&e.show()},initSearchControl:function(){var t=this.$BMap,e=this.bmap;if(e){var i=this.$refs["bmapInput"].$el.querySelector("input"),a=new t.Autocomplete({input:i,location:e});this.autocomplete=a,a.addEventListener("onhighlight",function(t){var e="",i=t.fromitem.value,a="";t.fromitem.index>-1&&(a=i.province+i.city+i.district+i.street+i.business),e="FromItem<br />index = "+t.fromitem.index+"<br />value = "+a,a="",t.toitem.index>-1&&(i=t.toitem.value,a=i.province+i.city+i.district+i.street+i.business),e+="<br />ToItem<br />index = "+t.toitem.index+"<br />value = "+a,l("searchResultPanel").innerHTML=e});var n=null;a.addEventListener("onconfirm",function(t){console.log(t);var e=t.item.value;n=e.province+e.city+e.district+e.street+e.business,l("searchResultPanel").innerHTML="onconfirm<br />index = "+t.item.index+"<br />myValue = "+n,o()})}else console.log("无法初始化自动化搜索组件");function o(){if(null!=n){var i=new t.LocalSearch(e,{onSearchComplete:a});i.search(n)}function a(){try{var t=i.getResults().getPoi(0).point;e.centerAndZoom(t,19)}catch(a){console.log(a.message)}}}function l(t){return document.getElementById(t)}},pixelToPoint:function(t){var e=this.$BMap,i=this.bmap;if(!Array.isArray(t))return"";var a=new e.Pixel(t[0],t[1]);return i.pixelToPoint(a)},handleSubmit:function(){var t=this,e=this.mapInfo,i=this.temp_points,a=this.bmap,n=this.zrotation,o=this.zscale,l=this.zposition,s=this.zrwidth,r=this.zrheight,c=e.id,u=i.map(function(e){return t.pixelToPoint(Object(d["d"])([e.x,e.y],s,r,l,o,n))}),p=a?a.getCenter():"";this.sending=!0,g({id:c,gmapX1:i[0]?i[0].x:"",gmapY1:i[0]?i[0].y:"",gmapX2:i[1]?i[1].x:"",gmapY2:i[1]?i[1].y:"",bmapX1:u[0]?u[0].lng:"",bmapY1:u[0]?u[0].lat:"",bmapX2:u[1]?u[1].lng:"",bmapY2:u[1]?u[1].lat:"",rotation:n,scale:o[0],translation:JSON.stringify({x:l[0],y:l[1]}),bmapViewCoordinate:JSON.stringify(p)}).then(function(e){t.$message.success(e.msg),t.sending=!1},function(e){t.sending=!1,console.log(e)})},zoomControl:function(t){var e=.05*t;this.$emit("mapConfig",{zoomRatio:e})}}},b=v,_=(i("0c0e"),i("a1f1"),i("2877")),y=Object(_["a"])(b,a,n,!1,null,"625e535a",null);e["a"]=y.exports},b18c:function(t,e,i){},b50b:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAFL0lEQVRoQ71aS3biRhS9DyM1zqSdQc4BJiGDJDCKvQLbK2h6BaZXYHoFxiuIvYLgFTReQewVNB6ZTgZNTzDnZBAzwVjCen1KAqxPlaoEsjVVqereqlvv3XolQg5Pmes1uNgn0C7Au2DUiKgW7pqZhyAMAeozuA8L12MaDDcdntbtQIAml98RCi0Au2v202d4Xbbocl0ymQkI4AUXJwAJ4Dk+3PUsnGYlYkxgh2s7P8xLx2Dq5Ig62RVxZ1qcnd/T8N5kHCMCPzm/7hZ561Nc17IBGHxNwBAs9B56CDUGagTa1wET+2VOT+//s//t69pqCZSdeqsA+kvdEU8A9FDweqPiPz3dgOJ9df5bE16hCaAJ0FvVNx74w9gedNP6TCVQcX4/JhTO5B3wBIyzqT07M13ueD++LJ1SG4S2igjDa9/ZX85VJJQEKk6jTcCfCvAXU2vWXhe4lIhbOgPoSC5LfLyzb6UTKSWglg1PUPBaplIxkVO4zUJaXdlqqOSUICA2rIXi5+TgPHHxdGCysbICD7cPxt+6kpFwMd+Ljx8hIDS57ZQ+J6MNT6bWrJaXZHQEVSREdHqwZ3thHBEC1cd6B0Qn0QFeZ+bjpJQrwXw6ejNY5aIVgSDD0tfE7BSe3r+U5nUrEeyJrU/xdp7Fvywz9opA1amLzROLAnwxsgc5WwYd7Oh7HS6fgHz2X0/3Qi5btPV2VpzdxPeZnyvcknCxkYS3XAWfgDTmx7SWbd7MW4dDttikbOMwbuhke5MR5AafQNVpiLAZssSvM/vyfJOUrWIV+iP7do8U8nlx7auSJTMu797cCp8UeWR7QciIpB29cOQpu/WDAtPfMqF5xIdja3CVICCJSCI7U8VpCB0dhz8Y2bdal2qu8mjLRaYX4HcS4THFfQYy2v4//A0D51Rx6ldhjy78/J09OFAB9CU3xxGI+6Pil8ssRNLALzdlWn8yrFR5rH+NWgd17E8C4O7IHnwwIaG2KeJrs3xTeWz0iPBuOZ6IWlR1GhwBkBI+4x0E3+lJLJZfyEZy+DcD70dLidXJgUA6ibzA50IgzeqqVkK+aj7pm5E9yFSO2XgFxLBZSMh9TAB+as0OstpzKYHKY2NIhJ+f94FekyYk8gYfOIao4WTGt8xhdEk0nQREOUS2YTc6GMnD6AaJTEMiFl03PxjFI6afyGRWQpXOZfHejMTm4GX2w7cSeZg5HQnZYdwk+YXbyCyPb+YWm6MP0B+hD+5H9u2PWQZRkTCprpmMI3EMfhhWHmjWGThKgice0NaVBk3Ay2QeOdDIZCQrYZgMJtoIvc6Ks37WOK/qPzn7QORIKYuxgc2JljBMCeTZTlHqWR24tGWVLBEpT+DPWb+YODtIyyoqs7SJlDYhpDSBqsKWGCzw7Nv9qLXwYfSn1sNhXpo2IZYsNAhF49uD/bCrLC2Glk1S3H0dEmn2W1vcXc5Myq3MvYv54UtVqBcnPnEblPBRxuX1JYnUC46MF3FGknHrJ2Bqyw77aedlzRWT+pbGr6IROmN7cGECUNWm7NSPiNFRXSDqDvva8on+kg/3APc8QndsDa5NyJTd+j4xNcHcTLv5NHEDWgLLjV3koqgIhA4+cqgMvvKvWf3fCkIPr65ZlSWb59Z84+KpZbLXjAgsQ2xwoxi/ADGZ8wxtmE+z3HwaE1hFqOBXg47qRjED1FhTvvAsdF7sV4M4sOBnD2oSuBWz4hk48A2DumxxLyvw5SCZV0CGbvG7zcHz7zZUi+8XkUVBHP7d5mpd0GEM3wH9nGECk1oeJAAAAABJRU5ErkJggg=="},c9df:function(t,e,i){},d08c:function(t,e,i){"use strict";var a=i("2fc0"),n=i.n(a);n.a},dcda:function(t,e,i){},edc0:function(t,e,i){"use strict";i.d(e,"a",function(){return o}),i.d(e,"b",function(){return l});var a=i("768b");function n(){throw new Error("Missing parameter")}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,e=Object(a["a"])(t,2),i=e[0],o=e[1],l=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n,s=Object(a["a"])(l,2),r=s[0],c=s[1],d=r-i,u=c-o;return 0===d?Math.P2/2:0===u?0:Math.atan(u/d)}function l(t,e,i){var n=Object(a["a"])(t,2),o=n[0],l=n[1],s=Object(a["a"])(e,2),r=s[0],c=s[1],d=(o+r)/2,u=(l+c)/2,p=Math.sqrt(Math.pow(r-o,2)+Math.pow(c-l,2)),h=p/2;if(h>Math.abs(i))return console.log("半径数据有误",[o,l],[r,c],i),!1;var m=Math.sqrt(Math.pow(i,2)-Math.pow(h,2));if(0===m)return[d,u];var f=i<0?l-c:c-l,g=i<0?r-o:o-r;return[f/p*m+d,g/p*m+u]}},f6a3:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],staticClass:"app-container__dialog",attrs:{center:"","append-to-body":!0,top:"8vh",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"1080px"},on:{"update:visible":function(e){t.dialogVisible=e},closed:t.handleCloseDialog,opened:t.open}},[i("div",{staticClass:"custom-dialog-title",attrs:{slot:"title"},slot:"title"},[t._v("\n    "+t._s(t.title)+"\n    "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"动作持续时间指的是：当前动作开始执行到下一动作开始执行的时间",placement:"bottom"}},[i("g-icon",{attrs:{"icon-class":"help"}})],1)],1),t._v(" "),i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],ref:"formWrapper",staticClass:"actionGroup",attrs:{"element-loading-text":"正在获取最新数据"}},[i("el-form",{ref:"dataForm",staticStyle:{width:"95%",margin:"0 auto"},attrs:{rules:t.rules,model:t.temp,size:"mini","label-position":"right","label-width":"160px"}},[t.temp.actionCode?i("el-form-item",{attrs:{label:"动作组编号",prop:"actionCode",rules:{required:!0,message:"动作组编号不能为空",trigger:"blur"}}},[i("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:""},model:{value:t.temp.actionCode,callback:function(e){t.$set(t.temp,"actionCode","string"===typeof e?e.trim():e)},expression:"temp.actionCode"}})],1):t._e(),t._v(" "),i("el-form-item",{attrs:{label:"动作组名称",prop:"actionName",rules:{required:!0,message:"动作组名称不能为空",trigger:"blur"}}},[i("el-input",{staticStyle:{width:"240px"},attrs:{placeholder:""},model:{value:t.temp.actionName,callback:function(e){t.$set(t.temp,"actionName","string"===typeof e?e.trim():e)},expression:"temp.actionName"}})],1),t._v(" "),i("draggable",{attrs:{animation:200,group:"description",disabled:!1,"ghost-class":"ghost",handle:".form-item__move"},model:{value:t.temp.configs,callback:function(e){t.$set(t.temp,"configs",e)},expression:"temp.configs"}},[i("transition-group",{staticStyle:{position:"relative"},attrs:{name:"flip-change",tag:"div"}},t._l(t.temp.configs,function(e,a){return i("div",{key:e.unitId||e.animationId,staticClass:"form-group"},[i("el-select",{staticClass:"form-item--prefix",attrs:{size:t.formSize},on:{change:function(i){return t.handleActionTypeChange(i,e,a)}},model:{value:e.actionType,callback:function(i){t.$set(e,"actionType",i)},expression:"item.actionType"}},t._l(t.computedActionType,function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})}),1),t._v(" "),i("el-form-item",{ref:"formItem"+a,refInFor:!0,attrs:{prop:"configs."+a+".field.actionWait",rules:{validator:t.validator,trigger:"blur"}}},["1"===e.actionType||"12"===e.actionType||"13"===e.actionType||"15"===e.actionType||"20"===e.actionType||"21"===e.actionType||"22"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"2"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"选择预置点"},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},t._l(t.prePositions,function(t){return i("el-option",{key:t.presetCode,attrs:{label:t.presetName,value:t.presetCode}})}),1)]:"3"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"文件类型（.wav）",disabled:!0},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}},[i("template",{slot:"append"},[i("span",{staticClass:"form-item__uploadTxt",on:{click:t.handleUploadFile}},[t._v("上传文件")]),t._v(" "),i("input",{staticClass:"form-item__upload",attrs:{type:"file",accept:".wav",name:"file"},on:{change:function(i){return t.handleFileChange(i,e)}}})])],2)]:"6"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"7"===e.actionType?[i("div",{staticClass:"form-box"},[i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{type:"number",placeholder:"最低温度"},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",t._n(i))},expression:"item.field.minValue"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{type:"number",placeholder:"最高温度"},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",t._n(i))},expression:"item.field.maxValue"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{placeholder:"动作单元名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}}),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"140px"},attrs:{placeholder:"例:x1,y1,x2,y2"},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})],1)]:"8"===e.actionType?[i("div",{staticClass:"form-item",staticStyle:{display:"inline-block"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"textarea",maxlength:"1000","show-word-limit":"",rows:3,placeholder:"室内款最多500字，室外1000字"},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.soundText.length/3)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}})],1)]:"9"===e.actionType?[i("div",{staticClass:"form-item g-search-group g-search-group--append",staticStyle:{width:"240px"}},[i("el-input-number",{staticClass:"form-item g-search-group__inner",attrs:{"controls-position":"right",step:20,min:0,max:600},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.actionValue>0?35*e.field.actionValue/600:1)}},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}}),t._v(" "),i("div",{staticClass:"g-search-group__append"},[t._v("毫米")])],1)]:"10"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{type:"number"},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",t._n(i))},expression:"item.field.actionValue"}},[i("template",{slot:"append"},[t._v("度")])],2)]:"11"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择旋转方向"},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",i)},expression:"item.field.minValue"}},[i("el-option",{attrs:{label:"左转",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"右转",value:"2"}})],1),t._v(" "),i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("转速")]),t._v(" "),i("el-input-number",{staticClass:"form-item g-search-group__inner",attrs:{placeholder:"0-100","controls-position":"right",min:0,max:100},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",i)},expression:"item.field.maxValue"}})],1)]:"17"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择房间",clearable:""},on:{change:function(i){return t.handleRoomChange(i,e)}},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},t._l(t.roomInfo,function(t){return i("el-option",{key:t.prisonHouseId,attrs:{label:"房间"+t.prisonHouseId,value:t.prisonHouseId}})}),1),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"人员名单"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"18"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"格式：货架-货架列号"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:"23"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"遗留物信息，以逗号隔开"},on:{blur:function(i){return t.filterDot(i,e)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})]:"24"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},[i("el-option",{attrs:{label:"开",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"关",value:"0"}})],1),t._v(" "),i("el-input",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"门的编号"},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText","string"===typeof i?i.trim():i)},expression:"item.field.soundText"}})]:"25"===e.actionType?[i("el-select",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"请选择模块",clearable:""},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}},t._l(t.tblockIps,function(t){return i("el-option",{key:t.id,attrs:{label:t.moduleName,value:t.moduleIp}})}),1)]:"26"===e.actionType?[i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("速度")]),t._v(" "),i("el-input-number",{staticClass:"form-item",attrs:{"controls-position":"right",precision:2,step:.1,min:.1,max:.6},model:{value:e.field.minValue,callback:function(i){t.$set(e.field,"minValue",i)},expression:"item.field.minValue"}})],1),t._v(" "),i("div",{staticClass:"form-item g-search-group g-search-group--prepend",staticStyle:{width:"200px"}},[i("div",{staticClass:"g-search-group__prepend"},[t._v("角度")]),t._v(" "),i("el-input-number",{staticClass:"form-item",attrs:{"controls-position":"right",step:20,min:-360,max:360},model:{value:e.field.maxValue,callback:function(i){t.$set(e.field,"maxValue",i)},expression:"item.field.maxValue"}})],1)]:"27"===e.actionType?[i("div",{staticClass:"form-item",staticStyle:{display:"inline-block"}},[i("el-input",{staticStyle:{width:"240px"},attrs:{type:"textarea",maxlength:"1000","show-word-limit":"",rows:3,placeholder:"室内款最多500字，室外1000字"},on:{blur:function(t){e.field.actionWait=Math.ceil(e.field.soundText.length/3)}},model:{value:e.field.soundText,callback:function(i){t.$set(e.field,"soundText",i)},expression:"item.field.soundText"}})],1),t._v(" "),i("el-select",{staticClass:"form-item",staticStyle:{width:"200px"},attrs:{placeholder:"状态",clearable:""},model:{value:e.field.actionValue,callback:function(i){t.$set(e.field,"actionValue",i)},expression:"item.field.actionValue"}},[i("el-option",{attrs:{label:"开",value:"1"}}),t._v(" "),i("el-option",{attrs:{label:"关",value:"0"}})],1)]:"28"===e.actionType?void 0:"29"===e.actionType?[i("el-input",{staticClass:"form-item",staticStyle:{width:"240px"},attrs:{placeholder:"图片名称"},model:{value:e.field.actionUnitName,callback:function(i){t.$set(e.field,"actionUnitName","string"===typeof i?i.trim():i)},expression:"item.field.actionUnitName"}})]:[t._v("暂无内容")],t._v(" "),i("div",{staticClass:"form-item--suffix"},[i("el-input",{directives:[{name:"show",rawName:"v-show",value:"23"!==e.actionType,expression:"item.actionType !== '23'"}],staticStyle:{width:"240px"},attrs:{type:"number"},model:{value:e.field.actionWait,callback:function(i){t.$set(e.field,"actionWait",t._n(i))},expression:"item.field.actionWait"}},[i("template",{slot:"prepend"},[t._v("动作持续时间")]),t._v(" "),i("template",{slot:"append"},[t._v("秒")])],2),t._v(" "),i("g-icon",{staticClass:"form-item__icon form-item__icon--bg",attrs:{"icon-class":"minus"},on:{click:function(i){return t.handleAction(e)}}}),t._v(" "),i("g-icon",{staticClass:"form-item__icon form-item__move",attrs:{"icon-class":"move"}})],1)],2)],1)}),0)],1)],1)],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleActionPlus}},[t._v("新增动作")]),t._v(" "),i("el-button",{on:{click:t.handleSyncPosition}},[t._v("刷新预置位")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleConfirm}},[t._v("提交")])],1)])},n=[],o=(i("28a5"),i("a481"),i("c5f6"),i("310e")),l=i.n(o),s=i("ed08"),r=[{label:"抓拍",value:"1"},{label:"预置点",value:"2"},{label:"播报音频",value:"3"},{label:"仪表识别",value:"6"},{label:"温度检测",value:"7"},{label:"播报文字",value:"8"},{label:"伸缩杆控制",value:"9"},{label:"角度转向",value:"10"},{label:"环视一周",value:"11"},{label:"车辆检测",value:"12"},{label:"进出粮监管",value:"13"},{label:"墙体脱落检测",value:"15"},{label:"点名",value:"17"},{label:"二维码抓拍",value:"18"},{label:"无人告警",value:"20"},{label:"物品清点",value:"21"},{label:"车辆违停检测",value:"22"},{label:"遗留物检测",value:"23"},{label:"开关门",value:"24"},{label:"LoRa SNMP采集",value:"25"},{label:"本体转向角度",value:"26"},{label:"巡逻全程播报",value:"27"},{label:"充电",value:"28"},{label:"资产盘点",value:"29"}],c={name:"GActionGroup",inject:["api"],components:{draggable:l.a},props:{deviceId:{type:[Number,String],default:null},actionId:{type:[Number,String],default:null},title:{type:String,default:""},visible:{type:Boolean,default:!1}},data:function(){return{emptyText:null,textAlign:"left",tableHeight:320,total:null,listLoading:!1,formSize:"mini",needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,sending:!1,temp:{deviceId:null,actionId:null,actionCode:null,actionName:null,units:null,configs:[]},robotInfo:null,prePositions:[],roomInfo:[],personInfo:[],tblockIps:[],rules:{}}},computed:{dragOptions:function(){return{animation:0,disabled:!1,ghostClass:"ghost"}},computedActionType:function(){if(!this.robotInfo||"string"!==typeof this.robotInfo)return[];var t=JSON.parse(this.robotInfo),e=[];return 0===t.fumigate&&(e=e.concat(["12","13"])),0===t.lift&&e.push("9"),0===t.instrument&&e.push("6"),0===t.infrared&&e.push("7"),0===t.wall&&e.push("15"),0===t.callName&&e.push("17"),0===t.i4Capture&&e.push("18"),r.filter(function(t){return e.indexOf(t.value)<0})}},watch:{deviceId:function(t,e){this.fetchRobotInfo()},visible:function(t){this.dialogVisible=t}},created:function(){},mounted:function(){this.fetchRobotInfo()},methods:{open:function(){this.fetchPrePositions(),this.fetchPersonInfo(),this.handleTblockIps(),this.fetchDate()},fetchRobotInfo:function(){var t=this,e=this.deviceId,i=this.api.device.searchRobotByDeviceId;e&&!this.robotInfo&&i({deviceId:e}).then(function(e){t.robotInfo=e.data.params},function(t){console.log(t)})},fetchPrePositions:function(){var t=this,e=this.deviceId,i=this.api.patrol.selectPrePositions;i({deviceId:e}).then(function(e){t.prePositions=e.data},function(t){console.log(t)})},fetchPersonInfo:function(){var t=this,e=this.api.patrol.findPersonInfoGroupByHouseId;0===this.roomInfo.length&&e().then(function(e){t.roomInfo=e.data},function(t){console.log(t)})},handleTblockIps:function(){var t=this,e=this.api.patrol.findTblockIps;0===this.tblockIps.length&&e().then(function(e){t.tblockIps=e.data},function(t){console.log(t)})},fetchDate:function(){var t=this,e=this.actionId,i=this.api.patrol.findRobotActionById;e&&(this.listLoading=!0,i({actionId:e}).then(function(e){var i=e.data,a=i.actionCode,n=i.actionId,o=i.actionName,l=i.deviceId,s=i.units,r=s.map(function(t){var e=t.unitId,i=t.actionType;return t.actionWait/=1e3,Object.assign({},{unitId:e,actionType:""+i,field:t})});t.temp=Object.assign({},t.temp,{actionId:n,actionCode:a,actionName:o,deviceId:l,configs:r}),t.$nextTick(function(){t.listLoading=!1})},function(e){console.log(e),t.listLoading=!1}))},handleCloseDialog:function(){this.temp=Object.assign({},this.temp,{deviceId:null,actionId:null,actionCode:null,actionName:null,units:null,configs:[]});var t=this.$refs["dataForm"].$el.querySelector('input[type="file"]');t&&(t.value=""),this.$refs["dataForm"]&&this.$refs["dataForm"].clearValidate(),this.$emit("update:visible",!1)},handleSyncPosition:function(){var t=this,e=this.deviceId,i=this.api.patrol.syncPrePosition;this.listLoading=!0,i({deviceId:e}).then(function(e){t.$message.success(e.msg),t.listLoading=!1,t.$nextTick(function(){t.fetchPrePositions()})},function(e){console.log(e),t.listLoading=!1})},handleActionPlus:function(){this.temp.configs.push({animationId:Math.floor(1e4*Math.random()),actionId:"",unitId:"",actionType:"1",field:{actionValue:"1",actionUnitName:"",actionWait:1}});var t=this.$refs["formWrapper"],e=this.$refs["dataForm"].$el;e.scrollHeight>t.clientHeight&&this.$nextTick(function(){t.scrollTop=e.scrollHeight-t.clientHeight+5})},handleActionTypeChange:function(t,e,i){switch(t){case"2":e.field={actionValue:"",actionWait:"1"};break;case"3":e.field={soundText:"",actionWait:1};break;case"6":e.field={actionUnitName:"",soundText:0,actionWait:1};break;case"7":e.field={minValue:"",maxValue:"",actionUnitName:"",soundText:"",actionWait:1};break;case"8":e.field={soundText:"",actionWait:1};break;case"9":e.field={actionValue:"",actionWait:1};break;case"10":e.field={actionValue:"",actionWait:1};break;case"11":e.field={minValue:"",maxValue:0,actionWait:1};break;case"17":e.field={actionValue:"",actionUnitName:"",actionWait:1};break;case"23":e.field={soundText:"",actionWait:1};break;case"24":e.field={soundText:"",actionValue:"1",actionWait:1};break;case"25":e.field={soundText:"",actionWait:1};break;case"26":e.field={minValue:"",maxValue:"",actionWait:1};break;case"27":e.field={soundText:"",actionValue:"1",actionWait:1};break;case"28":e.field={actionWait:1};break;default:e.field={actionValue:"1",actionUnitName:"",actionWait:1}}var a="formItem"+i;this.$refs[a].length>0&&this.$refs[a][0].clearValidate()},handleUploadFile:function(t){var e=t.target;e.className.indexOf("form-item__uploadTxt")>-1&&e.nextElementSibling&&e.nextElementSibling.click()},handleFileChange:function(t,e){var i=this,a=t.target.files,n=this.api.patrol.uploadSoundFile;Object(s["k"])([].slice.call(a)[0],".wav")?this.$confirm("确定上传该文件吗","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){n({soundFile:a[0]}).then(function(t){i.$message.success(t.msg),e.field.soundText=t.data.soundFileUrl},function(e){t.target.value="",console.log(e)})}).catch(function(){t.target.value=""}):this.$message.error("所选文件类型不符合")},handleRoomChange:function(t,e){var i=this,a=this.api.patrol.getPersonInfo;t&&(this.personInfo.length<1||this.personInfo[0].prisonHouseId!==t?a({prisonHouseId:t}).then(function(t){i.personInfo=t.data,e.field.actionUnitName=Array.isArray(t.data)?t.data.map(function(t){return t.personName}).join(","):""},function(t){console.log(t)}):e.field.actionUnitName=this.personInfo.map(function(t){return t.personName}).join(","))},filterDot:function(t,e){var i=t.target.value;e.field.soundText=i.replace(/，+/g,",")},handleAction:function(t){var e=this;console.log(t);var i=t.unitId;if(i){var a=this.api.patrol.deleteActionUnit;a({unitId:i}).then(function(i){e.$message.success(i.msg),e.temp.configs.splice(e.temp.configs.indexOf(t),1)},function(t){console.log(t)})}else this.temp.configs.splice(this.temp.configs.indexOf(t),1)},handleConfirm:function(){var t=this,e=0,i=this._.cloneDeep(this.temp);i.deviceId=this.deviceId,i.actionId=this.actionId,i.units=i.configs.map(function(t){return"6"===t.actionType&&(t.field.soundText=e++),t.field.actionWait*=1e3,JSON.stringify(Object.assign({},t.field,{actionType:t.actionType,unitId:t.unitId}))}).join("@");try{delete i.configs}catch(n){i.configs=""}var a=i.actionId;this.$refs["dataForm"].validate(function(e){if(e){var n=a?t.api.patrol.modifyAction:t.api.patrol.addAction;t.sending=!0,n(i).then(function(e){t.$message.success(e.msg),t.$emit("submit",e.data),t.$nextTick(function(){t.sending=!1,t.dialogVisible=!1})},function(e){t.sending=!1,console.log(e)})}})},validator:function(t,e,i){var a=this.temp,n=t.field,o=n.split(".")[1],l=a["configs"][o],s=l.actionType;"2"!==s||l.field.actionValue?"3"!==s||l.field.soundText?"7"!==s||l.field.minValue&&l.field.maxValue?"7"===s&&l.field.minValue&&l.field.maxValue&&+l.field.minValue>+l.field.maxValue?i(new Error("最低温度不能高于最高温度")):"8"!==s||l.field.soundText?"9"!==s||l.field.actionValue||0===l.field.actionValue?"10"!==s||l.field.actionValue?"11"!==s||l.field.minValue?"11"!==s||l.field.maxValue?"25"!==s||l.field.soundText?e?i():i(new Error("动作单位间隔不能为空")):i(new Error("rola模块Ip不能为空")):i(new Error("云台转向的速度不能为空")):i(new Error("云台转向的方向不能为空")):i(new Error("转向的角度不能为空")):i(new Error("伸缩杆高度不能为空")):i(new Error("语音内容不能为空")):i(new Error("温度不能为空")):i(new Error("播报音频不能为空")):i(new Error("预置点不能为空"))}}},d=c,u=(i("4fc9"),i("2877")),p=Object(u["a"])(d,a,n,!1,null,"2315a263",null);e["a"]=p.exports},f72c:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("el-dialog",{directives:[{name:"el-drag-dialog",rawName:"v-el-drag-dialog"}],attrs:{center:"","append-to-body":!0,top:"10vh",title:"航拍地图标定",visible:t.dialogVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"900px"},on:{"update:visible":function(e){t.dialogVisible=e},opened:t.opened,closed:t.closed}},[i("div",{staticClass:"adjustment"},[i("div",{staticClass:"map__wrap"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],staticClass:"map",attrs:{"element-loading-text":"拼命加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[i("zr-component",{ref:"zr-components",attrs:{error:t.errorVisible},on:{resize:t.resize,loadComplete:t.loadComplete}})],1)]),t._v(" "),i("laser",{ref:"laser",staticClass:"top",attrs:{source:t.mapInfo,visible:t.mapVisible},on:{coords:t.handleModifyCoords}}),t._v(" "),i("div",{staticClass:"sidebar sidebar--open"},[i("a",{staticClass:"sidebar-tab",attrs:{href:"javascript:void(0)"}},[i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"显示/隐藏激光地图",placement:"right"}},[i("g-icon",{attrs:{"icon-class":"password"},on:{click:function(e){t.mapVisible=!t.mapVisible}}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"Alt + 鼠标左键点击绿色原点即可删除",placement:"right"}},[i("g-icon",{attrs:{"icon-class":"help-bg"}})],1),t._v(" "),i("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"上传航拍图片",placement:"right"}},[i("g-icon",{attrs:{"icon-class":"upload"},on:{click:t.handleUpload}})],1)],1)])],1),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:t.sending},on:{click:t.handleSubmit}},[t._v("保存")])],1),t._v(" "),i("el-dialog",{attrs:{center:"","append-to-body":!0,top:"25vh",title:"上传图片","list-type":"picture",limit:1,visible:t.dialogUploadVisible,modal:t.needModal,"close-on-click-modal":t.closeOnClickModel,width:"400px"},on:{"update:visible":function(e){t.dialogUploadVisible=e}}},[i("el-upload",{ref:"upload",staticClass:"dialog-upload",staticStyle:{"text-align":"center"},attrs:{drag:"",action:"",accept:".jpeg,.jpg,.png,.gif","list-type":"picture","auto-upload":!1,multiple:!1,limit:1,"on-change":t.handleFileChange,"on-remove":t.handleFileRemove}},[i("i",{staticClass:"el-icon-upload"}),t._v(" "),i("div",{staticClass:"el-upload__text"},[t._v("\n        将文件拖到此处，或\n        "),i("em",[t._v("点击上传")])])]),t._v(" "),i("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:t.handleUploadClose}},[t._v("取消")]),t._v(" "),i("el-button",{directives:[{name:"loading",rawName:"v-loading",value:t.sending,expression:"sending"}],attrs:{disabled:!t.temp_upload.picFile},on:{click:t.uploadFile}},[t._v("提交")])],1)],1)],1)},n=[],o=(i("96cf"),i("3b8d")),l=i("95c0"),s=i.n(l),r=i("ed08"),c=i("f3a3"),d=i("c7b2"),u=i("55ee"),p=i("bc19"),h=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.visible,expression:"visible"}],staticClass:"map__wrap"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.mapLoading,expression:"mapLoading"}],staticClass:"map",attrs:{"element-loading-text":"激光地图加载中","element-loading-background":"rgba(0, 0, 0, 0.5)"}},[i("zr-component",{ref:"zr-components",attrs:{error:t.errorVisible},on:{resize:t.resize,loadComplete:t.loadComplete}})],1)])},m=[],f=(i("ac6a"),{name:"",components:{ZrComponent:p["a"]},mixins:[d["a"]],props:{source:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1}},data:function(){return{emptyText:null,listLoading:!1,formSize:"mini",mapInfo:{},temp_points:[],errorVisible:!1,mapLoading:!0,zrwidth:0,zrheight:0,zr:null,zposition:[0,0],zscale:[1,1],zrotation:0,zorigin:[0,0],group_back:null,group_overlay:null,globalAlpha:.65}},watch:{source:function(t,e){var i=this.mapInfo;i.id&&i.id===t.id||(this.mapInfo=t,this.reset())}},created:function(){},mounted:function(){},methods:{loadComplete:function(t){this.zr=t},resize:function(){this.zr&&this.reset()},reset:function(){this.zr&&this.zr.clear(),this.zr.off(),this.mapLoading=!1,this.errorVisible=!1,this.temp_points=[],this.init(),this.$emit("mapTransform",this.group_back,{enableRotation:!0}),this.draw().catch(this.drawErrorCallback)},init:function(){var t=this.mapInfo,e=this.$refs["zr-components"].$el;if(this.zrwidth=t.picWidth,this.zrheight=t.picHeight,this.zrwidth&&this.zrheight){var i=Object(c["c"])(e,this.zrwidth,this.zrheight),a=i.left,n=i.top,o=Object(c["b"])(e,this.zrwidth,this.zrheight);if(this.zorigin=[this.zrwidth/2,this.zrheight/2],this.zscale=[o,o],this.zposition=[a,n],this.zrotation=0,t.mapCoord){var l=t.mapCoord,r=l.scale,d=l.degree,u=l.fmapTranslation,p=l.fmap_xl1,h=l.fmap_yl1,m=l.fmap_xl2,f=l.fmap_yl2;r&&(this.zscale=[r,r]),d&&(this.zrotation=d),Array.isArray(u)&&(this.zposition=[u.x,u.y]),p&&h&&this.temp_points.push({x:p,y:h}),m&&f&&this.temp_points.push({x:m,y:f}),this.submit()}this.group_back=new s.a.Group,this.group_overlay=new s.a.Group,this.group_overlay.silent=!1,this.zr.add(this.group_back),this.zr.add(this.group_overlay),this.zr.refreshImmediately(),this.listeners()}else console.log("缺失图片参数的，一概不处理")},update:function(){this.errorVisible=!1,this.group_overlay&&this.group_overlay.removeAll(),this.draw().catch(this.drawErrorCallback)},draw:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,l,s,c,d,p,h,m,f,g;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.zrwidth,i=this.zrheight,a=this.group_back,n=this.group_overlay,o=this.zposition,l=this.zscale,s=this.zrotation,c=this.globalAlpha,d=this.mapInfo,a||n){t.next=3;break}return t.abrupt("return");case 3:if(p=this,a.position=o.slice(0),a.scale=l.slice(0),a.rotation=s,!(a.childCount()<1)){t.next=15;break}return this.mapLoading=!1,h=d.mapPicUrl,t.next=12,Object(r["j"])(h);case 12:m=t.sent,f=Object(u["c"])(m,e,i,c),f&&a.add(f);case 15:g=this.temp_points,Array.isArray(g)&&g.length>0&&g.forEach(function(t,a,r){var c="#2DAB61",d={style:{strokeNoScale:!0,fill:c,lineWidth:2,stroke:c},shape:{cx:parseFloat(t.x),cy:parseFloat(t.y),r:5},onmousedown:function(t){var e=t.event||t;if(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0,!e.altKey)return!1;r.splice(a,1),p.update(),p.submit()}},h=Object(u["b"])(d,e,i,o,l,s);h&&n.add(h)}),this.group_back.dirty(),this.group_overlay.dirty(),this.mapLoading=!1;case 20:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),drawErrorCallback:function(t){console.log(t),this.errorVisible=!0,this.mapLoading=!1},listeners:function(){var t=this,e=this.group_back;e&&e.on("click",function(e){var i=e.event||e;if(i.altKey)return!0;var a=t.zrwidth,n=t.zrheight,o=t.zposition,l=t.zscale,s=t.zrotation,r=i.offsetX,d=i.offsetY,u=Object(c["e"])([r,d],a,n,o,l,s);t.temp_points.length<2&&(t.temp_points.push({x:u[0],y:u[1]}),t.submit()),t.update()})},submit:function(){this.$emit("coords",this._.cloneDeep(this.temp_points))}}}),g=f,v=(i("293e"),i("2877")),b=Object(v["a"])(g,h,m,!1,null,"05cf0e4a",null),_=b.exports,y=i("0a1f"),x=y["patrol"].uploadAerialMap,k=y["patrol"].modifyMapCoordInfo,w={name:"GAerialAdjustment",components:{laser:_,ZrComponent:p["a"]},mixins:[d["a"]],props:{source:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1}},data:function(){return{emptyText:null,listLoading:!1,formSize:"mini",errorVisible:!1,mapLoading:!0,zrwidth:0,zrheight:0,zr:null,zposition:[0,0],zscale:[1,1],zrotation:0,zorigin:[0,0],group_back:null,group_overlay:null,globalAlpha:.65,mapInfo:{},mapVisible:!0,temp_points:[],sidebarVisible:!1,sidebarTimeout:null,needModal:!0,closeOnClickModel:!1,dialogVisible:this.visible,sending:!1,dialogUploadVisible:!1,temp_upload:{id:"",picFile:null}}},watch:{visible:function(t){this.dialogVisible=t}},created:function(){},mounted:function(){},methods:{opened:function(){var t=this.source,e=this.mapInfo;e.id&&e.id===t.id||(this.mapInfo=t,this.reset()),this.$watch("mapInfo.mapPicUrl3",function(t,e){t!==e&&this.reset()})},closed:function(){this.$emit("update:visible",!1)},loadComplete:function(t){this.zr=t},resize:function(){this.zr&&this.reset()},reset:function(){this.zr&&this.zr.clear(),this.zr.off(),this.mapLoading=!1,this.errorVisible=!1,this.init(),this.$emit("mapTransform",this.group_back),this.draw().catch(this.drawErrorCallback)},init:function(){var t=this.mapInfo,e=this.$refs["zr-components"].$el;if(this.zrwidth=t.pic3Width,this.zrheight=t.pic3Height,this.zrwidth&&this.zrheight){var i=Object(c["c"])(e,this.zrwidth,this.zrheight),a=i.left,n=i.top,o=Object(c["b"])(e,this.zrwidth,this.zrheight);if(this.zorigin=[this.zrwidth/2,this.zrheight/2],this.zscale=[o,o],this.zposition=[a,n],t.mapCoord){var l=t.mapCoord,r=l.mscale,d=l.mmapTranslation;r&&(this.zscale=[r,r]),Array.isArray(d)&&(this.zposition=[d.x,d.y])}this.group_back=new s.a.Group,this.group_overlay=new s.a.Group,this.group_overlay.silent=!0,this.zr.add(this.group_back),this.zr.add(this.group_overlay),this.zr.refreshImmediately()}else console.log("缺失图片参数的，一概不处理")},update:function(){this.errorVisible=!1,this.group_overlay&&this.group_overlay.removeAll(),this.draw().catch(this.drawErrorCallback)},draw:function(){var t=Object(o["a"])(regeneratorRuntime.mark(function t(){var e,i,a,n,o,l,s,c,d,p,h;return regeneratorRuntime.wrap(function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.zrwidth,i=this.zrheight,a=this.group_back,n=this.group_overlay,o=this.zposition,l=this.zscale,s=this.zrotation,c=this.mapInfo,a||n){t.next=3;break}return t.abrupt("return");case 3:if(a.position=o.slice(0),a.scale=l.slice(0),a.rotation=s,!(a.childCount()<1)){t.next=14;break}return this.mapLoading=!1,d=c.mapPicUrl3,t.next=11,Object(r["j"])(d);case 11:p=t.sent,h=Object(u["c"])(p,e,i),h&&a.add(h);case 14:this.group_back.dirty(),this.group_overlay.dirty(),this.mapLoading=!1;case 17:case"end":return t.stop()}},t,this)}));function e(){return t.apply(this,arguments)}return e}(),drawErrorCallback:function(t){console.log(t),this.errorVisible=!0,this.mapLoading=!1},handleSidebarClick:function(){var t=this.sidebarVisible,e=this.isError,i=this.sidebarTimeout;this.sidebarVisible=!e&&!t,i&&clearTimeout(i),this.sidebarTimeout=null},handleMouseEnter:function(t){var e=this.sidebarVisible,i=this.sidebarTimeout;e&&(i&&clearTimeout(i),this.sidebarTimeout=null)},handleMouseLeave:function(t){var e=this,i=this.sidebarVisible;i&&(this.sidebarTimeout=setTimeout(function(){e.sidebarVisible=!1},3e3))},handleModifyCoords:function(t){this.temp_points=t},handleSubmit:function(){var t=this,e=this.mapInfo,i=this.temp_points,a=this.zscale,n=this.zposition,o=this.zrwidth,l=this.zrheight,s=this.$refs["laser"],r=s.zscale,d=s.zrotation,u=s.zposition,p=s.zrwidth,h=s.zrheight,m=e.id,f=e.mapCoord,g=i.map(function(t){return Object(c["e"])(Object(c["d"])([t.x,t.y],p,h,u,r,d),o,l,n,a)});this.sending=!0,k({id:f.id,scanMapId:m,fmapXl1:i[0]?i[0].x:"",fmapYl1:i[0]?i[0].y:"",fmapXl2:i[1]?i[1].x:"",fmapYl2:i[1]?i[1].y:"",fmapXm1:g[0]?g[0].lng:"",fmapYm1:g[0]?g[0].lat:"",fmapXm2:g[1]?g[1].lng:"",fmapYm2:g[1]?g[1].lat:"",scale:r[0],degree:d,mScale:a[0],fmapTranslation:JSON.stringify({x:u[0],y:u[1]}),mmapTranslation:JSON.stringify({x:n[0],y:n[1]})}).then(function(e){t.$message.success(e.msg),t.sending=!1},function(e){t.sending=!1,console.log(e)})},handleUpload:function(){var t=this;this.temp_upload.id=this.mapInfo.id,this.temp_upload.picFile=null,this.$nextTick(function(){t.dialogUploadVisible=!0})},handleUploadClose:function(){var t=this;this.$refs["upload"]&&this.$refs["upload"].clearFiles(),this.temp_upload.id=null,this.temp_upload.picFile=null,this.$nextTick(function(){t.dialogUploadVisible=!1})},handleFileRemove:function(){this.temp_upload.picFile=null},handleFileChange:function(t){"undefined"!==typeof t&&(this.temp_upload.picFile=t.raw)},uploadFile:function(){var t=this;this.sending=!0,x(this.temp_upload).then(function(e){t.$message.success(e.msg),t.sending=!1,t.mapInfo=Object.assign(t.mapInfo,e.data),t.$emit("update:source",t.mapInfo),t.handleUploadClose()},function(e){t.sending=!1,console.log(e)})}}},C=w,I=(i("fc945"),Object(v["a"])(C,a,n,!1,null,"28fe613d",null));e["a"]=I.exports},f77e:function(t,e,i){},fc945:function(t,e,i){"use strict";var a=i("b18c"),n=i.n(a);n.a}}]);